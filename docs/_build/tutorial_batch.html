<!DOCTYPE html>

<html lang="python">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7. Tutorial: batch &#8212; hs_process 0.0.4 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. API" href="my_hs_process_api.html" />
    <link rel="prev" title="6. Tutorial: spatial_mod" href="tutorial_spatial_mod.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          hs_process</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/tnigon/hs_process">Github</a></li>
                <li><a href="https://anaconda.org/conda-forge/hs-process">Download</a></li>
                <li><a href="http://www.spectralpython.net/">Spectral Python</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Home</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">1. Setup and Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_hsio.html">2. Tutorial: <code class="docutils literal notranslate"><span class="pre">hsio</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_hstools.html">3. Tutorial: <code class="docutils literal notranslate"><span class="pre">hstools</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_segment.html">4. Tutorial: <code class="docutils literal notranslate"><span class="pre">segment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_spec_mod.html">5. Tutorial: <code class="docutils literal notranslate"><span class="pre">spec_mod</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_spatial_mod.html">6. Tutorial: <code class="docutils literal notranslate"><span class="pre">spatial_mod</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. Tutorial: <code class="docutils literal notranslate"><span class="pre">batch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="my_hs_process_api.html">8. API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.batch.html">8.1.1. batch</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.defaults.html">8.1.2. defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.hsio.html">8.1.3. hsio</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.hstools.html">8.1.4. hstools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.segment.html">8.1.5. segment</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.spatial_mod.html">8.1.6. spatial_mod</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/hs_process.spec_mod.html">8.1.7. spec_mod</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="license.html">9. License</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html">10. Change Log</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">1. Setup and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_hsio.html">2. Tutorial: <code class="docutils literal notranslate"><span class="pre">hsio</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_hstools.html">3. Tutorial: <code class="docutils literal notranslate"><span class="pre">hstools</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_segment.html">4. Tutorial: <code class="docutils literal notranslate"><span class="pre">segment</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_spec_mod.html">5. Tutorial: <code class="docutils literal notranslate"><span class="pre">spec_mod</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_spatial_mod.html">6. Tutorial: <code class="docutils literal notranslate"><span class="pre">spatial_mod</span></code></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Tutorial: <code class="docutils literal notranslate"><span class="pre">batch</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="my_hs_process_api.html">8. API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.batch.html">8.1.1. batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.defaults.html">8.1.2. defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.hsio.html">8.1.3. hsio</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.hstools.html">8.1.4. hstools</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.segment.html">8.1.5. segment</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.spatial_mod.html">8.1.6. spatial_mod</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hs_process.spec_mod.html">8.1.7. spec_mod</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">9. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">10. Change Log</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="tutorial_spatial_mod.html" title="Previous Chapter: 6. Tutorial: spatial_mod"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 6. Tutorial: ...</span>
    </a>
  </li>
  <li>
    <a href="my_hs_process_api.html" title="Next Chapter: 8. API"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">8. API &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/tutorial_batch.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">7. Tutorial: <code class="docutils literal notranslate"><span class="pre">batch</span></code></a><ul>
<li><a class="reference internal" href="#Sample-data">7.1. Sample data</a></li>
<li><a class="reference internal" href="#Confirm-your-environment">7.2. Confirm your environment</a></li>
<li><a class="reference internal" href="#batch.cube_to_spectra">7.3. <code class="docutils literal notranslate"><span class="pre">batch.cube_to_spectra</span></code></a></li>
<li><a class="reference internal" href="#batch.segment_band_math">7.4. <code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code></a></li>
<li><a class="reference internal" href="#batch.segment_create_mask">7.5. <code class="docutils literal notranslate"><span class="pre">batch.segment_create_mask</span></code></a></li>
<li><a class="reference internal" href="#batch.spatial_crop">7.6. <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code></a></li>
<li><a class="reference internal" href="#batch.spectra_combine">7.7. <code class="docutils literal notranslate"><span class="pre">batch.spectra_combine</span></code></a></li>
<li><a class="reference internal" href="#batch.spectra_to_csv">7.8. <code class="docutils literal notranslate"><span class="pre">batch.spectra_to_csv</span></code></a></li>
<li><a class="reference internal" href="#batch.spectra_to_df">7.9. <code class="docutils literal notranslate"><span class="pre">batch.spectra_to_df</span></code></a></li>
<li><a class="reference internal" href="#batch.spectral_clip">7.10. <code class="docutils literal notranslate"><span class="pre">batch.spectral_clip</span></code></a></li>
<li><a class="reference internal" href="#batch.spectral_mimic">7.11. <code class="docutils literal notranslate"><span class="pre">batch.spectral_mimic</span></code></a></li>
<li><a class="reference internal" href="#batch.spectral_resample">7.12. <code class="docutils literal notranslate"><span class="pre">batch.spectral_resample</span></code></a></li>
<li><a class="reference internal" href="#batch.spectral_smooth">7.13. <code class="docutils literal notranslate"><span class="pre">batch.spectral_smooth</span></code></a></li>
</ul>
</li>
</ul>

<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Tutorial:-batch">
<h1><span class="section-number">7. </span>Tutorial: <code class="docutils literal notranslate"><span class="pre">batch</span></code><a class="headerlink" href="#Tutorial:-batch" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">hs_process.batch</span></code> extends the functionality of the core modules of <code class="docutils literal notranslate"><span class="pre">hs_process</span></code> (<a class="reference external" href="api/hs_process.segment.html#hs_process.segment">segment</a>, <a class="reference external" href="api/hs_process.spatial_mod.html#hs_process.spatial_mod">spatial_mod</a>, and <a class="reference external" href="api/hs_process.spec_mod.html#hs_process.spec_mod">spec_mod</a>) so that image processing can run via a <em>relatively straightforward</em> script without end user interaction.</p>
<p>The overall goal of the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module is to implement many post-processing steps across many datacubes via an easy-to-use API. It was designed to save all data products (intermediate or final) to disk. Any unwanted files must be manually deleted by the user.</p>
<hr class="docutils" />
<div class="section" id="Sample-data">
<h2><span class="section-number">7.1. </span>Sample data<a class="headerlink" href="#Sample-data" title="Permalink to this headline">¶</a></h2>
<p>Sample imagery captured from a <a class="reference external" href="https://resonon.com/">Resonon</a> Pika II VIS-NIR line scanning imager and ancillary sample files can be downloaded from this <a class="reference external" href="https://drive.google.com/drive/folders/1KpOBB4-qghedVFd8ukQngXNwUit8PFy_?usp=sharing">link</a>.</p>
<p>Before trying this tutorial on your own machine, please download the <a class="reference external" href="https://drive.google.com/drive/folders/1KpOBB4-qghedVFd8ukQngXNwUit8PFy_?usp=sharing">sample files</a> and place into a local directory of your choosing (and do not change the file names). Indicate the location of your sample files by modifying <code class="docutils literal notranslate"><span class="pre">data_dir</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:</span><span class="se">\\</span><span class="s1">nigo0024\Documents\hs_process_demo&#39;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Confirm-your-environment">
<h2><span class="section-number">7.2. </span>Confirm your environment<a class="headerlink" href="#Confirm-your-environment" title="Permalink to this headline">¶</a></h2>
<p>Before trying the tutorials, be sure <code class="docutils literal notranslate"><span class="pre">hs_process</span></code> and its dependencies are <a class="reference external" href="installation.html#">properly installed</a>. If you installed in a <em>virtual environment</em>, first check we are indeed using the Python instance that was installed with the virtual environment:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Python install location: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Python install location: C:\Users\nigo0024\Anaconda3\envs\msi_sip\python.exe
</pre></div></div>
</div>
<p>The <em>spec</em> folder that contains <code class="docutils literal notranslate"><span class="pre">python.exe</span></code> tells me that the activated Python instance is indeed in the <code class="docutils literal notranslate"><span class="pre">spec</span></code> environment, just as I intend. If you created a virtual environment, but your <code class="docutils literal notranslate"><span class="pre">python.exe</span></code> is not in the <code class="docutils literal notranslate"><span class="pre">envs\spec</span></code> directory, you either did not properly create your virtual environment or you are not pointing to the correct Python installation in your IDE (e.g., Spyder, Jupyter notebook, etc.).</p>
</div>
<hr class="docutils" />
<div class="section" id="batch.cube_to_spectra">
<h2><span class="section-number">7.3. </span><code class="docutils literal notranslate"><span class="pre">batch.cube_to_spectra</span></code><a class="headerlink" href="#batch.cube_to_spectra" title="Permalink to this headline">¶</a></h2>
<p>Calculates the mean and standard deviation for each cube in <code class="docutils literal notranslate"><span class="pre">fname_list</span></code> and writes the result to a “.spec” file. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.cube_to_spectra">[API]</a></p>
<p><strong>Note:</strong> The following <code class="docutils literal notranslate"><span class="pre">batch</span></code> example builds on the results of the <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> tutorial &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__. Please complete the <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__ example to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>) is populated with multiple hyperspectral datacubes. The following example will be using datacubes located in the following directory:
<code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">batch.cube_to_spectra</span></code> to calculate the <em>mean</em> and <em>standard deviation</em> across all pixels for each of the datacubes in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">cube_to_spectra</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">write_geotiff</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cube_to_spectra: |----------------------------------------------------------------------------------------------------| 0.0%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:02&lt;00:00, 16.13it/s]
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">`seaborn</span></code> &lt;<a class="reference external" href="https://seaborn.pydata.org/index.html">https://seaborn.pydata.org/index.html</a>&gt;`__ to visualize the spectra of plots 1011, 1012, and 1013. Notice how <code class="docutils literal notranslate"><span class="pre">hsbatch.io.name_plot</span></code> is utilized to retrieve the plot ID, and how the <em>“history”</em> tag is referenced from the metadata to determine the number of pixels whose reflectance was averaged to create the mean spectra. Also remember that pixels across the original input image likely represent a combination of soil, vegetation, and shadow.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">fname_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">,</span> <span class="s1">&#39;cube_to_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-cube-to-spec-mean.spec&#39;</span><span class="p">),</span>
              <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">,</span> <span class="s1">&#39;cube_to_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1012-cube-to-spec-mean.spec&#39;</span><span class="p">),</span>
              <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">,</span> <span class="s1">&#39;cube_to_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1013-cube-to-spec-mean.spec&#39;</span><span class="p">)]</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fname_list</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_spec</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">meta_bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span>
    <span class="n">pix_n</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;&lt;pixel number: (.*)&gt;&#39;</span><span class="p">,</span> <span class="n">hist</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Plot &#39;</span><span class="o">+</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">name_plot</span><span class="o">+</span><span class="s1">&#39; (n=&#39;</span><span class="o">+</span><span class="n">pix_n</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.cube_to_spectra`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.cube_to_spectra`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_9_1.png" src="_images/tutorial_batch_9_1.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="batch.segment_band_math">
<h2><span class="section-number">7.4. </span><code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code><a class="headerlink" href="#batch.segment_band_math" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to perform band math on multiple datacubes in the same way. <code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code> is typically used prior to <code class="docutils literal notranslate"><span class="pre">batch.segment_create_mask</span></code> to generate the images/directory required for the masking process. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.segment_band_math">[API]</a></p>
<p><strong>Note:</strong> The following <code class="docutils literal notranslate"><span class="pre">batch</span></code> example builds on the results of the <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> tutorial &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__. Please complete the <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__ example to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>) is populated with multiple hyperspectral datacubes. The following example will be using datacubes located in the following directory:
<code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code> to compute the MCARI2 (Modified Chlorophyll Absorption Ratio Index Improved; Haboudane et al., 2004) spectral index for each of the datacubes in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>. See <code class="docutils literal notranslate"><span class="pre">Harris</span> <span class="pre">Geospatial</span></code>_ for more information about the MCARI2 spectral index and references to other spectral indices.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">folder_name</span> <span class="o">=</span> <span class="s1">&#39;band_math_mcari2-800-670-550&#39;</span>  <span class="c1"># folder name can be modified to be more descriptive in what type of band math is being performed</span>
<span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;mcari2&#39;</span>  <span class="c1"># must be one of &quot;ndi&quot;, &quot;ratio&quot;, &quot;derivative&quot;, or &quot;mcari2&quot;</span>
<span class="n">wl1</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">wl2</span> <span class="o">=</span> <span class="mi">670</span>
<span class="n">wl3</span> <span class="o">=</span> <span class="mi">550</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">segment_band_math</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="n">folder_name</span><span class="p">,</span>
                          <span class="n">name_append</span><span class="o">=</span><span class="s1">&#39;band-math&#39;</span><span class="p">,</span> <span class="n">write_geotiff</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">wl1</span><span class="o">=</span><span class="n">wl1</span><span class="p">,</span> <span class="n">wl2</span><span class="o">=</span><span class="n">wl2</span><span class="p">,</span> <span class="n">wl3</span><span class="o">=</span><span class="n">wl3</span><span class="p">,</span>
                          <span class="n">plot_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:13&lt;00:00,  2.89it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_13_1.png" src="_images/tutorial_batch_13_1.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code> creates a new folder in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code> (in this case the new directory is <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf\band_math_mcari2-800-670-550</span></code>), which contains several data products.</p>
<p>The <strong>first</strong> is <code class="docutils literal notranslate"><span class="pre">band-math-stats.csv</span></code>: a spreadsheet containing summary statistics for each of the image cubes that were processed via <code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code>; stats include <em>pixel count</em>, <em>mean</em>, <em>standard deviation</em>, <em>median</em>, and <em>percentiles</em> across all image pixels.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;band_math_mcari2-800-670-550&#39;</span><span class="p">,</span> <span class="s1">&#39;band-math-stats.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fname</th>
      <th>plot_id</th>
      <th>count</th>
      <th>mean</th>
      <th>std_dev</th>
      <th>median</th>
      <th>pctl_10th</th>
      <th>pctl_25th</th>
      <th>pctl_50th</th>
      <th>pctl_75th</th>
      <th>pctl_90th</th>
      <th>pctl_95th</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1011</td>
      <td>3391</td>
      <td>0.622999</td>
      <td>0.154441</td>
      <td>0.647932</td>
      <td>0.400957</td>
      <td>0.526855</td>
      <td>0.647932</td>
      <td>0.743904</td>
      <td>0.802663</td>
      <td>0.825942</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1012</td>
      <td>4902</td>
      <td>0.627408</td>
      <td>0.137226</td>
      <td>0.651605</td>
      <td>0.432411</td>
      <td>0.545338</td>
      <td>0.651605</td>
      <td>0.732981</td>
      <td>0.783473</td>
      <td>0.806512</td>
    </tr>
    <tr>
      <th>2</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1013</td>
      <td>4902</td>
      <td>0.483455</td>
      <td>0.170385</td>
      <td>0.491520</td>
      <td>0.244630</td>
      <td>0.349948</td>
      <td>0.491520</td>
      <td>0.626670</td>
      <td>0.698892</td>
      <td>0.737506</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1014</td>
      <td>4902</td>
      <td>0.582990</td>
      <td>0.175643</td>
      <td>0.618471</td>
      <td>0.315483</td>
      <td>0.473933</td>
      <td>0.618471</td>
      <td>0.727224</td>
      <td>0.779835</td>
      <td>0.804277</td>
    </tr>
    <tr>
      <th>4</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1015</td>
      <td>4902</td>
      <td>0.582303</td>
      <td>0.161018</td>
      <td>0.597912</td>
      <td>0.351104</td>
      <td>0.461747</td>
      <td>0.597912</td>
      <td>0.716367</td>
      <td>0.782069</td>
      <td>0.809144</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Second</strong> is a <code class="docutils literal notranslate"><span class="pre">geotiff</span></code> file for each of the image cubes after the band math processing. This can be opened in <em>QGIS</em> to visualize in a spatial reference system, or can be opened using any software that supports floating point <em>.tif</em> files.</p>
<img alt="band-math-mcari2-tif" src="_images/segment_band_math_plot_611-band-math-mcari2-800-670-550_tif1.png" />
<p><strong>Third</strong> is the band math raster saved in the <em>.hdr</em> file format. Note that the data conained here should be the same as in the <em>.tif</em> file, so it’s a matter of preference as to what may be more useful. This single band <em>.hdr</em> can also be opend in <em>QGIS</em>.</p>
<p><strong>Fourth</strong> is a histogram of the band math data contained in the image. The histogram illustrates the 90th percentile value, which may be useful in the segmentation step (e.g., see <code class="docutils literal notranslate"><span class="pre">`batch.segment_create_mask</span></code> &lt;tutorial_batch.html#batch.segment_create_mask&gt;`__).</p>
</div>
<hr class="docutils" />
<div class="section" id="batch.segment_create_mask">
<h2><span class="section-number">7.5. </span><code class="docutils literal notranslate"><span class="pre">batch.segment_create_mask</span></code><a class="headerlink" href="#batch.segment_create_mask" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to create a masked array on many datacubes. <code class="docutils literal notranslate"><span class="pre">batch.segment_create_mask</span></code> is typically used after <code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code> to mask all the datacubes in a directory based on the result of the band math process. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.segment_create_mask">[API]</a></p>
<p><strong>Note:</strong> The following <code class="docutils literal notranslate"><span class="pre">batch</span></code> example builds on the results of the <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> tutorial &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__ and and <code class="docutils literal notranslate"><span class="pre">`batch.segment_band_math</span></code> &lt;tutorial_batch.html#batch.segment_band_math&gt;`__. Please complete both the <code class="docutils literal notranslate"><span class="pre">spatial_mod.crop_many_gdf</span></code> and <code class="docutils literal notranslate"><span class="pre">batch.segment_band_math</span></code> tutorial examples to be sure your directories (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">mask_dir</span></code>) are populated with image files. The following example will be using
datacubes located in: <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf</span></code> based on MCARI2 images located in: <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf\band_math_mcari2-800-670-550</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, ensuring <code class="docutils literal notranslate"><span class="pre">base_dir</span></code> is a valid directory</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>There must be a single-band image that will be used to determine which datacube pixels are to be masked (determined via the <code class="docutils literal notranslate"><span class="pre">mask_dir</span></code> parameter). Point to the directory that contains the MCARI2 images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mask_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;band_math_mcari2-800-670-550&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">mask_dir</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Indicate how the MCARI2 images should be used to determine which hyperspectal pixels are to be masked. The available parameters for controlling this are <code class="docutils literal notranslate"><span class="pre">mask_thresh</span></code>, <code class="docutils literal notranslate"><span class="pre">mask_percentile</span></code>, and <code class="docutils literal notranslate"><span class="pre">mask_side</span></code>. We will mask out all pixels that fall below the MCARI2 90th percentile.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mask_percentile</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">mask_side</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span>
</pre></div>
</div>
</div>
<p>Finally, indicate the folder to save the masked datacubes and perform the batch masking via <code class="docutils literal notranslate"><span class="pre">batch.segment_create_mask</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">folder_name</span> <span class="o">=</span> <span class="s1">&#39;mask_mcari2_90th&#39;</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">segment_create_mask</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">mask_dir</span><span class="o">=</span><span class="n">mask_dir</span><span class="p">,</span>
                            <span class="n">folder_name</span><span class="o">=</span><span class="n">folder_name</span><span class="p">,</span>
                            <span class="n">name_append</span><span class="o">=</span><span class="s1">&#39;mask-mcari2-90th&#39;</span><span class="p">,</span> <span class="n">write_geotiff</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">mask_percentile</span><span class="o">=</span><span class="n">mask_percentile</span><span class="p">,</span>
                            <span class="n">mask_side</span><span class="o">=</span><span class="n">mask_side</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 0/40:   0%|                                                                              | 0/40 [00:00&lt;?, ?it/s]C:\Users\nigo0024\Anaconda3\envs\msi_sip\lib\site-packages\spectral\io\spyfile.py:218: NaNValueWarning: Image data contains NaN values.
  warnings.warn(&#39;Image data contains NaN values.&#39;, NaNValueWarning)
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:04&lt;00:00,  8.13it/s]
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">batch.segment_create_mask</span></code> creates a new folder in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code> named according to the <code class="docutils literal notranslate"><span class="pre">folder_name</span></code> parameter (in this case the new directory is <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf\mask_mcari2_90th</span></code>) which contains several data products.</p>
<p>The <strong>first</strong> is <code class="docutils literal notranslate"><span class="pre">mask-stats.csv</span></code>: a spreadsheet containing the band math threshold value for each image file. In this example, the MCARI2 value corresponding to the 90th percentile is listed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;mask_mcari2_90th&#39;</span><span class="p">,</span> <span class="s1">&#39;mask-stats.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fname</th>
      <th>plot_id</th>
      <th>lower-pctl-90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1011</td>
      <td>0.832222</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1012</td>
      <td>0.811119</td>
    </tr>
    <tr>
      <th>2</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1013</td>
      <td>0.743942</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1014</td>
      <td>0.809496</td>
    </tr>
    <tr>
      <th>4</th>
      <td>F:\\nigo0024\Documents\hs_process_demo\spatial...</td>
      <td>1015</td>
      <td>0.813714</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Second</strong> is a <code class="docutils literal notranslate"><span class="pre">geotiff</span></code> file for each of the image cubes after the masking procedure. This can be opened in <em>QGIS</em> to visualize in a spatial reference system, or can be opened using any software that supports floating point <em>.tif</em> files. The masked pixels are saved as <code class="docutils literal notranslate"><span class="pre">null</span></code> values and should render transparently.</p>
<img alt="segment-create-mask-geotiff" src="_images/segment_create_mask_geotiff1.png" />
<p><strong>Third</strong> is the full hyperspectral datacube, also with the masked pixels saved as <code class="docutils literal notranslate"><span class="pre">null</span></code> values. Note that the only pixels remaining are the 10% with the highest MCARI2 values.</p>
<img alt="segment-create-mask-datacube" src="_images/segment_create_mask_datacube1.png" />
<p><strong>Fourth</strong> is the mean spectra across the unmasked datacube pixels. This is illustrated above by the green line plot (the light green shadow represents the standard deviation for each band).</p>
</div>
<hr class="docutils" />
<div class="section" id="batch.spatial_crop">
<h2><span class="section-number">7.6. </span><code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code><a class="headerlink" href="#batch.spatial_crop" title="Permalink to this headline">¶</a></h2>
<p>Iterates through a spreadsheet that provides necessary information about how each image should be cropped and how it should be saved. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spatial_crop">[API]</a></p>
<p>If <code class="docutils literal notranslate"><span class="pre">gdf</span></code> is passed (a <code class="docutils literal notranslate"><span class="pre">geopandas.GoeDataFrame</span></code> polygon file), the cropped images will be shifted to the center of appropriate “plot” polygon.</p>
<p><strong>Tips and Tricks for</strong> <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> <strong>when</strong> <code class="docutils literal notranslate"><span class="pre">gdf</span></code> <strong>is not passed</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">gdf</span></code> is not passed, <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> may have the following required column headings that correspond to the relevant parameters in <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_single</span></code> &lt;tutorial_spatial_mod.html#spatial_mod.crop_single&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__:</p>
<ol class="arabic simple">
<li><p>“directory”</p></li>
<li><p>“name_short”</p></li>
<li><p>“name_long”</p></li>
<li><p>“ext”</p></li>
<li><p>“pix_e_ul”</p></li>
<li><p>“pix_n_ul”.</p></li>
</ol>
<p>With this minimum input, <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> will read in each image, crop from the upper left pixel (determined as <code class="docutils literal notranslate"><span class="pre">pix_e_ul</span></code>/<code class="docutils literal notranslate"><span class="pre">pix_n_ul</span></code>) to the lower right pixel calculated based on <code class="docutils literal notranslate"><span class="pre">crop_e_pix</span></code>/<code class="docutils literal notranslate"><span class="pre">crop_n_pix</span></code> (which is the width of the cropped area in units of pixels).</p>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">crop_e_pix</span></code> and <code class="docutils literal notranslate"><span class="pre">crop_n_pix</span></code> have default values (see <code class="docutils literal notranslate"><span class="pre">`defaults.crop_defaults</span></code> &lt;api/hs_process.defaults.html#hs_process.defaults&gt;`__), but they can also be passed specifically for each datacube by including appropriate columns in <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> (which takes precedence over <code class="docutils literal notranslate"><span class="pre">defaults.crop_defaults</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> may also have the following optional column headings:</p>
<ol class="arabic simple">
<li><p>“crop_e_pix”</p></li>
<li><p>“crop_n_pix”</p></li>
<li><p>“crop_e_m”</p></li>
<li><p>“crop_n_m”</p></li>
<li><p>“buf_e_pix”</p></li>
<li><p>“buf_n_pix”</p></li>
<li><p>“buf_e_m”</p></li>
<li><p>“buf_n_m”</p></li>
<li><p>“plot_id”</p></li>
</ol>
<p><strong>More</strong> <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> <strong>Tips and Tricks</strong></p>
<ol class="arabic simple">
<li><p>These optional inputs passed via <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> allow more control over exactly how the images are to be cropped. For a more detailed explanation of the information that many of these columns are intended to contain, see the documentation for <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_single</span></code> &lt;tutorial_spatial_mod.html#spatial_mod.crop_single&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`spatial_mod.crop_many_gdf</span></code> &lt;tutorial_spatial_mod.html#spatial_mod.crop_many_gdf&gt;`__. Those parameters not referenced should be apparent in the API examples and
tutorials.</p></li>
<li><p>If the column names are different in <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> than described here, <code class="docutils literal notranslate"><span class="pre">`defaults.spat_crop_cols</span></code> &lt;api/hs_process.defaults.html#hs_process.defaults&gt;`__ can be modified to indicate which columns correspond to the relevant information.</p></li>
<li><p>Any other columns can be added to <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code>, but <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> does not use them in any way.</p></li>
</ol>
<p><strong>Note:</strong> The following <code class="docutils literal notranslate"><span class="pre">batch</span></code> example only actually processes <em>a single</em> hyperspectral image. If more datacubes were present in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>, however, <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> would process all datacubes that were available.</p>
<p><strong>Note:</strong> This example uses <code class="docutils literal notranslate"><span class="pre">spatial_mod.crop_many_gdf</span></code> to crop many plots from a datacube using a polygon geometry file describing the spatial extent of each plot.</p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span> <span class="n">dir_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Load the plot geometry as a <code class="docutils literal notranslate"><span class="pre">geopandas.GeoDataFrame</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fname_gdf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;plot_bounds.geojson&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fname_gdf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Perform the spatial cropping using the <em>“many_gdf”</em> <code class="docutils literal notranslate"><span class="pre">method</span></code>. Note that nothing is being passed to <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> here, so <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> is simply going to attempt to crop all plots contained within <code class="docutils literal notranslate"><span class="pre">gdf</span></code> that overlap with any datacubes in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>.</p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code> directly is definitely more flexible for customization. However, some customization is possible while not passing <code class="docutils literal notranslate"><span class="pre">fname_sheet</span></code>. In the example below, we set an easting and northing buffer, as well as limit the number of plots to crop to 40. These defaults trickle through to <code class="docutils literal notranslate"><span class="pre">spatial_mod.crop_many_gdf()</span></code>, so by setting them on the <code class="docutils literal notranslate"><span class="pre">batch</span></code> object, they will be recognized when calculating crop boundaries from <code class="docutils literal notranslate"><span class="pre">gdf</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">crop_defaults</span><span class="o">.</span><span class="n">buf_e_m</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Sets buffer in the easting direction (units of meters)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">crop_defaults</span><span class="o">.</span><span class="n">buf_n_m</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">crop_defaults</span><span class="o">.</span><span class="n">n_plots</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># We can limit the number of plots to process from gdf</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">spatial_crop</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;many_gdf&#39;</span><span class="p">,</span>
                     <span class="n">gdf</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Because ``fname_list`` was passed instead of ``fname_sheet``, there is not a way to infer the study name and date. Therefore, &#34;study&#34; and &#34;date&#34; will be omitted from the output file name. If you would like output file names to include &#34;study&#34; and &#34;date&#34;, please pass ``fname_sheet`` with &#34;study&#34; and &#34;date&#34; columns.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:02&lt;00:00, 17.54it/s]
</pre></div></div>
</div>
<p>A new folder was created in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code> - <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_crop</span></code> - that contains the cropped datacubes and the cropped <code class="docutils literal notranslate"><span class="pre">geotiff</span></code> images. The Plot ID from the <code class="docutils literal notranslate"><span class="pre">gdf</span></code> is used to name each datacube according to its plot ID. The <code class="docutils literal notranslate"><span class="pre">geotiff</span></code> images can be opened in <em>QGIS</em> to visualize the images after cropping them.</p>
<img alt="spatial-crop-tifs" src="_images/spatial_crop_tifs1.png" />
<p>The cropped images were brightened in <em>QGIS</em> to emphasize the cropped boundaries. The plot boundaries are overlaid for reference (notice the 2.0 m buffer on the East/West ends and the 0.5 m buffer on the North/South sides).</p>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectra_combine">
<h2><span class="section-number">7.7. </span><code class="docutils literal notranslate"><span class="pre">batch.spectra_combine</span></code><a class="headerlink" href="#batch.spectra_combine" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to gather all pixels from every image in a directory, compute the mean and standard deviation, and save as a single spectra (i.e., a spectra file is equivalent to a single spectral pixel with no spatial information). <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectra_combine">[API]</a></p>
<p>Visualize the individual spectra by opening in <em>Spectronon</em>.</p>
<img alt="spectra-combine-initial" src="_images/spectra_combine_initial.png" />
<p>Notice that there is a range in radiance values across the various reference panels (e.g., the radiance in the green region ranges from ~26k to ~28k μW sr-1 cm-2 μm-1).</p>
<p><strong>Note:</strong> The following example will load in several small hyperspectral radiance datacubes <em>(not reflectance)</em> that were previously cropped manually (via Spectronon software). These datacubes represent the radiance values of grey reference panels that were placed in the field to provide data necessary for converting radiance imagery to reflectance. These particular datacubes were extracted from several different images captured within ~10 minutes of each other.</p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;cube_ref_panels&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Combine all the <em>radiance</em> datacubes in the directory via <code class="docutils literal notranslate"><span class="pre">batch.spectra_combine</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectra_combine</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;bip&#39;</span><span class="p">,</span> <span class="n">dir_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Combining datacubes/spectra into a single mean spectra.
Number of input datacubes/spectra: 7
Total number of pixels: 1516
</pre></div></div>
</div>
<p>Visualize the combined spectra by opening in <em>Spectronon</em>. The solid line represents the mean radiance spectra across all pixels and images in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>, and the lighter, slightly transparent line represents the standard deviation of the radiance across all pixels and images in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>.</p>
<img alt="spectra-combine" src="_images/spectra_combine1.png" />
<p>Notice the lower signal at the oxygen absorption region (near 770 nm). After converting datacubes to reflectance, it may be desireable to spectrally clip this region (see <code class="docutils literal notranslate"><span class="pre">`spec_mod.spectral_clip</span></code> &lt;tutorial_spec_mod.html#spec_mod.spectral_clip&gt;`__)</p>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectra_to_csv">
<h2><span class="section-number">7.8. </span><code class="docutils literal notranslate"><span class="pre">batch.spectra_to_csv</span></code><a class="headerlink" href="#batch.spectra_to_csv" title="Permalink to this headline">¶</a></h2>
<p>Reads all the <code class="docutils literal notranslate"><span class="pre">.spec</span></code> files in a direcory and saves their reflectance information to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. <code class="docutils literal notranslate"><span class="pre">batch.spectra_to_csv</span></code> is identical to <code class="docutils literal notranslate"><span class="pre">batch.spectra_to_df</span></code> except a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file is saved rather than returning a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectra_to_csv">[API]</a></p>
<p><strong>Note:</strong> The following example builds on the results of the <code class="docutils literal notranslate"><span class="pre">`batch.segment_band_math</span></code> tutorial &lt;tutorial_batch.html#batch.segment_band_math&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`batch.segment_create_mask</span></code> &lt;tutorial_batch.html#batch.segment_create_mask&gt;`__. Please complete each of those tutorial examples to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf\mask_mcari2_90th</span></code>) is populated with image files.</p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_mcari2_90th&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Read all the <code class="docutils literal notranslate"><span class="pre">.spec</span></code> files in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code> and save them to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectra_to_csv</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;spec&#39;</span><span class="p">,</span> <span class="n">dir_level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing mean spectra to a .csv file.
Number of input datacubes/spectra: 80
Output file location: F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf\mask_mcari2_90th\stats-spectra.csv
</pre></div></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">stats-spectra.csv</span></code> is opened, we can see that each row is a <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file from a different plot, and each column is a particular spectral band/wavelength.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;stats-spectra.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>wavelength</th>
      <th>394.6</th>
      <th>396.6528</th>
      <th>398.7056</th>
      <th>400.7584</th>
      <th>402.8112</th>
      <th>404.864</th>
      <th>406.9168</th>
      <th>408.9696</th>
      <th>...</th>
      <th>866.744</th>
      <th>868.7968</th>
      <th>870.8496</th>
      <th>872.9024</th>
      <th>874.9552</th>
      <th>877.008</th>
      <th>879.0608</th>
      <th>881.1136</th>
      <th>883.1664</th>
      <th>885.2192</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>fname</td>
      <td>plot_id</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>8.000000</td>
      <td>...</td>
      <td>231.000000</td>
      <td>232.000000</td>
      <td>233.000000</td>
      <td>234.00000</td>
      <td>235.000000</td>
      <td>236.000000</td>
      <td>237.000000</td>
      <td>238.000000</td>
      <td>239.000000</td>
      <td>240.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1011</td>
      <td>13.523563</td>
      <td>19.213570</td>
      <td>9.585402</td>
      <td>7.049162</td>
      <td>4.971103</td>
      <td>3.669440</td>
      <td>2.547665</td>
      <td>1.944489</td>
      <td>...</td>
      <td>45.952736</td>
      <td>45.177956</td>
      <td>44.178223</td>
      <td>45.59573</td>
      <td>44.237053</td>
      <td>45.192883</td>
      <td>44.707069</td>
      <td>44.317673</td>
      <td>44.977257</td>
      <td>44.885410</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1011</td>
      <td>6.422696</td>
      <td>11.165407</td>
      <td>5.400625</td>
      <td>4.512296</td>
      <td>3.475373</td>
      <td>2.522064</td>
      <td>2.044144</td>
      <td>1.697843</td>
      <td>...</td>
      <td>45.952736</td>
      <td>45.177956</td>
      <td>44.178223</td>
      <td>45.59573</td>
      <td>44.237053</td>
      <td>45.192883</td>
      <td>44.707069</td>
      <td>44.317673</td>
      <td>44.977257</td>
      <td>44.885410</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1012</td>
      <td>14.328226</td>
      <td>17.673107</td>
      <td>9.557288</td>
      <td>6.861992</td>
      <td>5.470718</td>
      <td>4.297456</td>
      <td>2.747330</td>
      <td>2.122929</td>
      <td>...</td>
      <td>44.907276</td>
      <td>44.544106</td>
      <td>43.384926</td>
      <td>44.67561</td>
      <td>43.880154</td>
      <td>44.394325</td>
      <td>43.728794</td>
      <td>43.444515</td>
      <td>44.277538</td>
      <td>44.192337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1012</td>
      <td>8.112519</td>
      <td>10.618262</td>
      <td>5.917343</td>
      <td>4.360370</td>
      <td>3.632289</td>
      <td>3.072112</td>
      <td>2.277318</td>
      <td>1.906745</td>
      <td>...</td>
      <td>44.907276</td>
      <td>44.544106</td>
      <td>43.384926</td>
      <td>44.67561</td>
      <td>43.880154</td>
      <td>44.394325</td>
      <td>43.728794</td>
      <td>43.444515</td>
      <td>44.277538</td>
      <td>44.192337</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 242 columns</p>
</div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectra_to_df">
<h2><span class="section-number">7.9. </span><code class="docutils literal notranslate"><span class="pre">batch.spectra_to_df</span></code><a class="headerlink" href="#batch.spectra_to_df" title="Permalink to this headline">¶</a></h2>
<p>Reads all the .spec files in a direcory and returns their data as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object. <code class="docutils literal notranslate"><span class="pre">batch.spectra_to_df</span></code> is identical to <code class="docutils literal notranslate"><span class="pre">batch.spectra_to_csv</span></code> except a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> is returned rather than saving a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectra_to_df">[API]</a></p>
<p><strong>Note:</strong> The following example builds on the results of the <code class="docutils literal notranslate"><span class="pre">`batch.segment_band_math</span></code> tutorial &lt;tutorial_batch.html#batch.segment_band_math&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`batch.segment_create_mask</span></code> &lt;tutorial_batch.html#batch.segment_create_mask&gt;`__. Please complete each of those tutorial examples to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_mod\crop_many_gdf\mask_mcari2_90th</span></code>) is populated with image files.</p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_mod&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_many_gdf&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_mcari2_90th&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Read all the <code class="docutils literal notranslate"><span class="pre">.spec</span></code> files in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code> and load them to <code class="docutils literal notranslate"><span class="pre">df_spec</span></code>, a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_spec</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">spectra_to_df</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;spec&#39;</span><span class="p">,</span> <span class="n">dir_level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_spec</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing mean spectra to a ``pandas.DataFrame``.
Number of input datacubes/spectra: 80
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fname</th>
      <th>plot_id</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>...</th>
      <th>231</th>
      <th>232</th>
      <th>233</th>
      <th>234</th>
      <th>235</th>
      <th>236</th>
      <th>237</th>
      <th>238</th>
      <th>239</th>
      <th>240</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1011</td>
      <td>13.523563</td>
      <td>19.213570</td>
      <td>9.585402</td>
      <td>7.049162</td>
      <td>4.971103</td>
      <td>3.669440</td>
      <td>2.547665</td>
      <td>1.944489</td>
      <td>...</td>
      <td>45.952736</td>
      <td>45.177956</td>
      <td>44.178223</td>
      <td>45.595730</td>
      <td>44.237053</td>
      <td>45.192883</td>
      <td>44.707069</td>
      <td>44.317673</td>
      <td>44.977257</td>
      <td>44.885410</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1011</td>
      <td>6.422696</td>
      <td>11.165407</td>
      <td>5.400625</td>
      <td>4.512296</td>
      <td>3.475373</td>
      <td>2.522064</td>
      <td>2.044144</td>
      <td>1.697843</td>
      <td>...</td>
      <td>45.952736</td>
      <td>45.177956</td>
      <td>44.178223</td>
      <td>45.595730</td>
      <td>44.237053</td>
      <td>45.192883</td>
      <td>44.707069</td>
      <td>44.317673</td>
      <td>44.977257</td>
      <td>44.885410</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1012</td>
      <td>14.328226</td>
      <td>17.673107</td>
      <td>9.557288</td>
      <td>6.861992</td>
      <td>5.470718</td>
      <td>4.297456</td>
      <td>2.747330</td>
      <td>2.122929</td>
      <td>...</td>
      <td>44.907276</td>
      <td>44.544106</td>
      <td>43.384926</td>
      <td>44.675610</td>
      <td>43.880154</td>
      <td>44.394325</td>
      <td>43.728794</td>
      <td>43.444515</td>
      <td>44.277538</td>
      <td>44.192337</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1012</td>
      <td>8.112519</td>
      <td>10.618262</td>
      <td>5.917343</td>
      <td>4.360370</td>
      <td>3.632289</td>
      <td>3.072112</td>
      <td>2.277318</td>
      <td>1.906745</td>
      <td>...</td>
      <td>44.907276</td>
      <td>44.544106</td>
      <td>43.384926</td>
      <td>44.675610</td>
      <td>43.880154</td>
      <td>44.394325</td>
      <td>43.728794</td>
      <td>43.444515</td>
      <td>44.277538</td>
      <td>44.192337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1013</td>
      <td>13.280209</td>
      <td>18.991058</td>
      <td>9.806862</td>
      <td>7.041559</td>
      <td>5.084080</td>
      <td>4.054595</td>
      <td>2.607378</td>
      <td>2.187212</td>
      <td>...</td>
      <td>40.590130</td>
      <td>40.234657</td>
      <td>39.194435</td>
      <td>40.260246</td>
      <td>39.648201</td>
      <td>40.096077</td>
      <td>39.318855</td>
      <td>39.217598</td>
      <td>39.904327</td>
      <td>39.873375</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 242 columns</p>
</div></div>
</div>
<p>Each row is a <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file from a different plot, and each column is a particular spectral band.</p>
<p>It is somewhat confusing to conceptualize spectral data by band number (as opposed to the wavelenth it represents). <code class="docutils literal notranslate"><span class="pre">hs_process.hs_tools.get_band</span></code> can be used to retrieve spectral data for all plots via indexing by wavelength. Say we need to access reflectance at 710 nm for each plot (in this case, the 710 nm band is band number 155).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_710nm</span> <span class="o">=</span> <span class="n">df_spec</span><span class="p">[[</span><span class="s1">&#39;fname&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_id&#39;</span><span class="p">,</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">710</span><span class="p">)]]</span>
<span class="n">df_710nm</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fname</th>
      <th>plot_id</th>
      <th>155</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1011</td>
      <td>5.769057</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1011</td>
      <td>5.769057</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1012</td>
      <td>6.112481</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1012</td>
      <td>6.112481</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wells_rep2_20180628_16h56m_pika_gige_7_plot_10...</td>
      <td>1013</td>
      <td>6.855353</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectral_clip">
<h2><span class="section-number">7.10. </span><code class="docutils literal notranslate"><span class="pre">batch.spectral_clip</span></code><a class="headerlink" href="#batch.spectral_clip" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to spectrally clip multiple datacubes in the same way. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectral_clip">[API]</a></p>
<p><strong>Note:</strong> The following example builds on the results of the <code class="docutils literal notranslate"><span class="pre">`batch.spatial_crop</span></code> tutorial &lt;tutorial_batch.html#batch.spatial_crop&gt;`__. Please complete the <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> tutorial example to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>) is populated with multiple hyperspectral datacubes. The following example will be using datacubes located in teh following directory: <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_crop</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_crop&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">batch.spectral_clip</span></code> to clip all spectral bands below <em>420 nm</em> and above <em>880 nm</em>, as well as the bands near the oxygen absorption (i.e., <em>760-776 nm</em>) and water absorption (i.e., <em>813-827 nm</em>) regions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectral_clip</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;spec_clip&#39;</span><span class="p">,</span>
                      <span class="n">wl_bands</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">420</span><span class="p">],</span> <span class="p">[</span><span class="mi">760</span><span class="p">,</span> <span class="mi">776</span><span class="p">],</span> <span class="p">[</span><span class="mi">813</span><span class="p">,</span> <span class="mi">827</span><span class="p">],</span> <span class="p">[</span><span class="mi">880</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]],</span>
                      <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:01&lt;00:00, 20.24it/s]
</pre></div></div>
</div>
<p>Use <a class="reference external" href="https://seaborn.pydata.org/index.html">Seaborn</a> to visualize the spectra of a single pixel in one of the processed images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spatial-crop.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube before clipping</span>
<span class="n">meta_bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;spec_clip&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spec-clip.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem_clip</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube after clipping</span>
<span class="n">meta_bands_clip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Before spectral clipping&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_clip</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_clip</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;After spectral clipping&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.spectral_clip`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.spectral_clip`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_57_1.png" src="_images/tutorial_batch_57_1.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectral_mimic">
<h2><span class="section-number">7.11. </span><code class="docutils literal notranslate"><span class="pre">batch.spectral_mimic</span></code><a class="headerlink" href="#batch.spectral_mimic" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to spectrally mimic a multispectral sensor for multiple datacubes in the same way. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectral_mimic">[API]</a></p>
<p><strong>Note:</strong> The following example builds on the results of the <a class="reference external" href="tutorial_batch.html#batch.spatial_crop">batch.spatial_crop tutorial</a>. Please complete the <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> tutorial example to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>) is populated with multiple hyperspectral datacubes. The following example will be using datacubes located in the following directory: <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_crop</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_crop&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">batch.spectral_mimic</span></code> to spectrally mimic the Sentinel-2A multispectral satellite sensor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectral_mimic</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;spec_mimic&#39;</span><span class="p">,</span>
                       <span class="n">name_append</span><span class="o">=</span><span class="s1">&#39;sentinel-2a&#39;</span><span class="p">,</span>
                       <span class="n">sensor</span><span class="o">=</span><span class="s1">&#39;sentinel-2a&#39;</span><span class="p">,</span> <span class="n">center_wl</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">,</span>
                       <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:04&lt;00:00,  8.36it/s]
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> to visualize the spectra of a single pixel in one of the processed images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spatial-crop.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube before mimicking</span>
<span class="n">meta_bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;spec_mimic&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-sentinel-2a.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem_sen2a</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube after mimicking</span>
<span class="n">meta_bands_sen2a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hyperspectral (Pika II)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_sen2a</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_sen2a</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sentinel-2A &quot;mimic&quot;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.spectral_mimic`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.spectral_mimic`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_63_1.png" src="_images/tutorial_batch_63_1.png" />
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">spec_mod.spectral_mimic</span></code> to mimic the <a class="reference external" href="https://sentera.com/6x/">Sentera 6x spectral configuration</a> and compare to both hyperspectral and Sentinel-2A.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectral_mimic</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;spec_mimic&#39;</span><span class="p">,</span>
                       <span class="n">name_append</span><span class="o">=</span><span class="s1">&#39;sentera-6x&#39;</span><span class="p">,</span>
                       <span class="n">sensor</span><span class="o">=</span><span class="s1">&#39;sentera_6x&#39;</span><span class="p">,</span> <span class="n">center_wl</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">,</span>
                       <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;spec_mimic&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-sentera-6x.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem_6x</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube after mimicking</span>
<span class="n">meta_bands_6x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hyperspectral (Pika II)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_sen2a</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_sen2a</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sentinel-2A &quot;mimic&quot;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_6x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_6x</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sentera 6X &quot;mimic&quot;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.spectral_mimic`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:02&lt;00:00, 14.18it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.spectral_mimic`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_65_2.png" src="_images/tutorial_batch_65_2.png" />
</div>
</div>
<p>And finally, mimic the <a class="reference external" href="https://micasense.com/rededge-mx/">Micasense RedEdge-MX</a> and compare to hyperspectral, Sentinel-2A, and Sentera 6X.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectral_mimic</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;spec_mimic&#39;</span><span class="p">,</span>
                       <span class="n">name_append</span><span class="o">=</span><span class="s1">&#39;micasense-rededge-3&#39;</span><span class="p">,</span>
                       <span class="n">sensor</span><span class="o">=</span><span class="s1">&#39;micasense_rededge_3&#39;</span><span class="p">,</span> <span class="n">center_wl</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">,</span>
                       <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;spec_mimic&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-micasense-rededge-3.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem_re3</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube after mimicking</span>
<span class="n">meta_bands_re3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hyperspectral (Pika II)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_sen2a</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_sen2a</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sentinel-2A &quot;mimic&quot;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_6x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_6x</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sentera 6X &quot;mimic&quot;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_re3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_re3</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Micasense RedEdge 3 &quot;mimic&quot;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.spectral_mimic`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:02&lt;00:00, 14.13it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.spectral_mimic`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_67_2.png" src="_images/tutorial_batch_67_2.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectral_resample">
<h2><span class="section-number">7.12. </span><code class="docutils literal notranslate"><span class="pre">batch.spectral_resample</span></code><a class="headerlink" href="#batch.spectral_resample" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to spectrally resample (a.k.a. “bin”) multiple datacubes in the same way. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectral_resample">[API]</a></p>
<p><strong>Note:</strong> The following example builds on the results of the <a class="reference external" href="tutorial_batch.html#batch.spatial_crop">batch.spatial_crop tutorial</a>. Please complete the <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> tutorial example to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>) is populated with multiple hyperspectral datacubes. The following example will be using datacubes located in the following directory: <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_crop</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_crop&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">batch.spectral_resample</span></code> to bin (a.k.a., “group”) all spectral bands into 20 nm bandwidth bands (from ~2.3 nm bandwidth originally) on a per-pixel basis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectral_resample</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;spec_bin&#39;</span><span class="p">,</span>
                          <span class="n">name_append</span><span class="o">=</span><span class="s1">&#39;spec-bin-20&#39;</span><span class="p">,</span>
                          <span class="n">bandwidth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [00:00&lt;00:00, 55.20it/s]
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> to visualize the spectra of a single pixel in one of the processed images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spatial-crop.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube before resampling</span>
<span class="n">meta_bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;spec_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spec-bin-20.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem_bin</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube after resampling</span>
<span class="n">meta_bands_bin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hyperspectral (Pika II)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_bin</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_bin</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spectral resample (20 nm)&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.spectral_resample`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.spectral_resample`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_73_1.png" src="_images/tutorial_batch_73_1.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="batch.spectral_smooth">
<h2><span class="section-number">7.13. </span><code class="docutils literal notranslate"><span class="pre">batch.spectral_smooth</span></code><a class="headerlink" href="#batch.spectral_smooth" title="Permalink to this headline">¶</a></h2>
<p>Batch processing tool to spectrally smooth multiple datacubes in the same way. <a class="reference external" href="api/hs_process.batch.html#hs_process.batch.spectral_smooth">[API]</a></p>
<p><strong>Note:</strong> The following example builds on the results of the <a class="reference external" href="tutorial_batch.html#batch.spatial_crop">batch.spatial_crop tutorial</a>. Please complete the <code class="docutils literal notranslate"><span class="pre">batch.spatial_crop</span></code> tutorial example to be sure your directory (i.e., <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>) is populated with multiple hyperspectral datacubes. The following example will be using datacubes located in the following directory: <code class="docutils literal notranslate"><span class="pre">F:\\nigo0024\Documents\hs_process_demo\spatial_crop</span></code></p>
<p>Load and initialize the <code class="docutils literal notranslate"><span class="pre">batch</span></code> module, checking to be sure the directory exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">hs_process</span> <span class="kn">import</span> <span class="n">batch</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;spatial_crop&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_dir</span><span class="p">))</span>
<span class="n">hsbatch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">search_ext</span><span class="o">=</span><span class="s1">&#39;.bip&#39;</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># searches for all files in ``base_dir`` with a &quot;.bip&quot; file extension</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">batch.spectral_smooth</span></code> to perform a <em>Savitzky-Golay</em> smoothing operation on each image/pixel in <code class="docutils literal notranslate"><span class="pre">base_dir</span></code>. The <code class="docutils literal notranslate"><span class="pre">window_size</span></code> and <code class="docutils literal notranslate"><span class="pre">order</span></code> can be adjusted to achieve desired smoothing results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hsbatch</span><span class="o">.</span><span class="n">spectral_smooth</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;spec_smooth&#39;</span><span class="p">,</span>
                        <span class="n">window_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Processing file 39/40: 100%|████████████████████████████████████████████████████████████████████| 40/40 [01:00&lt;00:00,  1.52s/it]
</pre></div></div>
</div>
<p>Use <a class="reference external" href="https://seaborn.pydata.org/index.html">Seaborn</a> to visualize the spectra of a single pixel in one of the processed images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spatial-crop.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube before smoothing</span>
<span class="n">meta_bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;spec_smooth&#39;</span><span class="p">,</span> <span class="s1">&#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_1011-spec-smooth.bip&#39;</span><span class="p">)</span>
<span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="n">spy_mem_clip</span> <span class="o">=</span> <span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">open_memmap</span><span class="p">()</span>  <span class="c1"># datacube after smoothing</span>
<span class="n">meta_bands_clip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hsbatch</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Before spectral smoothing&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">meta_bands_clip</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">spy_mem_clip</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;After spectral smoothing&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance (%)&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;API Example: `batch.spectral_smooth`&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;API Example: `batch.spectral_smooth`&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_batch_79_1.png" src="_images/tutorial_batch_79_1.png" />
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019-2021, Tyler J. Nigon.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>