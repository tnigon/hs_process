<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="python">
  <head>
    <meta charset="utf-8" />
    <title>hs_process.utilities &#8212; hs_process 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          hs_process</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/tnigon/hs_process">Github</a></li>
                <li><a href="http://www.spectralpython.net/">Spectral Python</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../my_hs_process_api.html">1. API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html">2. License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../my_hs_process_api.html">1. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">2. License</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <h1>Source code for hs_process.utilities</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdal</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdalconst</span>
<span class="c1">#from osgeo import ogr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">spectral.io.envi</span> <span class="k">as</span> <span class="nn">envi</span>
<span class="kn">import</span> <span class="nn">spectral.io.spyfile</span> <span class="k">as</span> <span class="nn">SpyFile</span>
<span class="kn">import</span> <span class="nn">sys</span>


<div class="viewcode-block" id="defaults"><a class="viewcode-back" href="../../api/hs_process.utilities.defaults.html#hs_process.utilities.defaults">[docs]</a><span class="k">class</span> <span class="nc">defaults</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class containing all defaults for writing an ENVI datacube to file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dtype (``numpy.dtype`` or ``str``): The data type with which to store</span>
<span class="sd">            the image. For example, to store the image in 16-bit unsigned</span>
<span class="sd">            integer format, the argument could be any of numpy.uint16,</span>
<span class="sd">            &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=np.float32).</span>
<span class="sd">        force (``bool``): If ``hdr_file`` or its associated image file exist,</span>
<span class="sd">            ``force=True`` will overwrite the files; otherwise, an exception</span>
<span class="sd">            will be raised if either file exists (default=False).</span>
<span class="sd">        ext (``str``): The extension to use for saving the image file; if not</span>
<span class="sd">            specified, a default extension is determined based on the</span>
<span class="sd">            ``interleave``. For example, if ``interleave``=&#39;bip&#39;, then ``ext`` is</span>
<span class="sd">            set to &#39;bip&#39; as well. If ``ext`` is an empty string, the image</span>
<span class="sd">            file will have the same name as the .hdr, but without the</span>
<span class="sd">            &#39;.hdr&#39; extension (default: None).</span>
<span class="sd">        interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">            the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or &#39;bsq&#39;</span>
<span class="sd">            (default=&#39;bip&#39;).</span>
<span class="sd">        byteorder (``int`` or ``str``): Specifies the byte order (endian-ness)</span>
<span class="sd">            of the data as written to disk. For little endian, this value</span>
<span class="sd">            should be either 0 or &#39;little&#39;. For big endian, it should be</span>
<span class="sd">            either 1 or &#39;big&#39;. If not specified, native byte order will be</span>
<span class="sd">            used (default=None).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="n">force</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">interleave</span> <span class="o">=</span> <span class="s1">&#39;bip&#39;</span>
    <span class="n">byteorder</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">envi_write</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s1">&#39;force&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;interleave&#39;</span><span class="p">:</span> <span class="s1">&#39;bip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;byteorder&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="n">spat_crop_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;directory&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fname&#39;</span><span class="p">:</span> <span class="s1">&#39;fname&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name_short&#39;</span><span class="p">:</span> <span class="s1">&#39;name_short&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name_long&#39;</span><span class="p">:</span> <span class="s1">&#39;name_long&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="s1">&#39;ext&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pix_e_ul&#39;</span><span class="p">:</span> <span class="s1">&#39;pix_e_ul&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pix_n_ul&#39;</span><span class="p">:</span> <span class="s1">&#39;pix_n_ul&#39;</span><span class="p">,</span>
            <span class="s1">&#39;plot_id&#39;</span><span class="p">:</span> <span class="s1">&#39;plot_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;alley_size_e_m&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_e_m&#39;</span><span class="p">,</span>
            <span class="s1">&#39;alley_size_n_m&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_n_m&#39;</span><span class="p">,</span>
            <span class="s1">&#39;alley_size_e_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_e_pix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;alley_size_n_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_n_pix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;buf_e_m&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_e_m&#39;</span><span class="p">,</span>
            <span class="s1">&#39;buf_n_m&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_n_m&#39;</span><span class="p">,</span>
            <span class="s1">&#39;buf_e_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_e_pix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;buf_n_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_n_pix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;crop_e_m&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_e_m&#39;</span><span class="p">,</span>
            <span class="s1">&#39;crop_n_m&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_n_m&#39;</span><span class="p">,</span>
            <span class="s1">&#39;crop_e_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_e_pix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;crop_n_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_n_pix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;n_plots_x&#39;</span><span class="p">:</span> <span class="s1">&#39;n_plots_x&#39;</span><span class="p">,</span>
            <span class="s1">&#39;n_plots_y&#39;</span><span class="p">:</span> <span class="s1">&#39;n_plots_y&#39;</span><span class="p">,</span>
            <span class="s1">&#39;n_plots&#39;</span><span class="p">:</span> <span class="s1">&#39;n_plots&#39;</span><span class="p">}</span>

    <span class="n">crop_defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;name_short&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;name_long&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="s1">&#39;bip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pix_e_ul&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;pix_n_ul&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;alley_size_e_pix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># set to `None` because should be set</span>
            <span class="s1">&#39;alley_size_n_pix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># intentionally</span>
            <span class="s1">&#39;alley_size_e_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;alley_size_n_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;crop_e_pix&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
            <span class="s1">&#39;crop_n_pix&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
            <span class="s1">&#39;crop_e_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;crop_n_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;buf_e_pix&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;buf_n_pix&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;buf_e_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;buf_n_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;plot_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span></div>


<div class="viewcode-block" id="hsio"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio">[docs]</a><span class="k">class</span> <span class="nc">hsio</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading and writing hyperspectral data files and accessing,</span>
<span class="sd">    interpreting, and modifying its associated metadata.</span>

<span class="sd">    TODO: Create a temporary Spyfile using envi.create_imamge() and saving to a</span>
<span class="sd">        temporary location. This can be used to hold intermediate SpyFiles</span>
<span class="sd">        without actually saving them to disk.. (good idea?)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">str_plot</span><span class="o">=</span><span class="s1">&#39;plot_&#39;</span><span class="p">,</span> <span class="n">individual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">fname_hdr_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters:</span>
<span class="sd">            fname_in (``str``, optional): The filename of the image datacube to</span>
<span class="sd">                be read in initially.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">name_long</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="n">name_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">name_short</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str_plot</span> <span class="o">=</span> <span class="n">str_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">individual_plot</span> <span class="o">=</span> <span class="n">individual_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="n">fname_hdr_spec</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">fname_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname_hdr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_long</span><span class="p">,</span>
                           <span class="n">name_plot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span><span class="p">,</span>
                           <span class="n">name_short</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="p">,</span>
                           <span class="n">individual_plot</span><span class="o">=</span><span class="n">individual_plot</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>

    <span class="k">def</span> <span class="nf">_append_hdr_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Appends key and value to ENVI .hdr</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
<span class="c1">#        text_append = &#39;{0} = {1}\n&#39;.format(key, value)</span>
<span class="c1">#        if os.path.isfile(self.fname_in + &#39;.hdr&#39;):</span>
<span class="c1">#            fname_hdr = self.fname_in + &#39;.hdr&#39;</span>
<span class="c1">#        else:</span>
<span class="c1">#            fname_hdr = self.fname_in[:-4] + &#39;.hdr&#39;</span>
<span class="c1">#        with open(fname_hdr, &#39;a&#39;) as f:</span>
<span class="c1">#            f.write(text_append)</span>

    <span class="k">def</span> <span class="nf">_del_meta_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deletes metadata item from SpyFile object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">            key (``str``): dictionary key to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata (``dict``): Dictionary containing the modified metadata.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Please be sure to base a metadata dictionary.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="n">msg</span>
        <span class="k">try</span><span class="p">:</span>
<span class="c1">#            del metadata[key]</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="c1">#            val = None</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> not a valid key in input dictionary.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_get_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files), taking care to remove leading and trailing</span>
<span class="sd">        spaces.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be read; if ``None``, the whole list is</span>
<span class="sd">                returned (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata_list (``list`` or ``str``): List of metadata set items (as</span>
<span class="sd">                ``str``), or if idx is not ``None``, the item in the position</span>
<span class="sd">                described by ``idx``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">meta_set_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span>  <span class="c1"># return the whole thing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_modify_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifies metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files) by converting string to list, then adjusts the</span>
<span class="sd">        value of an item by its index.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be modified; if ``None``, the whole meta_set is</span>
<span class="sd">                returned (default: ``None``).</span>
<span class="sd">            value (``float``, ``int``, or ``str``): value to replace at idx</span>

<span class="sd">        Returns:</span>
<span class="sd">            set_str (``str``):</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_set</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">set_str</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metadata_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">return</span> <span class="n">set_str</span>

    <span class="k">def</span> <span class="nf">_parse_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">str_plot</span><span class="o">=</span><span class="s1">&#39;plot_&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parses the filename for ``name_long`` (text after the first dash,</span>
<span class="sd">        inclusive), ``name_short`` (text before the first dash), and ``name_plot``</span>
<span class="sd">        (numeric text following ``str_plot``).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): input filename.</span>
<span class="sd">            str_plot (``str``): text to search for that precedes the numeric text</span>
<span class="sd">                that describes the plot number.</span>
<span class="sd">            overwrite (``bool``): whether the class instances of ``name_long``,</span>
<span class="sd">                ``name_short``, and ``name_plot`` should be overwritten based on</span>
<span class="sd">                ``fname_in`` (default: ``True``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>  <span class="c1"># modify self.fname_in based on new file</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_name</span> <span class="o">=</span> <span class="n">base_name</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                    <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                    <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">base_name</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_plot</span><span class="p">):</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_pika&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># then it must have gone wrong</span>
                <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># give up..</span>
                <span class="n">name_plot</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="n">name_plot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># finds first &#39;-&#39; after last &#39;_&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">base_name</span>
                <span class="n">name_plot</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_plot</span><span class="p">):</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_pika&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># then it must have gone wrong</span>
                    <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># give up..</span>
                    <span class="n">name_plot</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="n">name_plot</span>

    <span class="k">def</span> <span class="nf">_read_envi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads ENVI file using Spectral Python; a package with streamlined</span>
<span class="sd">        features for hyperspectral IO, memory access, classification, and data</span>
<span class="sd">        display</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spec (``bool``): Whether the file to be read is an image (``False``) or</span>
<span class="sd">                a spectrum (``True``; default: ``False``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="c1">#            fname_hdr = self.fname_in + &#39;.hdr&#39;</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">envi</span><span class="o">.</span><span class="n">MissingEnviHeaderParameter</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># Resonon excludes</span>
                <span class="n">err</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="n">err</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">err</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;byte order&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_append_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">hstools</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">envi</span><span class="o">.</span><span class="n">MissingEnviHeaderParameter</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># Resonon excludes</span>
                <span class="n">err</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="n">err</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">err</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;byte order&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_append_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">hstools</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_envi_gdal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_in</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads and ENVI file via GDAL</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_in (``str``): filename of the ENVI file to read (not the .hdr;</span>
<span class="sd">                default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            img_ds (``GDAL object``): GDAL dataset containing the image</span>
<span class="sd">            infromation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;ENVI&#39;</span><span class="p">)</span>
        <span class="n">drv</span><span class="o">.</span><span class="n">Register</span><span class="p">()</span>
        <span class="n">img_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">fname_in</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img_ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Image not loaded. Check file path and try again.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img_ds</span>

    <span class="k">def</span> <span class="nf">_read_hdr_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads the .hdr file and returns a dictionary of the metadata</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): filename of .hdr file</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">):</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">),</span> <span class="s1">&#39;Could not find .hdr file.&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">regex1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(.+?)\s*=\s*({\s*.*?\n*.*?})$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="n">regex2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(.+?)\s*=\s*(.*?)$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">regex1</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="n">subhdr</span> <span class="o">=</span> <span class="n">regex1</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>  <span class="c1"># remove from line</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">regex2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">subhdr</span><span class="p">))</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_write_hdr_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Writes/overwrites an ENVI .hdr file from the beginning using a metadata</span>
<span class="sd">        dictionary.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): filename of .hdr file to write (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata (default: ``None``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ENVI</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_xstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function for safely returning an empty string (e.g., ``None``).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            s (``str`` or ``None``): the variable that may contain a string.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="hsio.read_cube"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.read_cube">[docs]</a>    <span class="k">def</span> <span class="nf">read_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">individual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads in a hyperspectral datacube</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (str): filename of datacube to be read (default: ``None``).</span>
<span class="sd">            name_long (str): Spectronon processing appends processing names to</span>
<span class="sd">                the filenames; this indicates those processing names that are</span>
<span class="sd">                repetitive and can be deleted from the filename following</span>
<span class="sd">                processing (default: ``None``).</span>
<span class="sd">            name_plot (``str``): numeric text that describes the plot number</span>
<span class="sd">                (default: ``None``).</span>
<span class="sd">            name_short (``str``): The base name of the image file (see note above</span>
<span class="sd">                about ``name_long``; default: ``None``).</span>
<span class="sd">            individual_plot (``bool``): Indicates whether image (and its</span>
<span class="sd">                filename) is for an individual plot (``True``), or for many plots</span>
<span class="sd">                (``False``; default: ``False``).</span>
<span class="sd">            overwrite (``bool``): Whether to overwrite any of the previous</span>
<span class="sd">                user-passed variables, including ``name_long``, ``name_plot``, and</span>
<span class="sd">                ``name_short``; any of the current user-passed variables will</span>
<span class="sd">                overwrite previous ones whether ``overwrite`` is ``True`` or</span>
<span class="sd">                ``False`` (default: ``False``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Basically resets static __init__ variables for the new filename</span>
        <span class="c1"># If variables are already set and overwrite is False, they will remain</span>
        <span class="c1"># the same; if variables are set and overwrite is True, they will be</span>
        <span class="c1"># overwritten</span>
<span class="c1">#        self._parse_fname(fname_hdr, self.str_plot, overwrite=overwrite)</span>

<span class="c1">#        if os.path.splitext(fname_hdr)[1] != &#39;.hdr&#39;:</span>
<span class="c1">#            fname_hdr = fname_hdr + &#39;.hdr&#39;</span>
<span class="c1">#            self.fname_hdr = fname_hdr</span>
<span class="c1">#</span>
<span class="c1">#        # The following ensures that user-passed variables have priority</span>
<span class="c1">#        if not os.path.isfile(fname_hdr):</span>
<span class="c1">#            fname_hdr = self.fname_in</span>
<span class="c1">#        if name_long is not None:</span>
<span class="c1">#            self.name_long = name_long</span>
<span class="c1">#        if name_plot is not None:</span>
<span class="c1">#            self.name_plot = name_plot</span>
<span class="c1">#        if name_short is not None:</span>
<span class="c1">#            self.name_short = name_short</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">),</span> <span class="s1">&#39;Could not find .hdr file.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">individual_plot</span> <span class="o">=</span> <span class="n">individual_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_envi</span><span class="p">()</span>

        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="n">basename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">basename</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[</span><span class="n">basename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">basename</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="hsio.read_spec"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.read_spec">[docs]</a>    <span class="k">def</span> <span class="nf">read_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr_spec</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads in a hyperspectral spectrum file</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr_spec (``str``): filename of spectra to be read.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="n">fname_hdr_spec</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">),</span> <span class="s1">&#39;Could not find .hdr file.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="n">fname_hdr_spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir_spec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_envi</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="n">basename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">basename</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[</span><span class="n">basename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">basename</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="hsio.set_io_defaults"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.set_io_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">set_io_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">interleave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets any of the ENVI file writing parameters to ``hsio``; if any</span>
<span class="sd">        parameter is left unchanged from its default, it will remain as-is</span>
<span class="sd">        (it will not be set).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dtype (``numpy.dtype`` or ``str``): The data type with which to store</span>
<span class="sd">                the image. For example, to store the image in 16-bit unsigned</span>
<span class="sd">                integer format, the argument could be any of numpy.uint16,</span>
<span class="sd">                &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=``False``).</span>
<span class="sd">            force (``bool``): If ``hdr_file`` or its associated image file exist,</span>
<span class="sd">                ``force=True`` will overwrite the files; otherwise, an exception</span>
<span class="sd">                will be raised if either file exists (default=``None``).</span>
<span class="sd">            ext (``str``): The extension to use for saving the image file; if not</span>
<span class="sd">                specified, a default extension is determined based on the</span>
<span class="sd">                ``interleave``. For example, if ``interleave``=&#39;bip&#39;, then ``ext`` is</span>
<span class="sd">                set to &#39;bip&#39; as well. If ``ext`` is an empty string, the image</span>
<span class="sd">                file will have the same name as the .hdr, but without the</span>
<span class="sd">                &#39;.hdr&#39; extension (default: ``False``).</span>
<span class="sd">            interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">                the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or &#39;bsq&#39;</span>
<span class="sd">                (default=``False``).</span>
<span class="sd">            byteorder (``int`` or ``str``): Specifies the byte order (endian-ness)</span>
<span class="sd">                of the data as written to disk. For little endian, this value</span>
<span class="sd">                should be either 0 or &#39;little&#39;. For big endian, it should be</span>
<span class="sd">                either 1 or &#39;big&#39;. If not specified, native byte order will be</span>
<span class="sd">                used (default=``False``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">force</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span>
        <span class="k">if</span> <span class="n">interleave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">interleave</span> <span class="o">=</span> <span class="n">interleave</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">=</span> <span class="n">byteorder</span></div>

<div class="viewcode-block" id="hsio.show_img"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.show_img">[docs]</a>    <span class="k">def</span> <span class="nf">show_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band_r</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">band_g</span><span class="o">=</span><span class="mi">76</span><span class="p">,</span> <span class="n">band_b</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                 <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Displays a datacube as a 3-band RGB image.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The data cube to</span>
<span class="sd">                display; if ``None``, loads from ``self.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            band_r (``int``): Band to display on the red channel (default: 120)</span>
<span class="sd">            band_g (``int``): Band to display on the green channel (default: 76)</span>
<span class="sd">            band_b (``int``): Band to display on the blue channel (default: 32)</span>
<span class="sd">            inline (``bool``): If ``True``, displays in the IPython console; else</span>
<span class="sd">                displays in a pop-out window (default: ``True``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">inline</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">n_bands</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">n_bands</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Only 2-D and 3-D arrays can be &#39;</span>
                                      <span class="s1">&#39;displayed.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="p">,</span> <span class="n">band_b</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">[</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="p">,</span> <span class="n">band_b</span><span class="p">]]</span><span class="o">*</span><span class="mf">5.0</span><span class="p">)</span>
<span class="c1">#            array_img_out = array_img[:, :, [band_r, band_g, band_b]]</span>
<span class="c1">#            array_img_out *= 3.5  # Images are very dark without this</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="c1">#            array_img_out = array_img</span>
<span class="c1">#            plt.imshow(array_img_out)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="hsio.write_cube"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.write_cube">[docs]</a>    <span class="k">def</span> <span class="nf">write_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function that accesses the Spectral Python package to save a</span>
<span class="sd">        datacube to file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): Output header file path (with the &#39;.hdr&#39;</span>
<span class="sd">                extension).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The hyperspectral</span>
<span class="sd">                datacube to save. If ``numpy.ndarray``, then metadata (``dict``)</span>
<span class="sd">                should also be passed.</span>
<span class="sd">            metadata (``dict``): Metadata to write to the ENVI .hdr file</span>
<span class="sd">                describing the hyperspectral data cube being saved. If</span>
<span class="sd">                ``SpyFile`` object is passed to ``spyfile``, ``metadata`` will</span>
<span class="sd">                overwrite any existing metadata stored by the ``SpyFile`` object</span>
<span class="sd">                (default=None).</span>
<span class="sd">            dtype (``numpy.dtype`` or ``str``): The data type with which to store</span>
<span class="sd">                the image. For example, to store the image in 16-bit unsigned</span>
<span class="sd">                integer format, the argument could be any of numpy.uint16,</span>
<span class="sd">                &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=None).</span>
<span class="sd">            force (``bool``): If ``hdr_file`` or its associated image file exist,</span>
<span class="sd">                ``force=True`` will overwrite the files; otherwise, an exception</span>
<span class="sd">                will be raised if either file exists (default=None).</span>
<span class="sd">            ext (``str``): The extension to use for saving the image file; if not</span>
<span class="sd">                specified, a default extension is determined based on the</span>
<span class="sd">                ``interleave``. For example, if ``interleave``=&#39;bip&#39;, then ``ext`` is</span>
<span class="sd">                set to &#39;bip&#39; as well. If ``ext`` is an empty string, the image</span>
<span class="sd">                file will have the same name as the .hdr, but without the</span>
<span class="sd">                &#39;.hdr&#39; extension (default: None).</span>
<span class="sd">            interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">                the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or &#39;bsq&#39;</span>
<span class="sd">                (default=None).</span>
<span class="sd">            byteorder (``int`` or ``str``): Specifies the byte order (endian-ness)</span>
<span class="sd">                of the data as written to disk. For little endian, this value</span>
<span class="sd">                should be either 0 or &#39;little&#39;. For big endian, it should be</span>
<span class="sd">                either 1 or &#39;big&#39;. If not specified, native byte order will be</span>
<span class="sd">                used (default=None).</span>

<span class="sd">        Note:</span>
<span class="sd">            If ``dtype``, ``force``, ``ext``, ``interleave``, and ``byteorder`` are not</span>
<span class="sd">            passed, default values will be pulled from ``hsio.defaults``. Thus,</span>
<span class="sd">            ``hsio.defaults`` can be modified prior to calling</span>
<span class="sd">            ``hsio.write_cube()`` to avoid having to pass each of thes parameters</span>
<span class="sd">            in the ``hsio.write_cube()`` function (see the</span>
<span class="sd">            ``hsio.set_io_defaults()`` function for support on setting these</span>
<span class="sd">            defaults and for more information on the parameters). Each of these</span>
<span class="sd">            parameters are passed directly to the Spectral Python</span>
<span class="sd">            ``envi.save_image()`` function. For more information, please refer to</span>
<span class="sd">            the Spectral Python documentation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">force</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">ext</span>
        <span class="k">if</span> <span class="n">interleave</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interleave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">interleave</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">byteorder</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">elif</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;`spyfile` of type `numpy.ndarray` was passed, so &#39;</span>
                            <span class="s1">&#39;`metadata` must not be `None`.&#39;</span><span class="p">)</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;interleave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interleave</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">clean_md_sets</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">envi</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                        <span class="n">interleave</span><span class="o">=</span><span class="n">interleave</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="n">byteorder</span><span class="p">,</span>
                        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="hsio.write_spec"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.write_spec">[docs]</a>    <span class="k">def</span> <span class="nf">write_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdr_file</span><span class="p">,</span> <span class="n">df_mean</span><span class="p">,</span> <span class="n">df_std</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
                   <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.spec&#39;</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="s1">&#39;bip&#39;</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function that accesses the Spectral Python package to save a</span>
<span class="sd">        single spectra to file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            hdr_file (``str``): Output header file path (with the &#39;.hdr&#39;</span>
<span class="sd">                extension).</span>
<span class="sd">            df_mean (``pandas.Series`` or ``numpy.ndarray``): Mean spectra, stored as a df row,</span>
<span class="sd">                where columns are the bands.</span>
<span class="sd">            df_std (``pandas.Series`` or ``numpy.ndarray``): Standard deviation of each spectra,</span>
<span class="sd">                stored as a df row, where columns are the bands. This will be</span>
<span class="sd">                saved to the .hdr file.</span>
<span class="sd">            dtype (``numpy.dtype`` or ``str``): The data type with which to store</span>
<span class="sd">                the image. For example, to store the image in 16-bit unsigned</span>
<span class="sd">                integer format, the argument could be any of numpy.uint16,</span>
<span class="sd">                &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=np.float32).</span>
<span class="sd">            force (``bool``): If ``hdr_file`` or its associated image file exist,</span>
<span class="sd">                ``force=True`` will overwrite the files; otherwise, an exception</span>
<span class="sd">                will be raised if either file exists (default=False).</span>
<span class="sd">            ext (``str``): The extension to use for saving the image file; if not</span>
<span class="sd">                specified, a default extension is determined based on the</span>
<span class="sd">                ``interleave``. For example, if ``interleave``=&#39;bip&#39;, then ``ext`` is</span>
<span class="sd">                set to &#39;bip&#39; as well. If ``ext`` is an empty string, the image</span>
<span class="sd">                file will have the same name as the .hdr, but without the</span>
<span class="sd">                &#39;.hdr&#39; extension (default: &#39;.spec&#39;).</span>
<span class="sd">            interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">                the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or &#39;bsq&#39;</span>
<span class="sd">                (default=&#39;bip&#39;).</span>
<span class="sd">            byteorder (``int`` or ``str``): Specifies the byte order (endian-ness)</span>
<span class="sd">                of the data as written to disk. For little endian, this value</span>
<span class="sd">                should be either 0 or &#39;little&#39;. For big endian, it should be</span>
<span class="sd">                either 1 or &#39;big&#39;. If not specified, native byte order will be</span>
<span class="sd">                used (default=None).</span>
<span class="sd">            metadata (``dict``): Metadata to write to the ENVI .hdr file</span>
<span class="sd">                describing the spectra being saved; if ``None``, will try to pull</span>
<span class="sd">                metadata template from self.spyfile.metadata (default=None).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">interleave</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">hdr_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">hdr_file</span> <span class="o">=</span> <span class="n">hdr_file</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;map info&#39;</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;coordinate system string&#39;</span><span class="p">)</span>
<span class="c1">#        metadata = self._del_meta_item(metadata, &#39;history&#39;)</span>
<span class="c1">#        metadata = self._del_meta_item(metadata, &#39;original cube file&#39;)</span>
<span class="c1">#        metadata = self._del_meta_item(metadata, &#39;pointlist&#39;)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;boundary&#39;</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;band names&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;wavelength&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">df_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df_std</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">df_std</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;stdev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">std</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">hdr_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">clean_md_sets</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">df_mean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">df_mean</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array_mean</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_mean</span><span class="p">))</span>
        <span class="n">envi</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">hdr_file</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="n">interleave</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                        <span class="n">byteorder</span><span class="o">=</span><span class="n">byteorder</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                        <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span></div>

<div class="viewcode-block" id="hsio.write_tif"><a class="viewcode-back" href="../../api/hs_process.utilities.hsio.html#hs_process.utilities.hsio.write_tif">[docs]</a>    <span class="k">def</span> <span class="nf">write_tif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_tif</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">projection_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geotransform_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function that accesses the GDAL Python package to save a</span>
<span class="sd">        small datacube subset (i.e., three bands or less) to file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_tif (``str``): Output image file path (with the &#39;.tif&#39;</span>
<span class="sd">                extension).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The data cube to</span>
<span class="sd">                save. If ``numpy.ndarray``, then metadata (``dict``) should also be</span>
<span class="sd">                passed.</span>
<span class="sd">            fname_in (``str``, optional): The filename of the image datacube to</span>
<span class="sd">                be read in initially.</span>
<span class="sd">            projection_out (``str``): (default: ``self.projection_out``)</span>
<span class="sd">            geotransform_out (``str``): (default: ``self.geotransform_out``)</span>
<span class="sd">            metadata (``dict``): Metadata information; if geotransform_out is not</span>
<span class="sd">                passed, &quot;map info&quot; is accessed from ``metadata`` and</span>
<span class="sd">                geotransform_out is created from that &quot;map info&quot;.</span>

<span class="sd">        TOOD:</span>
<span class="sd">            Use rasterio package instead of GDAL</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;The directory passed in `fname_tif` does not exist. Please be &#39;</span>
               <span class="s1">&#39;sure to create the directory prior to writing the geotif.</span><span class="se">\n</span><span class="s1">&#39;</span>
               <span class="s1">&#39;Try:</span><span class="se">\n</span><span class="s1">&#39;</span>
               <span class="s1">&#39;os.mkdir(os.path.dirname(fname_tif))&#39;</span>
               <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">msg</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="k">if</span> <span class="n">fname_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname_hdr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_long</span><span class="p">,</span>
                           <span class="n">name_plot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span><span class="p">,</span>
                           <span class="n">name_short</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="p">,</span>
                           <span class="n">individual_plot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">individual_plot</span><span class="p">,</span>
                           <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">projection_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">geotransform_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Either `projection_out` is `None` or `geotransform_out` is &#39;</span>
                  <span class="s1">&#39;`None` (or both are). Retrieving projection and &#39;</span>
                  <span class="s1">&#39;geotransform information by loading `self.fname_in` via &#39;</span>
                  <span class="s1">&#39;GDAL. Be sure this is appropriate for the data you are &#39;</span>
                  <span class="s1">&#39;trying to write.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">img_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_envi_gdal</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">projection_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">projection_out</span> <span class="o">=</span> <span class="n">img_ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">geotransform_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geotransform_out</span> <span class="o">=</span> <span class="n">img_ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">geotransform_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_set</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;map info&#39;</span><span class="p">]</span>
            <span class="n">ul_x_utm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">ul_y_utm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">size_x_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">size_y_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="c1"># Note the last pixel size must be negative to begin at upper left</span>
            <span class="n">geotransform_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">ul_x_utm</span><span class="p">,</span> <span class="n">size_x_m</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ul_y_utm</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="o">-</span><span class="n">size_y_m</span><span class="p">]</span>

        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
        <span class="n">drv</span><span class="o">.</span><span class="n">Register</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">bands</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bands</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">tif_out</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                 <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">)</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;GDAL driver was unable to successfully create the empty &#39;</span>
                   <span class="s1">&#39;geotiff; check to be sure the correct filename is being &#39;</span>
                   <span class="s1">&#39;passed: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">tif_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msg</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">projection_out</span><span class="p">)</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform_out</span><span class="p">)</span>

            <span class="n">band_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">460</span><span class="p">)</span>
            <span class="n">band_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>
            <span class="n">band_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">640</span><span class="p">)</span>
            <span class="n">band_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="p">,</span> <span class="n">band_b</span><span class="p">]</span>  <span class="c1"># backwards for RGB display</span>
<span class="c1">#            array_img = None</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">band_list</span><span class="p">):</span>
                <span class="n">array_band</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_band</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">array_band</span> <span class="o">=</span> <span class="n">array_band</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">array_band</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">array_band</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">band_out</span> <span class="o">=</span> <span class="n">tif_out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">array_band</span><span class="p">):</span>
                    <span class="n">array_band</span><span class="p">[</span><span class="n">array_band</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">band_out</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">band_out</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array_band</span><span class="p">)</span>  <span class="c1"># must flip</span>

<span class="c1">#                if array_img is None:</span>
<span class="c1">#                    array_img = array_band</span>
<span class="c1">#                else:</span>
<span class="c1">#                    array_img = np.dstack((array_img, array_band))  # stacks bands</span>
                <span class="n">band_out</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">band_r</span><span class="o">=</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="o">=</span><span class="n">band_g</span><span class="p">,</span>
                          <span class="n">band_b</span><span class="o">=</span><span class="n">band_b</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="n">inline</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">tif_out</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">)</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">projection_out</span><span class="p">)</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform_out</span><span class="p">)</span>
            <span class="n">band_out</span> <span class="o">=</span> <span class="n">tif_out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
                <span class="n">array</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">band_out</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">band_out</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="n">band_out</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="n">inline</span><span class="p">)</span>
<span class="c1">#        array_img = None</span>

        <span class="n">tif_out</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tif_out</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="hstools"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools">[docs]</a><span class="k">class</span> <span class="nc">hstools</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Basic tools for manipulating Spyfiles and accessing their metadata.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">            manipulated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pleae load a SpyFile (Spectral Python object)&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_bands</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_meta_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieves band number and wavelength information from metadata and</span>
<span class="sd">        saves as a dictionary</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube being</span>
<span class="sd">                accessed and/or manipulated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">meta_bands</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;band names&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]):</span>
                    <span class="n">meta_bands</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># &#39;wavelength&#39; is not a metadata key</span>
                <span class="k">pass</span>  <span class="c1"># meta_bands will just be empty</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">band_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">]))</span>
                <span class="n">wl_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">band_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">])))</span>
                <span class="n">wl_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])))</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">band_names</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">meta_bands</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">band_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wl_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">meta_bands</span><span class="p">[</span><span class="n">band_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wl_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span> <span class="o">=</span> <span class="n">meta_bands</span>

<div class="viewcode-block" id="hstools.clean_md_sets"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.clean_md_sets">[docs]</a>    <span class="k">def</span> <span class="nf">clean_md_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``, optional): Metadata dictionary to clean</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``dict``:</span>
<span class="sd">                **metadata_out** (``dict``) -- Cleaned metadata dictionary.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">metadata_out</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">set_str</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                <span class="n">metadata_out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_str</span>
        <span class="k">return</span> <span class="n">metadata_out</span></div>

<div class="viewcode-block" id="hstools.del_meta_item"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.del_meta_item">[docs]</a>    <span class="k">def</span> <span class="nf">del_meta_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deletes metadata item from SpyFile object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">            key (``str``): dictionary key to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``dict``:</span>
<span class="sd">                **metadata** (``dict``) -- Dictionary containing the modified</span>
<span class="sd">                metadata.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Please be sure to base a metadata dictionary.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="n">msg</span>
        <span class="k">try</span><span class="p">:</span>
<span class="c1">#            del metadata[key]</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="c1">#            val = None</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> not a valid key in input dictionary.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="hstools.get_band"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_band">[docs]</a>    <span class="k">def</span> <span class="nf">get_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_wl</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the band number of the closest target wavelength.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            target_wl (``int`` or ``float``): the target wavelength to retrieve the</span>
<span class="sd">                band number for (required).</span>
<span class="sd">            spyfile (``SpyFile`` object, optional): The datacube being accessed and/or</span>
<span class="sd">                manipulated; if ``None``, uses ``hstools.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``int``:</span>
<span class="sd">                **key_band** (``int``) -- band number of the closest target</span>
<span class="sd">                wavelength (``target_wl``).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; hstools.get_band(703, spyfile)</span>
<span class="sd">            151</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="n">val_target</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">target_wl</span><span class="p">))</span>
        <span class="n">key_band</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val_target</span><span class="p">)]</span>
<span class="c1">#        key_wavelength = sorted(list(self.meta_bands.values()))[key_band-1]</span>
        <span class="k">return</span> <span class="n">key_band</span></div>

<div class="viewcode-block" id="hstools.get_wavelength"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_wavelength">[docs]</a>    <span class="k">def</span> <span class="nf">get_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_band</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns actual wavelength of the closest target band.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            target_band (``int`` or ``float``): the target band to retrieve</span>
<span class="sd">                wavelength number for (required).</span>
<span class="sd">            spyfile (``SpyFile`` object, optional): The datacube being accessed and/or</span>
<span class="sd">                manipulated; if ``None``, uses ``hstools.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``float``:</span>
<span class="sd">                **key_wavelength** (``float``) -- wavelength of the closest</span>
<span class="sd">                target band (``target_band``).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; hstools.get_wavelength(151, spyfile)</span>
<span class="sd">            702.52</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="n">val_target</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">target_band</span><span class="p">))</span>
        <span class="n">key_wavelength</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val_target</span><span class="p">)]</span>
<span class="c1">#        key_wavelength = sorted(list(self.meta_bands.values()))[key_band-1]</span>
        <span class="k">return</span> <span class="n">key_wavelength</span></div>

<div class="viewcode-block" id="hstools.get_center_wl"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_center_wl">[docs]</a>    <span class="k">def</span> <span class="nf">get_center_wl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl_list</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wls</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets band numbers and mean wavelength from all wavelengths (or bands)</span>
<span class="sd">        in ``wl_list``.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wl_list (``list``): the list of bands to get information for</span>
<span class="sd">                (required).</span>
<span class="sd">            spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">                manipulated; if ``None``, uses ``hstools.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            wls (``bool``): whether wavelengths are passed in ``wl_list`` or if</span>
<span class="sd">                bands are passed in ``wl_list`` (default: ``True`` - wavelenghts</span>
<span class="sd">                passed).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **bands** (``list``): the list of bands (band number) corresponding</span>
<span class="sd">              to ``wl_list``.</span>
<span class="sd">            - **wls_mean** (``float``): the mean wavelength from ``wl_list``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;wl_list&quot; must be a list.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wl_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">wls</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">wl_list</span><span class="p">:</span>
                <span class="n">wl_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
                <span class="n">band_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="n">wl_i</span><span class="p">)</span>
                <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band_i</span><span class="p">)</span>
                <span class="n">wavelengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wl_i</span><span class="p">)</span>
            <span class="n">wls_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wl</span> <span class="ow">in</span> <span class="n">wl_list</span><span class="p">:</span>
                <span class="n">band_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span>
                <span class="n">wl_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_i</span><span class="p">)</span>
                <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band_i</span><span class="p">)</span>
                <span class="n">wavelengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wl_i</span><span class="p">)</span>
            <span class="n">wls_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bands</span><span class="p">,</span> <span class="n">wls_mean</span></div>

<div class="viewcode-block" id="hstools.get_band_index"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_band_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subtracts 1 from ``band_num`` and returns the band index(es).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            band_num (``int`` or ``list``): the target band number(s) to retrieve</span>
<span class="sd">            the band index for (required).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``int`` or ``list``:</span>
<span class="sd">                **band_idx** (``int``) -- band index of the passed band number</span>
<span class="sd">                (``band_num``).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; hstools.get_band_index([4, 43, 111])</span>
<span class="sd">            [3, 42, 110]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_num</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">band_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">band_num</span><span class="p">)</span>
            <span class="n">band_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">band_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">band_idx</span> <span class="o">=</span> <span class="n">band_num</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">band_idx</span></div>

<div class="viewcode-block" id="hstools.get_spectral_mean"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_spectral_mean">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectral_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_list</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets the spectral mean of a datacube from a list of bands</span>

<span class="sd">        Parameters:</span>
<span class="sd">            band_list (``list``): the list of bands to calculate the spectral</span>
<span class="sd">                mean for on the datacube (required).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube being</span>
<span class="sd">                accessed and/or manipulated; if ``None``, uses ``hstools.spyfile``</span>
<span class="sd">                (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``numpy.array`` or ``pandas.DataFrame``:</span>
<span class="sd">                **array_mean** (``numpy.array`` or ``pandas.DataFrame``): The</span>
<span class="sd">                mean reflectance from ``spyfile`` for the bands in ``band_list``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;band_list&quot; must be a list.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">band_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_index</span><span class="p">(</span><span class="n">band_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band_idx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="n">band_idx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">str_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">band_list</span><span class="p">)</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">band_list</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">str_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> type not supported.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array_mean</span></div>

<div class="viewcode-block" id="hstools.get_band_num"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_band_num">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_idx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds 1 to ``band_idx`` and returns the band number(s).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            band_idx (``int`` or ``list``): the target band index(es) to retrive</span>
<span class="sd">                the band number for (required).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``int`` or ``list``:</span>
<span class="sd">                **band_num** (``int`` or ``list``): band number of the passed</span>
<span class="sd">                band index (``band_idx``).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; hstools.get_band_num([4, 43, 111])</span>
<span class="sd">            [5, 44, 112]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_idx</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">band_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">band_idx</span><span class="p">)</span>
            <span class="n">band_num</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">band_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">band_num</span> <span class="o">=</span> <span class="n">band_idx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">band_num</span></div>

<div class="viewcode-block" id="hstools.get_band_range"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_band_range">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_wl</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieves the band index or band number for all bands within a</span>
<span class="sd">        wavelength range.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            range_wl (``list``): the minimum and maximum wavelength to consider;</span>
<span class="sd">                values should be ``int`` or ``float``.</span>
<span class="sd">            index (bool): Indicates whether to return the band number (min=1)</span>
<span class="sd">                or to return index number (min=0) (default: True)</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``list``:</span>
<span class="sd">                **band_list** (``list``): A list of all bands (either index or</span>
<span class="sd">                number, depending on how ``index`` is set) between a range in</span>
<span class="sd">                wavelength values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;range_wl&quot; must be a `list` or `tuple`.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_wl</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_wl</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span> <span class="n">msg</span>
        <span class="c1"># could also just take the min and max as long as it has at least 2..</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;range_wl&quot; must have exactly two items.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_wl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span>

        <span class="n">band_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">range_wl</span><span class="p">))</span>  <span class="c1"># gets closest band</span>
        <span class="n">band_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">range_wl</span><span class="p">))</span>
        <span class="n">wl_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_min</span><span class="p">)</span>
        <span class="n">wl_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wl_min</span> <span class="o">&lt;</span> <span class="n">range_wl</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># ensures its actually within the range</span>
            <span class="n">band_min</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">wl_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wl_max</span> <span class="o">&gt;</span> <span class="n">range_wl</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">band_max</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">wl_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">band_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_index</span><span class="p">(</span><span class="n">band_min</span><span class="p">)</span>
            <span class="n">band_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_index</span><span class="p">(</span><span class="n">band_max</span><span class="p">)</span>
        <span class="n">band_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">band_min</span><span class="p">,</span> <span class="n">band_max</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">band_list</span></div>

<div class="viewcode-block" id="hstools.get_meta_set"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_meta_set">[docs]</a>    <span class="k">def</span> <span class="nf">get_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files), taking care to remove leading and trailing</span>
<span class="sd">        spaces.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be read; if ``None``, the whole list is</span>
<span class="sd">                returned (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``list`` or ``str``:</span>
<span class="sd">                **metadata_list** (``list`` or ``str``): List of metadata set items</span>
<span class="sd">                (as ``str``), or if idx is not ``None``, the item in the position</span>
<span class="sd">                described by ``idx``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">meta_set_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span>  <span class="c1"># return the whole thing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

<div class="viewcode-block" id="hstools.get_UTM"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.get_UTM">[docs]</a>    <span class="k">def</span> <span class="nf">get_UTM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix_e_ul</span><span class="p">,</span> <span class="n">pix_n_ul</span><span class="p">,</span> <span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span><span class="p">,</span> <span class="n">size_x</span><span class="p">,</span> <span class="n">size_y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the new UTM coordinate of cropped plot to modify the</span>
<span class="sd">        &quot;map info&quot; tag of the .hdr file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            pix_e_ul (``int``): upper left column (easting) where image cropping</span>
<span class="sd">                begins.</span>
<span class="sd">            pix_n_ul (``int``): upper left row (northing) where image cropping</span>
<span class="sd">                begins.</span>
<span class="sd">            utm_x (``float``): UTM easting coordinates (meters) of the original</span>
<span class="sd">                image (from the upper left).</span>
<span class="sd">            utm_y (``float``): UTM northing coordinates (meters) of the original</span>
<span class="sd">                image (from the upper left).</span>
<span class="sd">            size_x (``float``): Ground resolved distance of the image pixels in</span>
<span class="sd">                the x (easting) direction (meters).</span>
<span class="sd">            size_y (``float``): Ground resolved distance of the image pixels in</span>
<span class="sd">                the y (northing) direction (meters).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **utm_x_new** (``float``): The modified UTM x coordinate (easting)</span>
<span class="sd">              of cropped plot.</span>
<span class="sd">            - **utm_y_new** (``float``): The modified UTM y coordinate (northing)</span>
<span class="sd">              of cropped plot.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">utm_x_new</span> <span class="o">=</span> <span class="n">utm_x</span> <span class="o">+</span> <span class="p">((</span><span class="n">pix_e_ul</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">size_x</span><span class="p">)</span>
        <span class="n">utm_y_new</span> <span class="o">=</span> <span class="n">utm_y</span> <span class="o">-</span> <span class="p">((</span><span class="n">pix_n_ul</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">size_y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">utm_x_new</span><span class="p">,</span> <span class="n">utm_y_new</span></div>

<div class="viewcode-block" id="hstools.load_spyfile"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.load_spyfile">[docs]</a>    <span class="k">def</span> <span class="nf">load_spyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Loads a ``SpyFile`` (Spectral Python object) for data access and/or</span>
<span class="sd">        manipulation by the ``hstools`` class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">                manipulated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_bands</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="hstools.mask_array"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.mask_array">[docs]</a>    <span class="k">def</span> <span class="nf">mask_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">side</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a masked numpy array based on a threshold value. If ``array`` is</span>
<span class="sd">        already a masked array, that mask is maintained and the new mask(s) is/</span>
<span class="sd">        are added to the original mask.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            array (``numpy.ndarray``): The data array to mask.</span>
<span class="sd">            thresh (``float`` or ``list``): The value for which to base the</span>
<span class="sd">                threshold; if ``thresh`` is ``list`` and ``side`` is ``None``, then</span>
<span class="sd">                all values in ``thresh`` will be masked; if ``thresh`` is ``list``</span>
<span class="sd">                and ``side`` is not ``None``, then only the first value in the</span>
<span class="sd">                list will be considered for thresholding (default: ``None``).</span>
<span class="sd">            percentile (``float``): The percentile of pixels to mask; if</span>
<span class="sd">                ``percentile``=95 and ``side``=&#39;lower&#39;, the lowest 95% of pixels</span>
<span class="sd">                will be masked prior to calculating the mean spectra across</span>
<span class="sd">                pixels (default: ``None``; range: 0-100).</span>
<span class="sd">            side (``str``): The side of the threshold for which to apply the</span>
<span class="sd">                mask. Must be either &#39;lower&#39;, &#39;upper&#39;, or ``None``; if &#39;lower&#39;,</span>
<span class="sd">                everything below the threshold will be masked; if ``None``, only</span>
<span class="sd">                the values that exactly match the threshol will be masked</span>
<span class="sd">                (default: &#39;lower&#39;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_mask** (``numpy.ndarray``): The masked ``numpy.ndarray``</span>
<span class="sd">              based on the passed threshold and/or percentile value.</span>
<span class="sd">            - **metadata** (``dict``): The modified metadata.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>  <span class="c1"># allows for accurate percentile calc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">array_m</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">percentile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">array</span><span class="p">,</span> <span class="n">metadata</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">side</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array_pctl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">array_m</span><span class="p">,</span> <span class="n">percentile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
                <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array_pctl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
                <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array_pctl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array_pctl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># side is None; thresh is float or int</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">)</span>

        <span class="n">mask_combine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">mask_array_p</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask_array_t</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mask_combine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">mask_combine</span><span class="p">,</span> <span class="n">array_m</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># array_m does not have a mask</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>  <span class="c1"># masks out invalid data (e.g., NaN, inf)</span>
        <span class="n">array_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_combine</span><span class="p">)</span>
        <span class="n">unmasked_pct</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">array_mask</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span>
                              <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1">#        print(&#39;Proportion unmasked pixels: {0:.2f}%&#39;.format(unmasked_pct))</span>

        <span class="k">if</span> <span class="n">side</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">side_str</span> <span class="o">=</span> <span class="s1">&#39;equal&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">side_str</span> <span class="o">=</span> <span class="n">side</span>
        <span class="n">hist_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; -&gt; hs_process.mask_array[&lt;&quot;</span>
                    <span class="s2">&quot;label: &#39;thresh?&#39; value:</span><span class="si">{0}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;percentile?&#39; value:</span><span class="si">{1}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;side?&#39; value:</span><span class="si">{2}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;unmasked_pct?&#39; value:</span><span class="si">{3}</span><span class="s2">&gt;]&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">side_str</span><span class="p">,</span> <span class="n">unmasked_pct</span><span class="p">))</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hist_str</span>
        <span class="k">return</span> <span class="n">array_mask</span><span class="p">,</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="hstools.mask_datacube"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.mask_datacube">[docs]</a>    <span class="k">def</span> <span class="nf">mask_datacube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        DO NOT USE; USE mean_datacube() INSTEAD AND PASS A MASK.</span>


<span class="sd">        Applies ``mask`` to ``spyfile``, then returns the datcube (as a np.array)</span>
<span class="sd">        and the mean spectra</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The hyperspectral</span>
<span class="sd">                datacube to mask.</span>
<span class="sd">            mask (``numpy.ndarray``): the mask to apply to ``spyfile``; if ``mask``</span>
<span class="sd">                does not have similar dimensions to ``spyfile``, the first band</span>
<span class="sd">                (i.e., first two dimensions) of ``mask`` will be repeated n times</span>
<span class="sd">                to match the number of bands of ``spyfile``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">mask_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask_2d</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">nbands</span><span class="p">):</span>
                <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_2d</span>

        <span class="n">datacube_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">spec_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">datacube_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">spec_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">datacube_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">spec_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">spec_mean</span><span class="p">)</span>
        <span class="n">spec_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">spec_std</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec_mean</span><span class="p">,</span> <span class="n">spec_std</span><span class="p">,</span> <span class="n">datacube_masked</span></div>

<div class="viewcode-block" id="hstools.mean_datacube"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.mean_datacube">[docs]</a>    <span class="k">def</span> <span class="nf">mean_datacube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the mean spectra for a datcube; if ``mask`` is passed (as a</span>
<span class="sd">        np.array), then the mask is applied to ``spyfile`` prior to computing</span>
<span class="sd">        the mean spectra.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The hyperspectral</span>
<span class="sd">                datacube to mask.</span>
<span class="sd">            mask (``numpy.ndarray``): the mask to apply to ``spyfile``; if ``mask``</span>
<span class="sd">                does not have similar dimensions to ``spyfile``, the first band</span>
<span class="sd">                (i.e., first two dimensions) of ``mask`` will be repeated n times</span>
<span class="sd">                to match the number of bands of ``spyfile``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            3-element ``tuple`` containing</span>

<span class="sd">            - **spec_mean** (``SpyFile.SpyFile`` object): The mean spectra from</span>
<span class="sd">              the input datacube.</span>
<span class="sd">            - **spec_std** (``SpyFile.SpyFile`` object): The standard deviation</span>
<span class="sd">              of the spectra from the input datacube.</span>
<span class="sd">            - **datacube_masked** (``numpy.ndarray``): The masked</span>
<span class="sd">              ``numpy.ndarray``; if ``mask`` = ``None``, ``datacube_masked`` is</span>
<span class="sd">              identical to the ``SpyFile`` data array.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">mask_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mask_2d</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">nbands</span><span class="p">):</span>
                    <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_2d</span>

        <span class="n">datacube_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">spec_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">datacube_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">spec_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">datacube_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">spec_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">spec_mean</span><span class="p">)</span>
        <span class="n">spec_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">spec_std</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec_mean</span><span class="p">,</span> <span class="n">spec_std</span><span class="p">,</span> <span class="n">datacube_masked</span></div>

<div class="viewcode-block" id="hstools.mask_shadow"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.mask_shadow">[docs]</a>    <span class="k">def</span> <span class="nf">mask_shadow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shadow_pctl</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">show_histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a ``numpy.mask`` of all pixels that are likely shadow pixels.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            shadow_pctl (``int``): the percentile of pixels in the image to mask</span>
<span class="sd">                (default: 20).</span>
<span class="sd">            show_histogram (``bool``):</span>
<span class="sd">            spyfile (``SpyFile.SpyFile`` object):</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_noshadow.mask** (``numpy.mask``): The mask indicating all</span>
<span class="sd">              pixels that are likely shadow pixels.</span>
<span class="sd">            - **metadata** (``dict``): The modified metadata.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">array_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">array_noshadow</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_array</span><span class="p">(</span>
                <span class="n">array_energy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="n">shadow_pctl</span><span class="p">,</span>
                <span class="n">side</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">show_histogram</span><span class="o">=</span><span class="n">show_histogram</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array_noshadow</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="hstools.modify_meta_set"><a class="viewcode-back" href="../../api/hs_process.utilities.hstools.html#hs_process.utilities.hstools.modify_meta_set">[docs]</a>    <span class="k">def</span> <span class="nf">modify_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifies metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files) by converting string to list, then adjusts the</span>
<span class="sd">        value of an item by its index.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be modified; if ``None``, the whole meta_set is</span>
<span class="sd">                returned (default: ``None``).</span>
<span class="sd">            value (``float``, ``int``, or ``str``): value to replace at idx</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``str``:</span>
<span class="sd">                **set_str** (``str``): Modified metadata set string.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">set_str</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metadata_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">return</span> <span class="n">set_str</span></div></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Tyler J. Nigon.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>