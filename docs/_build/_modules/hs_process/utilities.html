<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="python">
  <head>
    <meta charset="utf-8" />
    <title>hs_process.utilities &#8212; hs_process 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          hs_process</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/tnigon/hs_process">Github</a></li>
                <li><a href="http://www.spectralpython.net/">Spectral Python</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">1. Setup and Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial_hsio.html">2. Tutorial: <code class="docutils literal notranslate"><span class="pre">hsio</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial_hstools.html">3. Tutorial: <code class="docutils literal notranslate"><span class="pre">hstools</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial_segment.html">4. Tutorial: <code class="docutils literal notranslate"><span class="pre">segment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial_spec_mod.html">5. Tutorial: <code class="docutils literal notranslate"><span class="pre">spec_mod</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial_spatial_mod.html">6. Tutorial: <code class="docutils literal notranslate"><span class="pre">spatial_mod</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial_batch.html">7. Tutorial: <code class="docutils literal notranslate"><span class="pre">batch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../my_hs_process_api.html">8. API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.batch.html">8.1.1. batch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.defaults.html">8.1.2. defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.hsio.html">8.1.3. hsio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.hstools.html">8.1.4. hstools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.segment.html">8.1.5. segment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.spatial_mod.html">8.1.6. spatial_mod</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hs_process.spec_mod.html">8.1.7. spec_mod</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html">9. License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html">10. Change Log</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">1. Setup and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_hsio.html">2. Tutorial: <code class="docutils literal notranslate"><span class="pre">hsio</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_hstools.html">3. Tutorial: <code class="docutils literal notranslate"><span class="pre">hstools</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_segment.html">4. Tutorial: <code class="docutils literal notranslate"><span class="pre">segment</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_spec_mod.html">5. Tutorial: <code class="docutils literal notranslate"><span class="pre">spec_mod</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_spatial_mod.html">6. Tutorial: <code class="docutils literal notranslate"><span class="pre">spatial_mod</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_batch.html">7. Tutorial: <code class="docutils literal notranslate"><span class="pre">batch</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../my_hs_process_api.html">8. API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.batch.html">8.1.1. batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.defaults.html">8.1.2. defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.hsio.html">8.1.3. hsio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.hstools.html">8.1.4. hstools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.segment.html">8.1.5. segment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.spatial_mod.html">8.1.6. spatial_mod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.spec_mod.html">8.1.7. spec_mod</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">9. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">10. Change Log</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <h1>Source code for hs_process.utilities</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdalconst</span>
<span class="c1">#from osgeo import ogr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">spectral.io.envi</span> <span class="k">as</span> <span class="nn">envi</span>
<span class="kn">import</span> <span class="nn">spectral.io.spyfile</span> <span class="k">as</span> <span class="nn">SpyFile</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">plt_style</span> <span class="o">=</span> <span class="s1">&#39;seaborn-whitegrid&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">plt_style</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelweight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.latex.preamble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;\boldmath&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_dotdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;dot.notation access to dictionary attributes&#39;&#39;&#39;</span>
    <span class="fm">__getattr__</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span>
    <span class="fm">__setattr__</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span>
    <span class="fm">__delattr__</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span>


<div class="viewcode-block" id="defaults"><a class="viewcode-back" href="../../api/hs_process.defaults.html#hs_process.defaults">[docs]</a><span class="k">class</span> <span class="nc">defaults</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class containing default values and/or settings for various</span>
<span class="sd">    ``hs_process`` tools/functions.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_defaults</span> <span class="o">=</span> <span class="n">_dotdict</span><span class="p">({</span>
                <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;name_short&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;name_long&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="s1">&#39;bip&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pix_e_ul&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;pix_n_ul&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;alley_size_e_pix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># set to `None` because should be set</span>
                <span class="s1">&#39;alley_size_n_pix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># intentionally</span>
                <span class="s1">&#39;alley_size_e_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;alley_size_n_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;buf_e_pix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;buf_n_pix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;buf_e_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;buf_n_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;crop_e_pix&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                <span class="s1">&#39;crop_n_pix&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
                <span class="s1">&#39;crop_e_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;crop_n_m&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;plot_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Default values for performing spatial cropping on images. ``crop_defaults``</span>
<span class="sd">        is referenced by the ``spatial_mod.crop_single()`` function to get default</span>
<span class="sd">        values if various user-parameters are not passed or are left to ``None``.</span>
<span class="sd">        In this way, ``defaults.crop_defaults`` can be modified once by the user to</span>
<span class="sd">        avoid having to pass the same parameter(s) repeatedly if executing</span>
<span class="sd">        ``spatial_mod.crop_single()`` many times, such as in a for loop.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            crop_defaults.directory (``str``): File directory of the input image</span>
<span class="sd">                to be cropped (default: ``None``).</span>
<span class="sd">            crop_defaults.name_short (``str``): Part of the datacube name that is</span>
<span class="sd">                generally not repeated across many datacubes captured at the</span>
<span class="sd">                same time. In the ``name_long`` example above,</span>
<span class="sd">                ``name_short`` = &quot;plot_101_pika_gige_2&quot;. The part of the</span>
<span class="sd">                filename that is ``name_short`` should end with a dash (but</span>
<span class="sd">                should not include that dash as it belongs to ``name_long``;</span>
<span class="sd">                default: ``None``).</span>
<span class="sd">            crop_defaults.name_long (``str``): Part of the datacube name that tends</span>
<span class="sd">                to be long and is repeated across many datacubes captured at</span>
<span class="sd">                the same time. This is an artifact of Resonon/Spectronon</span>
<span class="sd">                software, and may be desireable to shorten and/or make more</span>
<span class="sd">                informative. For example, a datacube may have the following name:</span>
<span class="sd">                *&quot;plot_101_pika_gige_2-Radiance From Raw Data-Georectify Airborne Datacube-Reflectance from Radiance Data and Measured Reference Spectrum.bip&quot;*</span>
<span class="sd">                and another datacube captured in the same campaign may be named:</span>
<span class="sd">                *&quot;plot_102_pika_gige_1-Radiance From Raw Data-Georectify Airborne Datacube-Reflectance from Radiance Data and Measured Reference Spectrum.bip&quot;*</span>
<span class="sd">                ``name_long`` should refer to everything after the first dash</span>
<span class="sd">                (including the first dash) up to the file extension (&quot;.bip&quot;):</span>
<span class="sd">                ``name_long`` = *&quot;-Radiance From Raw Data-Georectify Airborne Datacube-Reflectance from Radiance Data and Measured Reference Spectrum&quot;*</span>
<span class="sd">                (default: ``None``).</span>
<span class="sd">            crop_defaults.ext (``str``): File extension to save the cropped image</span>
<span class="sd">                (default: &#39;bip&#39;).</span>
<span class="sd">            crop_defaults.pix_e_ul (``int``): upper left pixel column (easting) to</span>
<span class="sd">                begin cropping (default: 0).</span>
<span class="sd">            crop_defaults.pix_n_ul (``int``): upper left pixel row (northing) to</span>
<span class="sd">                begin cropping (default: 0).</span>
<span class="sd">            crop_defaults.buf_e_pix (``int``): The buffer distance in the easting</span>
<span class="sd">                direction (in pixel units) to be applied after calculating the</span>
<span class="sd">                original crop area (default: 0).</span>
<span class="sd">            crop_defaults.buf_n_pix (``int``): The buffer distance in the northing</span>
<span class="sd">                direction (in pixel units) to be applied after calculating the</span>
<span class="sd">                original crop area (default: 0).</span>
<span class="sd">            crop_defaults.buf_e_m (``float``): The buffer distance in the easting</span>
<span class="sd">                direction (in map units; e.g., meters) to be applied after</span>
<span class="sd">                calculating the original crop area; the buffer is considered</span>
<span class="sd">                after ``crop_X_m``/``crop_X_pix``. A positive value will</span>
<span class="sd">                reduce the size of ``crop_X_m``/``crop_X_pix``, and a</span>
<span class="sd">                negative value will increase it (default: ``None``).</span>
<span class="sd">            crop_defaults.buf_n_m (``float``): The buffer distance in the northing</span>
<span class="sd">                direction (in map units; e.g., meters) to be applied after</span>
<span class="sd">                calculating the original crop area; the buffer is considered</span>
<span class="sd">                after ``crop_X_m``/``crop_X_pix``. A positive value will</span>
<span class="sd">                reduce the size of ``crop_X_m``/``crop_X_pix``, and a</span>
<span class="sd">                negative value will increase it (default: ``None``).</span>
<span class="sd">            crop_defaults.crop_e_pix (``int``): number of pixels in each row in the</span>
<span class="sd">                cropped image (default: 90).</span>
<span class="sd">            crop_defaults.crop_n_pix (``int``): number of pixels in each column in</span>
<span class="sd">                the cropped image (default: 120).</span>
<span class="sd">            crop_defaults.crop_e_m (``float``): length of each row (easting</span>
<span class="sd">                direction) of the cropped image in map units (e.g., meters;</span>
<span class="sd">                default: ``None``).</span>
<span class="sd">            crop_defaults.crop_n_m (``float``): length of each column (northing</span>
<span class="sd">                direction) of the cropped image in map units (e.g., meters;</span>
<span class="sd">                default: ``None``).</span>
<span class="sd">            crop_defaults.plot_id (``int``): the plot ID of the area to be cropped</span>
<span class="sd">                (default: ``None``).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">envi_write</span> <span class="o">=</span> <span class="n">_dotdict</span><span class="p">({</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
                                    <span class="s1">&#39;force&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                    <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;interleave&#39;</span><span class="p">:</span> <span class="s1">&#39;bip&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;byteorder&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Attributes for writing ENVI datacubes to file, following the convention of</span>
<span class="sd">        the `Spectral Python`_ `envi.save_image()`_ parameter options for writing</span>
<span class="sd">        an ENVI datacube to file.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            envi_write.dtype (``numpy.dtype`` or ``str``): The data type with which</span>
<span class="sd">                to store the image. For example, to store the image in 16-bit</span>
<span class="sd">                unsigned integer format, the argument could be any of</span>
<span class="sd">                ``numpy.uint16``, ``&#39;u2&#39;``, ``&#39;uint16&#39;``, or ``&#39;H&#39;`` (default:</span>
<span class="sd">                ``np.float32``).</span>
<span class="sd">            envi_write.force (``bool``): If ``hdr_file`` or its associated image</span>
<span class="sd">                file exist, ``force=True`` will overwrite the files; otherwise, an</span>
<span class="sd">                exception will be raised if either file exists (default:</span>
<span class="sd">                ``False``).</span>
<span class="sd">            envi_write.ext (``str``): The extension to use for saving the image</span>
<span class="sd">                file; if not specified, a default extension is determined based on</span>
<span class="sd">                the ``interleave``. For example, if ``interleave``=&#39;bip&#39;, then</span>
<span class="sd">                ``ext`` is set to &#39;bip&#39; as well. If ``ext`` is an empty string, the</span>
<span class="sd">                image file will have the same name as the .hdr, but without the</span>
<span class="sd">                &#39;.hdr&#39; extension (default: ``None``).</span>
<span class="sd">            envi_write.interleave (``str``): The band interleave format to use for</span>
<span class="sd">                writing the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or</span>
<span class="sd">                &#39;bsq&#39; (default: &#39;bip&#39;).</span>
<span class="sd">            envi_write.byteorder (``int`` or ``str``): Specifies the byte order</span>
<span class="sd">                (endian-ness) of the data as written to disk. For little endian,</span>
<span class="sd">                this value should be either 0 or &#39;little&#39;. For big endian, it</span>
<span class="sd">                should be either 1 or &#39;big&#39;. If not specified, native byte order</span>
<span class="sd">                will be used (default: ``None``).</span>

<span class="sd">        .. _Spectral Python: http://www.spectralpython.net/</span>
<span class="sd">        .. _envi.save_image(): http://www.spectralpython.net/class_func_ref.html#spectral.io.envi.save_image</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spat_crop_cols</span> <span class="o">=</span> <span class="n">_dotdict</span><span class="p">({</span>
                <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;directory&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fname&#39;</span><span class="p">:</span> <span class="s1">&#39;fname&#39;</span><span class="p">,</span>
                <span class="s1">&#39;name_short&#39;</span><span class="p">:</span> <span class="s1">&#39;name_short&#39;</span><span class="p">,</span>
                <span class="s1">&#39;name_long&#39;</span><span class="p">:</span> <span class="s1">&#39;name_long&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="s1">&#39;ext&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pix_e_ul&#39;</span><span class="p">:</span> <span class="s1">&#39;pix_e_ul&#39;</span><span class="p">,</span>
                <span class="s1">&#39;pix_n_ul&#39;</span><span class="p">:</span> <span class="s1">&#39;pix_n_ul&#39;</span><span class="p">,</span>
                <span class="s1">&#39;alley_size_e_m&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_e_m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;alley_size_n_m&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_n_m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;alley_size_e_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_e_pix&#39;</span><span class="p">,</span>
                <span class="s1">&#39;alley_size_n_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;alley_size_n_pix&#39;</span><span class="p">,</span>
                <span class="s1">&#39;buf_e_m&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_e_m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;buf_n_m&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_n_m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;buf_e_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_e_pix&#39;</span><span class="p">,</span>
                <span class="s1">&#39;buf_n_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;buf_n_pix&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crop_e_m&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_e_m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crop_n_m&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_n_m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crop_e_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_e_pix&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crop_n_pix&#39;</span><span class="p">:</span> <span class="s1">&#39;crop_n_pix&#39;</span><span class="p">,</span>
                <span class="s1">&#39;plot_id&#39;</span><span class="p">:</span> <span class="s1">&#39;plot_id&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_plots_x&#39;</span><span class="p">:</span> <span class="s1">&#39;n_plots_x&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_plots_y&#39;</span><span class="p">:</span> <span class="s1">&#39;n_plots_y&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_plots&#39;</span><span class="p">:</span> <span class="s1">&#39;n_plots&#39;</span><span class="p">})</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Default column names for performing batch spatial cropping on</span>
<span class="sd">        images. Useful when batch processing images via `batch.spatial_crop()`_.</span>
<span class="sd">        ``batch.spatial_crop()`` takes a parameter ``fname_sheet``, which can be a</span>
<span class="sd">        filename to a spreadsheet or a ``pandas.DataFrame``.</span>
<span class="sd">        ``defaults.spat_crop_cols`` should be modified if the column names in</span>
<span class="sd">        ``fname_sheet`` are different than what is expected (see documentation for</span>
<span class="sd">        `batch.spatial_crop()`_ to know the expected column names).</span>

<span class="sd">        Attributes:</span>
<span class="sd">            spat_crop_cols.directory (``str``): column name for input directory</span>
<span class="sd">                (default: &#39;directory&#39;).</span>
<span class="sd">            spat_crop_cols.fname (``str``): column name for input fname</span>
<span class="sd">                (default: &#39;fname&#39;).</span>
<span class="sd">            spat_crop_cols.name_short (``str``): column name for input image&#39;s</span>
<span class="sd">                ``name_short`` (default: &#39;name_short&#39;).</span>
<span class="sd">            spat_crop_cols.name_long (``str``): column name for input image&#39;s</span>
<span class="sd">                ``name_long`` (default: &#39;name_long&#39;).</span>
<span class="sd">            spat_crop_cols.ext (``str``): column name for file extension of input</span>
<span class="sd">                image (default: &#39;ext&#39;).</span>
<span class="sd">            spat_crop_cols.pix_e_ul (``str``): column name for ``pix_e_ul``</span>
<span class="sd">                (default: &#39;pix_e_ul&#39;).</span>
<span class="sd">            spat_crop_cols.pix_n_ul (``str``): column name for ``pix_n_ul``</span>
<span class="sd">                (default: &#39;pix_n_ul&#39;).</span>
<span class="sd">            spat_crop_cols.alley_size_e_pix (``str``): column name for</span>
<span class="sd">                ``alley_size_e_pix`` (default: &#39;alley_size_e_pix&#39;).</span>
<span class="sd">            spat_crop_cols.alley_size_n_pix (``str``): column name for</span>
<span class="sd">                ``alley_size_n_pix`` (default: &#39;alley_size_n_pix&#39;).</span>
<span class="sd">            spat_crop_cols.alley_size_e_m (``str``): column name for</span>
<span class="sd">                ``alley_size_e_m`` (default: &#39;alley_size_e_m&#39;).</span>
<span class="sd">            spat_crop_cols.alley_size_n_m (``str``): column name for</span>
<span class="sd">                ``alley_size_n_m`` (default: &#39;alley_size_n_m&#39;).</span>
<span class="sd">            spat_crop_cols.buf_e_pix (``str``): column name for ``buf_e_pix``</span>
<span class="sd">                (default: &#39;buf_e_pix&#39;).</span>
<span class="sd">            spat_crop_cols.buf_n_pix (``str``): column name for ``buf_n_pix``</span>
<span class="sd">                (default: &#39;buf_n_pix&#39;).</span>
<span class="sd">            spat_crop_cols.buf_e_m (``str``): column name for ``buf_e_m`` (default:</span>
<span class="sd">                &#39;buf_e_m&#39;).</span>
<span class="sd">            spat_crop_cols.buf_n_m (``str``): column name for ``buf_n_m`` (default:</span>
<span class="sd">                &#39;buf_n_m&#39;).</span>
<span class="sd">            spat_crop_cols.crop_e_pix (``str``): column name for ``crop_e_pix``</span>
<span class="sd">                (default: &#39;crop_e_pix&#39;).</span>
<span class="sd">            spat_crop_cols.crop_n_pix (``str``): column name for ``crop_n_pix``</span>
<span class="sd">                (default: &#39;crop_n_pix&#39;).</span>
<span class="sd">            spat_crop_cols.crop_e_m (``str``): column name for ``crop_e_m``</span>
<span class="sd">                (default: &#39;crop_e_m&#39;).</span>
<span class="sd">            spat_crop_cols.crop_n_m (``str``): column name for ``crop_n_m``</span>
<span class="sd">                (default: &#39;crop_n_m&#39;).</span>
<span class="sd">            spat_crop_cols.plot_id (``str``): column name for ``plot_id``</span>
<span class="sd">                (default: &#39;crop_n_pix&#39;).</span>
<span class="sd">            spat_crop_cols.plot_id (``str``): column name for ``n_plots_x``</span>
<span class="sd">                (default: &#39;n_plots_x&#39;).</span>
<span class="sd">            spat_crop_cols.n_plots_y (``str``): column name for ``n_plots_y``</span>
<span class="sd">                (default: &#39;n_plots_y&#39;).</span>
<span class="sd">            spat_crop_cols.n_plots (``str``): column name for ``n_plots``</span>
<span class="sd">                (default: &#39;n_plots&#39;).</span>

<span class="sd">        .. _batch.spatial_crop(): hs_process.batch.html#hs_process.batch.spatial_crop</span>
<span class="sd">        &#39;&#39;&#39;</span></div>
<span class="c1">#    dtype = np.float32</span>
<span class="c1">#    force = False</span>
<span class="c1">#    ext = &#39;&#39;</span>
<span class="c1">#    interleave = &#39;bip&#39;</span>
<span class="c1">#    byteorder = 0</span>


<div class="viewcode-block" id="hsio"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio">[docs]</a><span class="k">class</span> <span class="nc">hsio</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading and writing hyperspectral data files, as well as</span>
<span class="sd">    accessing, interpreting, and modifying its associated metadata. With a</span>
<span class="sd">    hyperspectral data file loaded via ``hsio``, there is simple</span>
<span class="sd">    functionality to display the datacube image as a multi-band render, as</span>
<span class="sd">    well as for saving a datacube as a 3-band geotiff. ``hsio`` relies</span>
<span class="sd">    heavily on the `Spectral Python`_ package.</span>

<span class="sd">    .. _Spectral Python: http://www.spectralpython.net/</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">str_plot</span><span class="o">=</span><span class="s1">&#39;plot_&#39;</span><span class="p">,</span> <span class="n">individual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">fname_hdr_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters:</span>
<span class="sd">            fname_in (``str``, optional): The filename of the image datacube to</span>
<span class="sd">                be read in initially.</span>
<span class="sd">            name_long (``str``, optional): Part of the datacube name that tends</span>
<span class="sd">                to be long and is repeated across many datacubes captured at</span>
<span class="sd">                the same time. This is an artifact of Resonon/Spectronon</span>
<span class="sd">                software, and may be desireable to shorten and/or make more</span>
<span class="sd">                informative. For example, a datacube may have the following</span>
<span class="sd">                name:</span>
<span class="sd">                &quot;plot_101_pika_gige_2-Radiance From Raw Data-Georectify Airborne Datacube-Reflectance from Radiance Data and Measured Reference Spectrum.bip&quot;</span>
<span class="sd">                and another datacube captured in the same campaign may be</span>
<span class="sd">                named:</span>
<span class="sd">                &quot;plot_102_pika_gige_1-Radiance From Raw Data-Georectify Airborne Datacube-Reflectance from Radiance Data and Measured Reference Spectrum.bip&quot;</span>
<span class="sd">                ``name_long`` should refer to everything after the first dash</span>
<span class="sd">                (including the first dash) up to the file extension (&quot;.bip&quot;):</span>
<span class="sd">                ``name_long`` = &quot;-Radiance From Raw Data-Georectify Airborne Datacube-Reflectance from Radiance Data and Measured Reference Spectrum&quot;</span>
<span class="sd">                (default: ``None``).</span>
<span class="sd">            name_plot (``str``, optional): Part of the datacube name that</span>
<span class="sd">                refers to the plot name and/or ID. It usually includes &quot;plot&quot;</span>
<span class="sd">                in its name. In the ``name_long`` example above,</span>
<span class="sd">                ``name_plot`` = &quot;plot_101&quot; (default: ``None``).</span>
<span class="sd">            name_short (``str``, optional): Part of the datacube name that is</span>
<span class="sd">                generally not repeated across many datacubes captured at the</span>
<span class="sd">                same time. In the ``name_long`` example above,</span>
<span class="sd">                ``name_short`` = &quot;plot_101_pika_gige_2&quot;. The part of the</span>
<span class="sd">                filename that is ``name_short`` should end with a dash (but</span>
<span class="sd">                should not include that dash as it belongs to ``name_long``;</span>
<span class="sd">                default: ``None``).</span>
<span class="sd">            str_plot (``str``, optional): Part of ``name_plot`` that, when</span>
<span class="sd">                removed, should leave a numeric value that can be interpreted</span>
<span class="sd">                as an integer data type. In the ``name_plot`` example above, if</span>
<span class="sd">                &quot;plot_&quot; is removed from &quot;plot_101&quot;, &quot;101&quot; remains and can be</span>
<span class="sd">                interpreted as an integer using ``int(&quot;101&quot;)`` (default:</span>
<span class="sd">                &quot;plot_&quot;).</span>
<span class="sd">            individual_plot (``bool``, optional): Indicates whether the</span>
<span class="sd">                datacube (and its filename) is for an individual plot</span>
<span class="sd">                (``True``), or for many plots (``False``; default: ``False``).</span>
<span class="sd">            fname_hdr_spec (``str``, optional): The ``hsio`` class can also</span>
<span class="sd">                read in a &quot;spectrum&quot; (.spec) file (i.e., a hyperspectral file</span>
<span class="sd">                without any spatial infomation and only a single spectral</span>
<span class="sd">                profile; there is only a single &quot;pixel&quot;).</span>
<span class="sd">                ``fname_hdr_spec`` refers to the full file path of the spectrum</span>
<span class="sd">                file (default: ``None``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">name_long</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="n">name_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">name_short</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str_plot</span> <span class="o">=</span> <span class="n">str_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">individual_plot</span> <span class="o">=</span> <span class="n">individual_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="n">fname_hdr_spec</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">fname_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname_hdr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">name_long</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_long</span><span class="p">,</span>
                           <span class="n">name_short</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="p">,</span>
                           <span class="n">name_plot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span><span class="p">,</span>
                           <span class="n">individual_plot</span><span class="o">=</span><span class="n">individual_plot</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_append_hdr_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Appends key and value to ENVI .hdr</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
<span class="c1">#        text_append = &#39;{0} = {1}\n&#39;.format(key, value)</span>
<span class="c1">#        if os.path.isfile(self.fname_in + &#39;.hdr&#39;):</span>
<span class="c1">#            fname_hdr = self.fname_in + &#39;.hdr&#39;</span>
<span class="c1">#        else:</span>
<span class="c1">#            fname_hdr = self.fname_in[:-4] + &#39;.hdr&#39;</span>
<span class="c1">#        with open(fname_hdr, &#39;a&#39;) as f:</span>
<span class="c1">#            f.write(text_append)</span>

    <span class="k">def</span> <span class="nf">_del_meta_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deletes metadata item from SpyFile object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">            key (``str``): dictionary key to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata (``dict``): Dictionary containing the modified metadata.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Please be sure to base a metadata dictionary.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="n">msg</span>
        <span class="k">try</span><span class="p">:</span>
<span class="c1">#            del metadata[key]</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="c1">#            val = None</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> not a valid key in input dictionary.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_get_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files), taking care to remove leading and trailing</span>
<span class="sd">        spaces.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be read; if ``None``, the whole list is</span>
<span class="sd">                returned (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata_list (``list`` or ``str``): List of metadata set items (as</span>
<span class="sd">                ``str``), or if idx is not ``None``, the item in the position</span>
<span class="sd">                described by ``idx``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">meta_set_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span>  <span class="c1"># return the whole thing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_modify_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifies metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files) by converting string to list, then adjusts the</span>
<span class="sd">        value of an item by its index.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be modified; if ``None``, the whole meta_set is</span>
<span class="sd">                returned (default: ``None``).</span>
<span class="sd">            value (``float``, ``int``, or ``str``): value to replace at idx</span>

<span class="sd">        Returns:</span>
<span class="sd">            set_str (``str``):</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_set</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">set_str</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metadata_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">return</span> <span class="n">set_str</span>

    <span class="k">def</span> <span class="nf">_parse_fname_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_plot</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Code for parsing ``name_plot`` (numeric text following ``str_plot``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span>
        <span class="k">if</span> <span class="n">str_plot</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s1">&#39;_pika&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_plot</span><span class="p">):</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_pika&#39;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">str_plot</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s1">&#39;_pika&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_plot</span><span class="p">):</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>  <span class="c1"># then it must have gone wrong</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># then &#39;_pika&#39; must not</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># give up..</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Cannot determine the plot name from the image filename. &#39;</span>
                   <span class="s1">&#39;Setting `hsio.name_plot` to `None`. If this image is for &#39;</span>
                   <span class="s1">&#39;a particular plot, please set `hsio.name_plot; otherwise, &#39;</span>
                   <span class="s1">&#39;ignore this warning.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">name_plot</span>

    <span class="k">def</span> <span class="nf">_parse_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">str_plot</span><span class="o">=</span><span class="s1">&#39;plot_&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parses the filename for ``name_long`` (text after the first dash,</span>
<span class="sd">        inclusive), ``name_short`` (text before the first dash), and</span>
<span class="sd">        ``name_plot`` (numeric text following ``str_plot``).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): input filename.</span>
<span class="sd">            str_plot (``str``): text to search for that precedes the numeric</span>
<span class="sd">                text that describes the plot number.</span>
<span class="sd">            overwrite (``bool``): whether the class instances of ``name_long``,</span>
<span class="sd">                ``name_short``, and ``name_plot`` should be overwritten based</span>
<span class="sd">                on ``fname_in`` (default: ``True``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>  <span class="c1"># modify self.fname_in based on new file</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)</span>
<span class="c1">#        base_name = os.path.basename(fname_in)</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_name</span> <span class="o">=</span> <span class="n">base_name</span>

        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if name_long does not have ext, it can be just blank</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="c1"># and name_short can be base_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname_plot</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name_long</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">name_long</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if name_long does not have ext, it can be just blank</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">name_short</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">name_short</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">name_plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="n">name_plot</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname_plot</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_read_envi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads ENVI file using Spectral Python; a package with streamlined</span>
<span class="sd">        features for hyperspectral IO, memory access, classification, and data</span>
<span class="sd">        display</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spec (``bool``): Whether the file to be read is an image (``False``) or</span>
<span class="sd">                a spectrum (``True``; default: ``False``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="c1">#            fname_hdr = self.fname_in + &#39;.hdr&#39;</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">envi</span><span class="o">.</span><span class="n">MissingEnviHeaderParameter</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># Resonon excludes</span>
                <span class="n">err</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="n">err</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">err</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;byte order&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_append_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">hstools</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">envi</span><span class="o">.</span><span class="n">MissingEnviHeaderParameter</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># Resonon excludes</span>
                <span class="n">err</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="n">err</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">err</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;byte order&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_append_hdr_fname</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">hstools</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_envi_gdal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_in</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads and ENVI file via GDAL</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_in (``str``): filename of the ENVI file to read (not the .hdr;</span>
<span class="sd">                default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            img_ds (``GDAL object``): GDAL dataset containing the image</span>
<span class="sd">            infromation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;ENVI&#39;</span><span class="p">)</span>
        <span class="n">drv</span><span class="o">.</span><span class="n">Register</span><span class="p">()</span>
        <span class="n">img_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">fname_in</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img_ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Image not loaded. Check file path and try again.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img_ds</span>

    <span class="k">def</span> <span class="nf">_read_hdr_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads the .hdr file and returns a dictionary of the metadata</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): filename of .hdr file</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">):</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">),</span> <span class="s1">&#39;Could not find .hdr file.&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">regex1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(.+?)\s*=\s*({\s*.*?\n*.*?})$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="n">regex2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(.+?)\s*=\s*(.*?)$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">regex1</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="n">subhdr</span> <span class="o">=</span> <span class="n">regex1</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>  <span class="c1"># remove from line</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">regex2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">subhdr</span><span class="p">))</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_write_hdr_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Writes/overwrites an ENVI .hdr file from the beginning using a metadata</span>
<span class="sd">        dictionary.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): filename of .hdr file to write (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata (default: ``None``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ENVI</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_xstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function for safely returning an empty string (e.g., ``None``).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            s (``str`` or ``None``): the variable that may contain a string.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_fname_hdr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">interleave</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks to be sure .hdr filename follows that of the extension. There</span>
<span class="sd">        is an exception for .spec files because they are treated differently</span>
<span class="sd">        in Spectronon software.</span>

<span class="sd">        Order of operations:</span>

<span class="sd">        1. If ext is not set and filename doesn&#39;t appear to have an extension,</span>
<span class="sd">            use the interleave as the ext</span>
<span class="sd">        2. If ext is not set and filename has an extension, use the filename as</span>
<span class="sd">            the ext</span>
<span class="sd">        3. If ext is set, be sure fname follows; if so, no issues.</span>
<span class="sd">        4. Otherwise, if fname does not follow, use ext</span>
<span class="sd">        5. Else, use &quot;.bip.hdr&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">ext</span>
        <span class="k">if</span> <span class="n">interleave</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interleave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">interleave</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">file_wo_hdr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">file_wo_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_wo_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_wo_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span>
            <span class="n">file_wo_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_wo_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_wo_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># must use interleave</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">file_wo_ext</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">interleave</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_wo_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># use filename</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">file_wo_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_wo_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ext</span><span class="p">:</span>  <span class="c1"># both ext and file_wo_hdr are good</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">file_wo_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_wo_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ext</span><span class="p">:</span>  <span class="c1"># must use ext unless</span>
            <span class="k">if</span> <span class="n">ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">ext</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">file_wo_ext</span> <span class="o">+</span> <span class="n">ext</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">file_wo_ext</span> <span class="o">+</span> <span class="s1">&#39;.bip.hdr&#39;</span>
            <span class="c1"># if os.path.splitext(fname_hdr)[1] != &#39;.hdr&#39;:</span>
            <span class="c1">#     fname_hdr = file_wo_hdr + &#39;.hdr&#39;  # we know it includes ext</span>
        <span class="k">return</span> <span class="n">fname_hdr</span>
        <span class="c1"># if ext is None or ext == &#39;&#39;:</span>
        <span class="c1">#     if os.path.splitext(file_wo_ext)[1] == &#39;&#39;:  # must use interleave</span>
        <span class="c1">#         fname_hdr = file_wo_ext + &#39;.&#39; +\</span>
        <span class="c1">#                 interleave + &#39;.hdr&#39;</span>


    <span class="k">def</span> <span class="nf">_check_data_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;write_cube&#39;</span><span class="p">,</span> <span class="n">fname_out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ensures there is data present; if not, prints a warning and returns</span>
<span class="sd">        ``False``</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname_out</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">ncols</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">nrows</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">nbands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The size of ``spyfile`` is zero; thus there is nothing &#39;</span>
                      <span class="s1">&#39;to write to file and ``</span><span class="si">{0}</span><span class="s1">()`` is being &#39;</span>
                      <span class="s1">&#39;aborted.</span><span class="se">\n</span><span class="s1">Filename: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>  <span class="c1"># CAUTION: May take several seconds to laod spyfile as array</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All pixels in ``spyfile`` are null values (NaN); thus &#39;</span>
                      <span class="s1">&#39;``</span><span class="si">{0}</span><span class="s1">()`` is being aborted.</span><span class="se">\n</span><span class="s1">Filename: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span>
                      <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The size of ``spyfile`` is zero; thus there is nothing &#39;</span>
                      <span class="s1">&#39;to write to file and ``</span><span class="si">{0}</span><span class="s1">()`` is being &#39;</span>
                      <span class="s1">&#39;aborted.</span><span class="se">\n</span><span class="s1">Filename: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All pixels in ``spyfile`` are null values (NaN); thus &#39;</span>
                      <span class="s1">&#39;``</span><span class="si">{0}</span><span class="s1">()`` is being aborted.</span><span class="se">\n</span><span class="s1">Filename: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span>
                      <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">basename</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="hsio.read_cube"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.read_cube">[docs]</a>    <span class="k">def</span> <span class="nf">read_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">individual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads in a hyperspectral datacube using the `Spectral Python`_ package.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): filename of datacube to be read (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            overwrite (``bool``): Whether to overwrite any of the previous</span>
<span class="sd">                user-passed variables, including ``name_long``, ``name_plot``,</span>
<span class="sd">                and ``name_short``. If variables are already set and</span>
<span class="sd">                ``overwrite`` is ``False``, they will remain the same. If</span>
<span class="sd">                variables are set and ``overwrite`` is ``True``, they will be</span>
<span class="sd">                overwritten based on typcial file naming conventions of</span>
<span class="sd">                Resonon/Spectronon software. Any of the user-passed variables</span>
<span class="sd">                (e.g., ``name_long``, etc.) will overwrite those that were set</span>
<span class="sd">                previously whether ``overwrite`` is ``True`` or ``False``</span>
<span class="sd">                (default: ``False``).</span>
<span class="sd">            name_long (``str``): Spectronon processing appends processing names</span>
<span class="sd">                to the filenames; this indicates those processing names that</span>
<span class="sd">                are repetitive and can be deleted from the filename following</span>
<span class="sd">                processing (default: ``None``).</span>
<span class="sd">            name_short (``str``): The base name of the image file (see note</span>
<span class="sd">                above about ``name_long``; default: ``None``).</span>
<span class="sd">            name_plot (``str``): numeric text that describes the plot number</span>
<span class="sd">                (default: ``None``).</span>
<span class="sd">            individual_plot (``bool``): Indicates whether image (and its</span>
<span class="sd">                filename) is for an individual plot (``True``), or for many</span>
<span class="sd">                plots (``False``; default: ``False``).</span>

<span class="sd">        Note:</span>
<span class="sd">            ``hs_process`` will search for ``name_long``, ``name_plot``, and</span>
<span class="sd">            ``name_short`` based on typical file naming behavior of Resonon/</span>
<span class="sd">            Spectronon software. If any of these parameters are passed by the</span>
<span class="sd">            user, however, that will take precedence over &quot;searching the</span>
<span class="sd">            typical file nameing behavior&quot;.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize an instance of the hsio class (note there are no required parameters)</span>

<span class="sd">            Load datacube using ``hsio.read_cube``</span>

<span class="sd">            &gt;&gt;&gt; io.read_cube(fname_hdr)</span>
<span class="sd">            &gt;&gt;&gt; io.spyfile</span>
<span class="sd">            Data Source:   &#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip&#39;</span>
<span class="sd">        	# Rows:            617</span>
<span class="sd">        	# Samples:        1300</span>
<span class="sd">        	# Bands:           240</span>
<span class="sd">        	Interleave:        BIP</span>
<span class="sd">        	Quantization:  32 bits</span>
<span class="sd">        	Data format:   float32</span>

<span class="sd">            Check ``name_long``, ``name_short``, and ``name_plot`` values derived from the filename</span>

<span class="sd">            &gt;&gt;&gt; io.name_long</span>
<span class="sd">            &#39;-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum&#39;</span>

<span class="sd">            &gt;&gt;&gt; io.name_plot</span>
<span class="sd">            &#39;7&#39;</span>

<span class="sd">            &gt;&gt;&gt; io.name_short</span>
<span class="sd">            &#39;Wells_rep2_20180628_16h56m_pika_gige_7&#39;</span>

<span class="sd">        .. _Spectral Python: http://www.spectralpython.net/</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Could not find .hdr file.</span><span class="se">\n</span><span class="s1">Location: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">),</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">individual_plot</span> <span class="o">=</span> <span class="n">individual_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_envi</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str_plot</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                          <span class="n">name_long</span><span class="o">=</span><span class="n">name_long</span><span class="p">,</span> <span class="n">name_short</span><span class="o">=</span><span class="n">name_short</span><span class="p">,</span>
                          <span class="n">name_plot</span><span class="o">=</span><span class="n">name_plot</span><span class="p">)</span></div>

<div class="viewcode-block" id="hsio.read_spec"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.read_spec">[docs]</a>    <span class="k">def</span> <span class="nf">read_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads in a hyperspectral spectrum file using the using the `Spectral</span>
<span class="sd">        Python`_ package.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr_spec (``str``): filename of spectra to be read.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7_plot_611-cube-to-spec-mean.spec.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize an instance of the hsio class (note there are no required parameters)</span>

<span class="sd">            Load datacube using ``hsio.read_spec``</span>

<span class="sd">            &gt;&gt;&gt; io.read_spec(fname_hdr)</span>
<span class="sd">            &gt;&gt;&gt; io.spyfile_spec</span>
<span class="sd">            Data Source:   &#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7_plot_611-cube-to-spec-mean.spec&#39;</span>
<span class="sd">        	# Rows:              1</span>
<span class="sd">        	# Samples:           1</span>
<span class="sd">        	# Bands:           240</span>
<span class="sd">        	Interleave:        BIP</span>
<span class="sd">        	Quantization:  32 bits</span>
<span class="sd">        	Data format:   float32</span>

<span class="sd">            Check ``name_long``, ``name_short``, and ``name_plot`` values derived from the filename</span>

<span class="sd">            &gt;&gt;&gt; io.name_long</span>
<span class="sd">            &#39;-cube-to-spec-mean&#39;</span>

<span class="sd">            &gt;&gt;&gt; io.name_short</span>
<span class="sd">            &#39;Wells_rep2_20180628_16h56m_pika_gige_7_plot_611&#39;</span>

<span class="sd">            &gt;&gt;&gt; io.name_plot</span>
<span class="sd">            &#39;611&#39;</span>

<span class="sd">        .. _Spectral Python: http://www.spectralpython.net/</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
            <span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="n">fname_hdr_spec</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">),</span> <span class="s1">&#39;Could not find .hdr file.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="n">fname_hdr_spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir_spec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_envi</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str_plot</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                          <span class="n">name_long</span><span class="o">=</span><span class="n">name_long</span><span class="p">,</span> <span class="n">name_short</span><span class="o">=</span><span class="n">name_short</span><span class="p">,</span>
                          <span class="n">name_plot</span><span class="o">=</span><span class="n">name_plot</span><span class="p">)</span></div>
<span class="c1">#        basename = os.path.basename(fname_hdr_spec)</span>
<span class="c1">#        self.name_short = basename[:basename.find(&#39;-&#39;, basename.rfind(&#39;_&#39;))]</span>
<span class="c1">#        self.name_long = basename[basename.find(&#39;-&#39;, basename.rfind(&#39;_&#39;)):]</span>
<span class="c1">#        self.name_plot = self.name_short.rsplit(&#39;_&#39;, 1)[1]</span>

<div class="viewcode-block" id="hsio.set_io_defaults"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.set_io_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">set_io_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">interleave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets any of the ENVI file writing parameters to ``hsio``; if any</span>
<span class="sd">        parameter is left unchanged from its default, it will remain as-is</span>
<span class="sd">        (i.e., it will not be set).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dtype (``numpy.dtype`` or ``str``): The data type with which to store</span>
<span class="sd">                the image. For example, to store the image in 16-bit unsigned</span>
<span class="sd">                integer format, the argument could be any of numpy.uint16,</span>
<span class="sd">                &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=``False``).</span>
<span class="sd">            force (``bool``): If ``hdr_file`` or its associated image file exist,</span>
<span class="sd">                ``force=True`` will overwrite the files; otherwise, an exception</span>
<span class="sd">                will be raised if either file exists (default=``None``).</span>
<span class="sd">            ext (``str``): The extension to use for saving the image file; if not</span>
<span class="sd">                specified, a default extension is determined based on the</span>
<span class="sd">                ``interleave``. For example, if ``interleave``=&#39;bip&#39;, then ``ext`` is</span>
<span class="sd">                set to &#39;bip&#39; as well. If ``ext`` is an empty string, the image</span>
<span class="sd">                file will have the same name as the .hdr, but without the</span>
<span class="sd">                &#39;.hdr&#39; extension (default: ``False``).</span>
<span class="sd">            interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">                the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or &#39;bsq&#39;</span>
<span class="sd">                (default=``False``).</span>
<span class="sd">            byteorder (``int`` or ``str``): Specifies the byte order (endian-ness)</span>
<span class="sd">                of the data as written to disk. For little endian, this value</span>
<span class="sd">                should be either 0 or &#39;little&#39;. For big endian, it should be</span>
<span class="sd">                either 1 or &#39;big&#39;. If not specified, native byte order will be</span>
<span class="sd">                used (default=``False``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize an instance of the hsio class</span>

<span class="sd">            Check ``defaults.envi_write``</span>

<span class="sd">            &gt;&gt;&gt; io.defaults.envi_write</span>
<span class="sd">            {&#39;dtype&#39;: numpy.float32,</span>
<span class="sd">             &#39;force&#39;: False,</span>
<span class="sd">             &#39;ext&#39;: &#39;&#39;,</span>
<span class="sd">             &#39;interleave&#39;: &#39;bip&#39;,</span>
<span class="sd">             &#39;byteorder&#39;: 0}</span>

<span class="sd">            Modify ``force`` parameter and recheck ``defaults.envi_write``</span>

<span class="sd">            &gt;&gt;&gt; io.set_io_defaults(force=True)</span>
<span class="sd">            &gt;&gt;&gt; io.defaults.envi_write</span>
<span class="sd">            {&#39;dtype&#39;: numpy.float32,</span>
<span class="sd">             &#39;force&#39;: True,</span>
<span class="sd">             &#39;ext&#39;: &#39;&#39;,</span>
<span class="sd">             &#39;interleave&#39;: &#39;bip&#39;,</span>
<span class="sd">             &#39;byteorder&#39;: 0}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">force</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span>
        <span class="k">if</span> <span class="n">interleave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;interleave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interleave</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">interleave</span> <span class="o">=</span> <span class="n">interleave</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">byteorder</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">=</span> <span class="n">byteorder</span></div>

<div class="viewcode-block" id="hsio.show_img"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.show_img">[docs]</a>    <span class="k">def</span> <span class="nf">show_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band_r</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">band_g</span><span class="o">=</span><span class="mi">76</span><span class="p">,</span> <span class="n">band_b</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                 <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Displays a datacube as a 3-band RGB image using `Matplotlib`_.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The data cube to</span>
<span class="sd">                display; if ``None``, loads from ``self.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            band_r (``int``): Band to display on the red channel (default: 120)</span>
<span class="sd">            band_g (``int``): Band to display on the green channel (default:</span>
<span class="sd">                76)</span>
<span class="sd">            band_b (``int``): Band to display on the blue channel (default: 32)</span>
<span class="sd">            vmin/vmax (``scalar``, optional): The data range that the colormap</span>
<span class="sd">                covers. By default, the colormap covers the complete value</span>
<span class="sd">                range of the supplied data (default: ``None``).</span>
<span class="sd">            cmap (``str``): The Colormap instance or registered colormap name</span>
<span class="sd">                used to map scalar data to colors. This parameter is ignored</span>
<span class="sd">                for RGB(A) data (default: &quot;viridis&quot;).</span>
<span class="sd">            cbar (``bool``): Whether to include a colorbar in the image</span>
<span class="sd">                (default: ``True``).</span>
<span class="sd">            inline (``bool``): If ``True``, displays in the IPython console;</span>
<span class="sd">                else displays in a pop-out window (default: ``True``).</span>

<span class="sd">        Note:</span>
<span class="sd">            The `inline` parameter points to the `hsio.show_img` function, and</span>
<span class="sd">            is only expected to work in an IPython console (not intended to be</span>
<span class="sd">            used in a normal Python console).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``spatial_mod`` modules</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio # load hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import spatial_mod # load spatial mod</span>

<span class="sd">            Load the datacube using ``hsio.read_cube``</span>

<span class="sd">            &gt;&gt;&gt; fname_hdr = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize an instance of the hsio class</span>
<span class="sd">            &gt;&gt;&gt; io.read_cube(fname_hdr)</span>

<span class="sd">            Perform simple spatial cropping via ``spatial_mod.crop_single``</span>

<span class="sd">            &gt;&gt;&gt; my_spatial_mod = spatial_mod(io.spyfile)  # initialize spatial_mod instance to crop the image</span>
<span class="sd">            &gt;&gt;&gt; array_crop, metadata = my_spatial_mod.crop_single(pix_e_ul=250, pix_n_ul=100, crop_e_m=8, crop_n_m=3)</span>

<span class="sd">            Show an RGB render of the cropped image using ``hsio.show_img``</span>

<span class="sd">            &gt;&gt;&gt; io.show_img(array_crop)</span>

<span class="sd">            .. image:: ../img/utilities/show_img.png</span>

<span class="sd">        .. _Matplotlib: https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.imshow.html#</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># if inline is True:</span>
        <span class="c1">#     get_ipython().run_line_magic(&#39;matplotlib&#39;, &#39;inline&#39;)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         get_ipython().run_line_magic(&#39;matplotlib&#39;, &#39;auto&#39;)</span>
        <span class="c1">#     except ModuleNotFoundError:</span>
        <span class="c1">#         pass  # just go with whatever is already set</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">n_bands</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">n_bands</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Only 2-D and 3-D arrays can be &#39;</span>
                                      <span class="s1">&#39;displayed.&#39;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">n_bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
<span class="c1">#                plt.imshow(array, (band_r, band_g, band_b))</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="p">,</span> <span class="n">band_b</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="c1">#                plt.imshow(array[:, :, [band_r, band_g, band_b]]*5.0)</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">[</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="p">,</span> <span class="n">band_b</span><span class="p">]]</span><span class="o">*</span><span class="mf">5.0</span><span class="p">)</span>
<span class="c1">#            array_img_out = array_img[:, :, [band_r, band_g, band_b]]</span>
<span class="c1">#            array_img_out *= 3.5  # Images are very dark without this</span>

        <span class="k">elif</span> <span class="n">n_bands</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="c1">#            ax.imshow(array, vmin=vmin, vmax=vmax)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
<span class="c1">#            plt.imshow(array, vmin=vmin, vmax=vmax)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cbar</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">n_bands</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">my_cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1">#        fig.show()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<span class="c1">#lowerBound = 0.25</span>
<span class="c1">#upperBound = 0.75</span>
<span class="c1">#myMatrix = np.random.rand(100,100)</span>
<span class="c1">#</span>
<span class="c1">#myMatrix =np.ma.masked_where((lowerBound &lt; myMatrix) &amp;</span>
<span class="c1">#                             (myMatrix &lt; upperBound), myMatrix)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#fig,axs=plt.subplots(2,1)</span>
<span class="c1">##Plot without mask</span>
<span class="c1">#axs[0].imshow(myMatrix.data)</span>
<span class="c1">#</span>
<span class="c1">##Default is to apply mask</span>
<span class="c1">#axs[1].imshow(myMatrix.mask)</span>
<span class="c1">#</span>
<span class="c1">#plt.show()</span>

<div class="viewcode-block" id="hsio.write_cube"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.write_cube">[docs]</a>    <span class="k">def</span> <span class="nf">write_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function that accesses the `Spectral Python`_ package to save a</span>
<span class="sd">        datacube to file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): Output header file path (with the &#39;.hdr&#39;</span>
<span class="sd">                extension).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The hyperspectral</span>
<span class="sd">                datacube to save. If ``numpy.ndarray``, then metadata (``dict``)</span>
<span class="sd">                should also be passed.</span>
<span class="sd">            metadata (``dict``): Metadata to write to the ENVI .hdr file</span>
<span class="sd">                describing the hyperspectral data cube being saved. If</span>
<span class="sd">                ``SpyFile`` object is passed to ``spyfile``, ``metadata`` will</span>
<span class="sd">                overwrite any existing metadata stored by the ``SpyFile``</span>
<span class="sd">                object (default=None).</span>
<span class="sd">            dtype (``numpy.dtype`` or ``str``): The data type with which to</span>
<span class="sd">                store the image. For example, to store the image in 16-bit</span>
<span class="sd">                unsigned integer format, the argument could be any of</span>
<span class="sd">                numpy.uint16, &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=np.float32).</span>
<span class="sd">            force (``bool``): If ``hdr_file`` or its associated image file</span>
<span class="sd">                exist, ``force=True`` will overwrite the files; otherwise, an</span>
<span class="sd">                exception will be raised if either file exists (default=False).</span>
<span class="sd">            ext (``None`` or ``str``): The extension to use for saving the</span>
<span class="sd">                image file. If not specified or if set to an empty string</span>
<span class="sd">                (e.g., ``ext=&#39;&#39;``), a default extension is determined using the</span>
<span class="sd">                same name as ``fname_hdr``, except without the &quot;.hdr&quot;</span>
<span class="sd">                extension. If ``fname_hdr`` is provided without the</span>
<span class="sd">                &quot;non-.hdr&quot; extension (e.g., &quot;bip&quot;), then the extension is</span>
<span class="sd">                determined from the ``interleave`` parameter. For example, if</span>
<span class="sd">                ``interleave``=&#39;bip&#39;, then ``ext`` is set to &#39;bip&#39; as well. Use</span>
<span class="sd">                of ``ext`` is not recommended; instead, just set</span>
<span class="sd">                ``fname_hdr`` with the correct extension or use</span>
<span class="sd">                ``interleave`` to set the extension (default: ``None``;</span>
<span class="sd">                determined from ``fname_hdr`` or ``interleave``).</span>
<span class="sd">            interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">                the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or</span>
<span class="sd">                &#39;bsq&#39; (default=&#39;bip&#39;).</span>
<span class="sd">            byteorder (``int`` or ``str``): Specifies the byte order</span>
<span class="sd">                (endian-ness) of the data as written to disk. For little</span>
<span class="sd">                endian, this value should be either 0 or &#39;little&#39;. For big</span>
<span class="sd">                endian, it should be either 1 or &#39;big&#39;. If not specified,</span>
<span class="sd">                native byte order will be used (default=None).</span>

<span class="sd">        Note:</span>
<span class="sd">            If ``dtype``, ``force``, ``ext``, ``interleave``, and ``byteorder`` are not</span>
<span class="sd">            passed, default values will be pulled from ``hsio.defaults``. Thus,</span>
<span class="sd">            ``hsio.defaults`` can be modified prior to calling</span>
<span class="sd">            ``hsio.write_cube()`` to avoid having to pass each of thes parameters</span>
<span class="sd">            in the ``hsio.write_cube()`` function (see the</span>
<span class="sd">            ``hsio.set_io_defaults()`` function for support on setting these</span>
<span class="sd">            defaults and for more information on the parameters). Each of these</span>
<span class="sd">            parameters are passed directly to the Spectral Python</span>
<span class="sd">            ``envi.save_image()`` function. For more information, please refer to</span>
<span class="sd">            the Spectral Python documentation.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``spatial_mod`` modules</span>

<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import hsio  # load hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import spatial_mod  # load spatial mod</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize the hsio class</span>
<span class="sd">            &gt;&gt;&gt; io.read_cube(fname_hdr_in)</span>

<span class="sd">            Perform simple spatial cropping via ``spatial_mod.crop_single`` to generate a new datacube.</span>

<span class="sd">            &gt;&gt;&gt; my_spatial_mod = spatial_mod(io.spyfile)  # initialize spatial_mod instance to crop the image</span>
<span class="sd">            &gt;&gt;&gt; array_crop, metadata = my_spatial_mod.crop_single(pix_e_ul=250, pix_n_ul=100, crop_e_m=8, crop_n_m=3)</span>

<span class="sd">            Save the datacube using ``hsio.write_cube``</span>

<span class="sd">            &gt;&gt;&gt; fname_hdr = r&#39;F:\\nigo0024\Documents\hs_process_demo\hsio\Wells_rep2_20180628_16h56m_pika_gige_7-hsio-write-cube-cropped.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; os.mkdir(os.path.dirname(fname_hdr))</span>
<span class="sd">            &gt;&gt;&gt; io.write_cube(fname_hdr, array_crop, metadata=metadata)</span>
<span class="sd">            Saving F:\nigo0024\Documents\hs_process_demo\hsio\Wells_rep2_20180628_16h56m_pika_gige_7-hsio-write-cube-cropped.bip</span>

<span class="sd">            Load the datacube into Spectronon for visualization</span>

<span class="sd">            .. image:: ../img/utilities/write_cube.png</span>

<span class="sd">        .. _Spectral Python: http://www.spectralpython.net/</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_size</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;write_cube&#39;</span><span class="p">,</span>
                                 <span class="n">fname_out</span><span class="o">=</span><span class="n">fname_hdr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#            dtype = self.defaults.envi_write[&#39;dtype&#39;]</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#            force = self.defaults.envi_write[&#39;force&#39;]</span>
            <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">force</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#            ext = self.defaults.envi_write[&#39;ext&#39;]</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">ext</span>
        <span class="k">if</span> <span class="n">interleave</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#            interleave = self.defaults.envi_write[&#39;interleave&#39;]</span>
            <span class="n">interleave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">interleave</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#            byteorder = self.defaults.envi_write[&#39;byteorder&#39;]</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="o">.</span><span class="n">byteorder</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">elif</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;`spyfile` of type `numpy.ndarray` was passed, so &#39;</span>
                            <span class="s1">&#39;`metadata` must not be `None`.&#39;</span><span class="p">)</span>

        <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fname_hdr</span><span class="p">(</span>
                <span class="n">fname_hdr</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="n">interleave</span><span class="p">)</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;interleave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interleave</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">clean_md_sets</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">envi</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                            <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="n">interleave</span><span class="p">,</span>
                            <span class="n">byteorder</span><span class="o">=</span><span class="n">byteorder</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">envi</span><span class="o">.</span><span class="n">EnviException</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Header file already exists: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">Use the `force` keyword &#39;</span>
                   <span class="s1">&#39;to force overwrite.</span><span class="se">\n</span><span class="s1">``hsio.set_io_defaults(force=True)`` &#39;</span>
                   <span class="s1">&#39;will adjust the default setting so existing files are &#39;</span>
                   <span class="s1">&#39;overwritten by default without passing the `force` &#39;</span>
                   <span class="s1">&#39;keyword&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">envi</span><span class="o">.</span><span class="n">EnviException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="hsio.write_spec"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.write_spec">[docs]</a>    <span class="k">def</span> <span class="nf">write_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="n">df_mean</span><span class="p">,</span> <span class="n">df_std</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function that accesses the `Spectral Python`_ package to save a</span>
<span class="sd">        single spectra to file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr_spec (``str``): Output header file path (with the &#39;.hdr&#39;</span>
<span class="sd">                extension). If the extension is explicitely specified in</span>
<span class="sd">                ``fname_hdr_spec`` and the ``ext`` parameter is also specified,</span>
<span class="sd">                ``fname_hdr_spec`` will be modified to conform to the extension</span>
<span class="sd">                set using the ``ext`` parameter.</span>
<span class="sd">            df_mean (``pandas.Series`` or ``numpy.ndarray``): Mean spectra,</span>
<span class="sd">                stored as a df row, where columns are the bands.</span>
<span class="sd">            df_std (``pandas.Series`` or ``numpy.ndarray``): Standard deviation</span>
<span class="sd">                of each spectra, stored as a df row, where columns are the</span>
<span class="sd">                bands. This will be saved to the .hdr file.</span>
<span class="sd">            dtype (``numpy.dtype`` or ``str``): The data type with which to</span>
<span class="sd">                store the image. For example, to store the image in 16-bit</span>
<span class="sd">                unsigned integer format, the argument could be any of</span>
<span class="sd">                numpy.uint16, &#39;u2&#39;, &#39;uint16&#39;, or &#39;H&#39; (default=np.float32).</span>
<span class="sd">            force (``bool``): If ``hdr_file`` or its associated image file</span>
<span class="sd">                exist, ``force=True`` will overwrite the files; otherwise, an</span>
<span class="sd">                exception will be raised if either file exists (default=False).</span>
<span class="sd">            ext (``None`` or ``str``): The extension to use for saving the</span>
<span class="sd">                image file. If not specified or if set to an empty string</span>
<span class="sd">                (e.g., ``ext=&#39;&#39;``), a default extension is determined using the</span>
<span class="sd">                same name as ``fname_hdr_spec``, except without the &quot;.hdr&quot;</span>
<span class="sd">                extension. If ``fname_hdr_spec`` is provided without the</span>
<span class="sd">                &quot;non-.hdr&quot; extension (e.g., &quot;bip&quot;), then the extension is</span>
<span class="sd">                determined from the ``interleave`` parameter. For example, if</span>
<span class="sd">                ``interleave``=&#39;bip&#39;, then ``ext`` is set to &#39;bip&#39; as well. Use</span>
<span class="sd">                of ``ext`` is not recommended; instead, just set</span>
<span class="sd">                ``fname_hdr_spec`` with the correct extension or use</span>
<span class="sd">                ``interleave`` to set the extension (default: ``None``;</span>
<span class="sd">                determined from ``fname_hdr_spec`` or ``interleave``).</span>
<span class="sd">            interleave (``str``): The band interleave format to use for writing</span>
<span class="sd">                the file; ``interleave`` should be one of &#39;bil&#39;, &#39;bip&#39;, or</span>
<span class="sd">                &#39;bsq&#39; (default=&#39;bip&#39;).</span>
<span class="sd">            byteorder (``int`` or ``str``): Specifies the byte order</span>
<span class="sd">                (endian-ness) of the data as written to disk. For little</span>
<span class="sd">                endian, this value should be either 0 or &#39;little&#39;. For big</span>
<span class="sd">                endian, it should be either 1 or &#39;big&#39;. If not specified,</span>
<span class="sd">                native byte order will be used (default=None).</span>
<span class="sd">            metadata (``dict``): Metadata to write to the ENVI .hdr file</span>
<span class="sd">                describing the spectra being saved; if ``None``, will try to</span>
<span class="sd">                pull metadata template from ``hsio.spyfile_spec.metadata`` or</span>
<span class="sd">                ``hsio.spyfile.metadata`` (default=None).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio # load hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize the hsio class (note there are no required parameters)</span>
<span class="sd">            &gt;&gt;&gt; io.read_cube(fname_hdr_in)</span>

<span class="sd">            Calculate spectral mean via ``hstools.mean_datacube``</span>

<span class="sd">            &gt;&gt;&gt; spec_mean, spec_std, _ = io.tools.mean_datacube(io.spyfile)</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr_spec = r&#39;F:\\nigo0024\Documents\hs_process_demo\hsio\Wells_rep2_20180628_16h56m_pika_gige_7-mean.spec.hdr&#39;</span>

<span class="sd">            Save the new spectra to file via ``hsio.write_spec``</span>

<span class="sd">            &gt;&gt;&gt; io.write_spec(fname_hdr_spec, spec_mean, spec_std)</span>
<span class="sd">            Saving F:\nigo0024\Documents\hs_process_demo\hsio\Wells_rep2_20180628_16h56m_pika_gige_7-mean.spec</span>

<span class="sd">            Open *Wells_rep2_20180628_16h56m_pika_gige_7-mean.spec* in *Spectronon* for visualization</span>

<span class="sd">            .. image:: ../img/utilities/write_spec.png</span>

<span class="sd">        .. _Spectral Python: http://www.spectralpython.net/</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">interleave</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interleave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;interleave&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">envi_write</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="o">.</span><span class="n">metadata</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>

        <span class="n">fname_hdr_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fname_hdr</span><span class="p">(</span>
                <span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="n">interleave</span><span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;map info&#39;</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;coordinate system string&#39;</span><span class="p">)</span>
<span class="c1">#        metadata = self._del_meta_item(metadata, &#39;history&#39;)</span>
<span class="c1">#        metadata = self._del_meta_item(metadata, &#39;original cube file&#39;)</span>
<span class="c1">#        metadata = self._del_meta_item(metadata, &#39;pointlist&#39;)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;boundary&#39;</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;band names&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;wavelength&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">df_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df_std</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">df_std</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;stdev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">std</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">clean_md_sets</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spyfile_spec</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">df_mean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">df_mean</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array_mean</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_mean</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">envi</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">interleave</span><span class="o">=</span><span class="n">interleave</span><span class="p">,</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="n">byteorder</span><span class="p">,</span>
                            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">envi</span><span class="o">.</span><span class="n">EnviException</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Header file already exists: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">Use the `force` keyword &#39;</span>
                   <span class="s1">&#39;to force overwrite.</span><span class="se">\n</span><span class="s1">``hsio.set_io_defaults(force=True)`` &#39;</span>
                   <span class="s1">&#39;will adjust the default setting so existing files are &#39;</span>
                   <span class="s1">&#39;overwritten by default (i.e., without passing the `force` &#39;</span>
                   <span class="s1">&#39;keyword.)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_hdr_spec</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">envi</span><span class="o">.</span><span class="n">EnviException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="hsio.write_tif"><a class="viewcode-back" href="../../api/hs_process.hsio.html#hs_process.hsio.write_tif">[docs]</a>    <span class="k">def</span> <span class="nf">write_tif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_tif</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">projection_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geotransform_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">show_img</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function that accesses the `GDAL Python package`_ to save a</span>
<span class="sd">        small datacube subset (i.e., three bands or less) to file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_tif (``str``): Output image file path (with the &#39;.tif&#39;</span>
<span class="sd">                extension).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``, optional): The</span>
<span class="sd">                data cube to save. If ``numpy.ndarray``, then metadata</span>
<span class="sd">                (``dict``) should also be passed. If ``None``, uses</span>
<span class="sd">                hsio.spyfile (default: ``None``).</span>
<span class="sd">            metadata (``dict``): Metadata information; if ``geotransform_out``</span>
<span class="sd">                is not passed, &quot;map info&quot; is accessed from ``metadata`` and</span>
<span class="sd">                ``geotransform_out`` is created from that &quot;map info&quot;.</span>
<span class="sd">            fname_in (``str``, optional): The filename of the image datacube to</span>
<span class="sd">                be read in initially. This is potentially useful if</span>
<span class="sd">                ``projection_out`` and/or ``geotransform_out`` are not passed</span>
<span class="sd">                and a ``numpy.ndarray`` is passed as the ``spyfile`` - in this</span>
<span class="sd">                case, ``write_tif()`` uses ``fname_in`` to load the</span>
<span class="sd">                ``fname_in`` datacube via GDAL, which can in turn be used to</span>
<span class="sd">                load the projection or geotransform information for the output</span>
<span class="sd">                geotiff (default: None).</span>
<span class="sd">            projection_out (``str``): The GDAL projection to use while writing</span>
<span class="sd">                the geotiff. Applied using</span>
<span class="sd">                gdal.driver.dataset.SetProjection() (default: ``None``;</span>
<span class="sd">                ``hsio.projection_out``)</span>
<span class="sd">            geotransform_out (``str``): The GDAL geotransform to use while</span>
<span class="sd">                writing the geotiff. Applied using</span>
<span class="sd">                gdal.driver.dataset.SetGeoTransform() (default: ``None``;</span>
<span class="sd">                ``hsio.geotransform_out``)</span>
<span class="sd">            show_img (``bool`` or ``str``): Whether to display a render of the</span>
<span class="sd">                image being saved as a geotiff. Must be ``False`` (does not</span>
<span class="sd">                display the image), &quot;inline&quot; (displays the image inline using</span>
<span class="sd">                the IPython console), or &quot;popout&quot; (displays the image in a</span>
<span class="sd">                pop-out window; default: &quot;inline&quot;).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio  # load hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio()  # initialize the hsio class</span>
<span class="sd">            &gt;&gt;&gt; io.read_cube(fname_hdr_in)</span>

<span class="sd">            Save an RGB render of the datacube to file via ``hsio.write_tif``</span>

<span class="sd">            &gt;&gt;&gt; fname_tif = r&#39;F:\\nigo0024\Documents\hs_process_demo\hsio\Wells_rep2_20180628_16h56m_pika_gige_7.tif&#39;</span>
<span class="sd">            &gt;&gt;&gt; io.write_tif(fname_tif, spyfile=io.spyfile, fname_in=fname_hdr_in)</span>
<span class="sd">            Either `projection_out` is `None` or `geotransform_out` is `None` (or both are). Retrieving projection and geotransform information by loading `hsio.fname_in` via GDAL. Be sure this is appropriate for the data you are trying to write.</span>
<span class="sd">            Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</span>

<span class="sd">            .. image:: ../img/utilities/write_tif.png</span>

<span class="sd">            Open *Wells_rep2_20180628_16h56m_pika_gige_7.tif* in *QGIS* with the plot boundaries overlaid</span>

<span class="sd">            .. image:: ../img/utilities/write_tif_qgis.png</span>

<span class="sd">        .. _GDAL Python package: https://pypi.org/project/GDAL/</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_size</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;write_tif&#39;</span><span class="p">,</span>
                                 <span class="n">fname_out</span><span class="o">=</span><span class="n">fname_tif</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">msg1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;The directory passed in `fname_tif` does not exist. Please &#39;</span>
                <span class="s1">&#39;be sure to create the directory prior to writing the geotif.&#39;</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Try:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;os.mkdir(os.path.dirname(fname_tif))&#39;</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">msg1</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;`show_img` must be one of `False`, &quot;inline&quot;, or &quot;popout&quot;. &#39;</span>
                <span class="s1">&#39;Please modify `show_img` paramater accordingly.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">show_img</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="s1">&#39;popout&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">msg2</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="k">if</span> <span class="n">fname_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">fname_hdr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span><span class="p">,</span> <span class="n">name_long</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_long</span><span class="p">,</span>
                           <span class="n">name_plot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span><span class="p">,</span>
                           <span class="n">name_short</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="p">,</span>
                           <span class="n">individual_plot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">individual_plot</span><span class="p">,</span>
                           <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">projection_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">geotransform_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Either `projection_out` is `None` or `geotransform_out` is &#39;</span>
                  <span class="s1">&#39;`None` (or both are). Retrieving projection and &#39;</span>
                  <span class="s1">&#39;geotransform information by loading `hsio.fname_in` via &#39;</span>
                  <span class="s1">&#39;GDAL. Be sure this is appropriate for the data you are &#39;</span>
                  <span class="s1">&#39;trying to write.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">img_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_envi_gdal</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">projection_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">projection_out</span> <span class="o">=</span> <span class="n">img_ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">geotransform_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geotransform_out</span> <span class="o">=</span> <span class="n">img_ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">geotransform_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_set</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;map info&#39;</span><span class="p">]</span>
            <span class="n">ul_x_utm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">ul_y_utm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">size_x_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">size_y_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">map_set</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="c1"># Note the last pixel size must be negative to begin at upper left</span>
            <span class="n">geotransform_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">ul_x_utm</span><span class="p">,</span> <span class="n">size_x_m</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ul_y_utm</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="o">-</span><span class="n">size_y_m</span><span class="p">]</span>

        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
        <span class="n">drv</span><span class="o">.</span><span class="n">Register</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">bands</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bands</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">tif_out</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                 <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">)</span>
            <span class="n">msg3</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;GDAL driver was unable to successfully create the empty &#39;</span>
                   <span class="s1">&#39;geotiff; check to be sure the correct filename is being &#39;</span>
                   <span class="s1">&#39;passed: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">tif_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msg3</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">projection_out</span><span class="p">)</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform_out</span><span class="p">)</span>

            <span class="n">band_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">460</span><span class="p">)</span>
            <span class="n">band_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>
            <span class="n">band_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="mi">640</span><span class="p">)</span>
            <span class="n">band_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="p">,</span> <span class="n">band_b</span><span class="p">]</span>  <span class="c1"># backwards for RGB display</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">band_list</span><span class="p">):</span>
                <span class="n">array_band</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_band</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">array_band</span> <span class="o">=</span> <span class="n">array_band</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">array_band</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">array_band</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">band_out</span> <span class="o">=</span> <span class="n">tif_out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">array_band</span><span class="p">):</span>
                    <span class="n">array_band</span><span class="p">[</span><span class="n">array_band</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">band_out</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">band_out</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array_band</span><span class="p">)</span>  <span class="c1"># must flip</span>
                <span class="n">band_out</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">show_img</span> <span class="o">==</span> <span class="s1">&#39;inline&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">band_r</span><span class="o">=</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="o">=</span><span class="n">band_g</span><span class="p">,</span>
                              <span class="n">band_b</span><span class="o">=</span><span class="n">band_b</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">show_img</span> <span class="o">==</span> <span class="s1">&#39;popout&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">band_r</span><span class="o">=</span><span class="n">band_r</span><span class="p">,</span> <span class="n">band_g</span><span class="o">=</span><span class="n">band_g</span><span class="p">,</span>
                              <span class="n">band_b</span><span class="o">=</span><span class="n">band_b</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ysize</span><span class="p">,</span> <span class="n">xsize</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">tif_out</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">fname_tif</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">)</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">projection_out</span><span class="p">)</span>
            <span class="n">tif_out</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform_out</span><span class="p">)</span>
            <span class="n">band_out</span> <span class="o">=</span> <span class="n">tif_out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
                <span class="n">array</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">band_out</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">band_out</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="n">band_out</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">show_img</span> <span class="o">==</span> <span class="s1">&#39;inline&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">show_img</span> <span class="o">==</span> <span class="s1">&#39;popout&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">tif_out</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tif_out</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="hstools"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools">[docs]</a><span class="k">class</span> <span class="nc">hstools</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Basic tools for manipulating Spyfiles and accessing their metadata.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">            manipulated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pleae load a SpyFile (Spectral Python object)&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">spyfile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_meta_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieves band number and wavelength information from metadata and</span>
<span class="sd">        saves as a dictionary</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube being</span>
<span class="sd">                accessed and/or manipulated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">meta_bands</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;band names&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]):</span>
                    <span class="n">meta_bands</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># &#39;wavelength&#39; is not a metadata key</span>
                <span class="k">pass</span>  <span class="c1"># meta_bands will just be empty</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">band_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">]))</span>
                <span class="n">wl_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">band_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;band names&#39;</span><span class="p">])))</span>
                <span class="n">wl_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])))</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">band_names</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">meta_bands</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">band_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wl_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">meta_bands</span><span class="p">[</span><span class="n">band_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wl_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span> <span class="o">=</span> <span class="n">meta_bands</span>

    <span class="k">def</span> <span class="nf">_parse_fname_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_plot</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Code for parsing ``name_plot`` (numeric text following ``str_plot``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span>
        <span class="k">if</span> <span class="n">str_plot</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s1">&#39;_pika&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_plot</span><span class="p">):</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_pika&#39;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">str_plot</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s1">&#39;_pika&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_plot</span><span class="p">):</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>  <span class="c1"># then it must have gone wrong</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># then &#39;_pika&#39; must not</span>
            <span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">name_plot</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># give up..</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Cannot determine the plot name from the image filename. &#39;</span>
                   <span class="s1">&#39;Setting `hsio.name_plot` to `None`. If this image is for &#39;</span>
                   <span class="s1">&#39;a particular plot, please set `hsio.name_plot; otherwise, &#39;</span>
                   <span class="s1">&#39;ignore this warning.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

            <span class="n">name_plot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">name_plot</span>

    <span class="k">def</span> <span class="nf">_parse_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">str_plot</span><span class="o">=</span><span class="s1">&#39;plot_&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parses the filename for ``name_long`` (text after the first dash,</span>
<span class="sd">        inclusive), ``name_short`` (text before the first dash), and</span>
<span class="sd">        ``name_plot`` (numeric text following ``str_plot``).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fname_hdr (``str``): input filename.</span>
<span class="sd">            str_plot (``str``): text to search for that precedes the numeric</span>
<span class="sd">                text that describes the plot number.</span>
<span class="sd">            overwrite (``bool``): whether the class instances of ``name_long``,</span>
<span class="sd">                ``name_short``, and ``name_plot`` should be overwritten based</span>
<span class="sd">                on ``fname_in`` (default: ``True``).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fname_hdr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.hdr&#39;</span><span class="p">:</span>  <span class="c1"># modify self.fname_in based on new file</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span> <span class="o">+</span> <span class="s1">&#39;.hdr&#39;</span>
            <span class="n">fname_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_hdr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_in</span> <span class="o">=</span> <span class="n">fname_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname_hdr</span> <span class="o">=</span> <span class="n">fname_hdr</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)</span>
<span class="c1">#        base_name = os.path.basename(fname_in)</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_name</span> <span class="o">=</span> <span class="n">base_name</span>

        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if name_long does not have ext, it can be just blank</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="c1"># and name_short can be base_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname_plot</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name_long</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">name_long</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)):]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if name_long does not have ext, it can be just blank</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_long</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">name_short</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">name_short</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="n">base_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_short</span> <span class="o">=</span> <span class="n">base_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">name_plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="n">name_plot</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname_plot</span><span class="p">(</span><span class="n">str_plot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="hstools.clean_md_sets"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.clean_md_sets">[docs]</a>    <span class="k">def</span> <span class="nf">clean_md_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts metadata items that are expressed as a list to be expressed as</span>
<span class="sd">        a dictionary.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``, optional): Metadata dictionary to clean</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``dict``:</span>
<span class="sd">                **metadata_out** (``dict``) -- Cleaned metadata dictionary.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Create sample metadata with &quot;wavelength&quot; expressed as a list of strings</span>

<span class="sd">            &gt;&gt;&gt; metadata = {&#39;samples&#39;: 1300,</span>
<span class="sd">                            &#39;lines&#39;: 617,</span>
<span class="sd">                            &#39;bands&#39;: 4,</span>
<span class="sd">                            &#39;file type&#39;: &#39;ENVI Standard&#39;,</span>
<span class="sd">                            &#39;wavelength&#39;: [&#39;394.6&#39;, &#39;396.6528&#39;, &#39;398.7056&#39;,</span>
<span class="sd">                            &#39;400.7584&#39;]}</span>

<span class="sd">            Clean metadata using ``hstools.clean_md_sets``. Notice how</span>
<span class="sd">            wavelength is now expressed as a ``str`` representation of a</span>
<span class="sd">            ``dict``, which is required for properly writing the metadata to</span>
<span class="sd">            the .hdr file via `save_image()`_ in Spectral Python.</span>

<span class="sd">            &gt;&gt;&gt; io.tools.clean_md_sets(metadata=metadata)</span>
<span class="sd">            {&#39;samples&#39;: 1300,</span>
<span class="sd">             &#39;lines&#39;: 617,</span>
<span class="sd">             &#39;bands&#39;: 4,</span>
<span class="sd">             &#39;file type&#39;: &#39;ENVI Standard&#39;,</span>
<span class="sd">             &#39;wavelength&#39;: &#39;{394.6, 396.6528, 398.7056, 400.7584}&#39;}</span>

<span class="sd">        .. _save_image(): http://www.spectralpython.net/class_func_ref.html#spectral.io.envi.save_image</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">metadata_out</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">set_str</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                <span class="n">metadata_out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_str</span>
        <span class="k">return</span> <span class="n">metadata_out</span></div>

<div class="viewcode-block" id="hstools.del_meta_item"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.del_meta_item">[docs]</a>    <span class="k">def</span> <span class="nf">del_meta_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deletes metadata item from SpyFile object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            metadata (``dict``): dictionary of the metadata</span>
<span class="sd">            key (``str``): dictionary key to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``dict``:</span>
<span class="sd">                **metadata** (``dict``) -- Dictionary containing the modified</span>
<span class="sd">                metadata.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Create sample metadata</span>

<span class="sd">            &gt;&gt;&gt; metadata = {&#39;samples&#39;: 1300,</span>
<span class="sd">                            &#39;lines&#39;: 617,</span>
<span class="sd">                            &#39;bands&#39;: 4,</span>
<span class="sd">                            &#39;file type&#39;: &#39;ENVI Standard&#39;,</span>
<span class="sd">                            &#39;map info&#39;: &#39;{UTM, 1.0, 1.0, 421356.76707299997, 4844936.7317699995, 0.04, 0.04, 15, T, WGS-84, units  meters, rotation  0.000}&#39;,</span>
<span class="sd">                            &#39;wavelength&#39;: [&#39;394.6&#39;, &#39;396.6528&#39;, &#39;398.7056&#39;,</span>
<span class="sd">                            &#39;400.7584&#39;]}</span>

<span class="sd">            Delete *&quot;map info&quot;* from ``metadata`` using ``hstools.del_met_item``</span>

<span class="sd">            &gt;&gt;&gt; io.tools.del_meta_item(metadata, &#39;map info&#39;)</span>
<span class="sd">            {&#39;samples&#39;: 1827,</span>
<span class="sd">             &#39;lines&#39;: 617,</span>
<span class="sd">             &#39;bands&#39;: 4,</span>
<span class="sd">             &#39;file type&#39;: &#39;ENVI Standard&#39;,</span>
<span class="sd">             &#39;wavelength&#39;: [&#39;394.6&#39;, &#39;396.6528&#39;, &#39;398.7056&#39;, &#39;400.7584&#39;]}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Please be sure to base a metadata dictionary.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="n">msg</span>
        <span class="k">try</span><span class="p">:</span>
<span class="c1">#            del metadata[key]</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="c1">#            val = None</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> not a valid key in input dictionary.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="hstools.get_band"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_band">[docs]</a>    <span class="k">def</span> <span class="nf">get_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_wl</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the band number of the closest target wavelength.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            target_wl (``int`` or ``float``): the target wavelength to retrieve</span>
<span class="sd">                the band number for (required).</span>
<span class="sd">            spyfile (``SpyFile`` object, optional): The datacube being accessed</span>
<span class="sd">                and/or manipulated; if ``None``, uses ``hstools.spyfile``</span>
<span class="sd">                (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``int``:</span>
<span class="sd">                **key_band** (``int``) -- band number of the closest target</span>
<span class="sd">                wavelength (``target_wl``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Use ``hstools.get_band`` to find the band number corresponding to</span>
<span class="sd">            *703 nm*</span>

<span class="sd">            &gt;&gt;&gt; io.tools.get_band(703, io.spyfile)</span>
<span class="sd">            151</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="n">val_target</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">target_wl</span><span class="p">))</span>
        <span class="n">key_band</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val_target</span><span class="p">)]</span>
<span class="c1">#        key_wavelength = sorted(list(self.meta_bands.values()))[key_band-1]</span>
        <span class="k">return</span> <span class="n">key_band</span></div>

<div class="viewcode-block" id="hstools.get_wavelength"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_wavelength">[docs]</a>    <span class="k">def</span> <span class="nf">get_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_band</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns actual wavelength of the closest target band.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            target_band (``int`` or ``float``): the target band to retrieve</span>
<span class="sd">                wavelength number for (required).</span>
<span class="sd">            spyfile (``SpyFile`` object, optional): The datacube being accessed and/or</span>
<span class="sd">                manipulated; if ``None``, uses ``hstools.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``float``:</span>
<span class="sd">                **key_wavelength** (``float``) -- wavelength of the closest</span>
<span class="sd">                target band (``target_band``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Use ``hstools.get_wavelength`` to find the wavelength value corresponding to the *151st band*</span>

<span class="sd">            &gt;&gt;&gt; io.tools.get_wavelength(151, io.spyfile)</span>
<span class="sd">            702.52</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="n">val_target</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">target_band</span><span class="p">))</span>
        <span class="n">key_wavelength</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val_target</span><span class="p">)]</span>
<span class="c1">#        key_wavelength = sorted(list(self.meta_bands.values()))[key_band-1]</span>
        <span class="k">return</span> <span class="n">key_wavelength</span></div>

<div class="viewcode-block" id="hstools.get_center_wl"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_center_wl">[docs]</a>    <span class="k">def</span> <span class="nf">get_center_wl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl_list</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wls</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets band numbers and mean wavelength from all wavelengths (or bands)</span>
<span class="sd">        in ``wl_list``.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wl_list (``list``): the list of bands to get information for</span>
<span class="sd">                (required).</span>
<span class="sd">            spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">                manipulated; if ``None``, uses ``hstools.spyfile`` (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            wls (``bool``): whether wavelengths are passed in ``wl_list`` or if</span>
<span class="sd">                bands are passed in ``wl_list`` (default: ``True`` - wavelenghts</span>
<span class="sd">                passed).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **bands** (``list``): the list of bands (band number) corresponding</span>
<span class="sd">              to ``wl_list``.</span>
<span class="sd">            - **wls_mean** (``float``): the mean wavelength from ``wl_list``.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Using ``hstools.get_center_wl``, find the bands and *actual mean wavelength* of the bands closest to *700* and *710* nm.</span>

<span class="sd">            &gt;&gt;&gt; bands, wls_mean = io.tools.get_center_wl([700, 710], wls=True)</span>
<span class="sd">            &gt;&gt;&gt; bands</span>
<span class="sd">            [150, 155]</span>
<span class="sd">            &gt;&gt;&gt; wls_mean</span>
<span class="sd">            705.5992</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;wl_list&quot; must be a list.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wl_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">wls</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">wl_list</span><span class="p">:</span>
                <span class="n">wl_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
                <span class="n">band_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="n">wl_i</span><span class="p">)</span>
                <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band_i</span><span class="p">)</span>
                <span class="n">wavelengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wl_i</span><span class="p">)</span>
            <span class="n">wls_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wl</span> <span class="ow">in</span> <span class="n">wl_list</span><span class="p">:</span>
                <span class="n">band_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span>
                <span class="n">wl_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_i</span><span class="p">)</span>
                <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band_i</span><span class="p">)</span>
                <span class="n">wavelengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wl_i</span><span class="p">)</span>
            <span class="n">wls_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bands</span><span class="p">,</span> <span class="n">wls_mean</span></div>

<div class="viewcode-block" id="hstools.get_band_index"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_band_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subtracts 1 from ``band_num`` and returns the band index(es).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            band_num (``int`` or ``list``): the target band number(s) to retrieve</span>
<span class="sd">            the band index for (required).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``int`` or ``list``:</span>
<span class="sd">                **band_idx** (``int``) -- band index of the passed band number</span>
<span class="sd">                (``band_num``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Using ``hstools.get_band_index``, find the band index of the *4th*, *43rd*, and *111th* bands</span>

<span class="sd">            &gt;&gt;&gt; io.tools.get_band_index([4, 43, 111])</span>
<span class="sd">            [3, 42, 110]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_num</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">band_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">band_num</span><span class="p">)</span>
            <span class="n">band_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">band_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">band_idx</span> <span class="o">=</span> <span class="n">band_num</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">band_idx</span></div>

<div class="viewcode-block" id="hstools.get_spectral_mean"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_spectral_mean">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectral_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_list</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets the spectral mean of a datacube from a list of bands.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            band_list (``list``): the list of bands to calculate the spectral</span>
<span class="sd">                mean for on the datacube (required).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube being</span>
<span class="sd">                accessed and/or manipulated; if ``None``, uses ``hstools.spyfile``</span>
<span class="sd">                (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``numpy.array`` or ``pandas.DataFrame``:</span>
<span class="sd">                **array_mean** (``numpy.array`` or ``pandas.DataFrame``): The</span>
<span class="sd">                mean reflectance from ``spyfile`` for the bands in ``band_list``.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Calculate the spectral mean of the datacube via</span>
<span class="sd">            ``hstools.get_spectral_mean`` using all bands between *800* and</span>
<span class="sd">            *840 nm*</span>

<span class="sd">            &gt;&gt;&gt; band_list = io.tools.get_band_range([800, 840], index=False)</span>
<span class="sd">            &gt;&gt;&gt; array_mean = io.tools.get_spectral_mean(band_list, spyfile=io.spyfile)</span>
<span class="sd">            &gt;&gt;&gt; io.show_img(array_mean)</span>

<span class="sd">            .. image:: ../img/utilities/get_spectral_mean.png</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;band_list&quot; must be a list.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">band_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_index</span><span class="p">(</span><span class="n">band_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band_idx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="n">band_idx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">str_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">band_list</span><span class="p">)</span>
            <span class="n">array_mean</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">band_list</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">str_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> type not supported.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array_mean</span></div>

<div class="viewcode-block" id="hstools.get_band_num"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_band_num">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_idx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds 1 to ``band_idx`` and returns the band number(s).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            band_idx (``int`` or ``list``): the target band index(es) to</span>
<span class="sd">                retrive the band number for (required).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``int`` or ``list``:</span>
<span class="sd">                **band_num** (``int`` or ``list``): band number of the passed</span>
<span class="sd">                band index (``band_idx``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Using ``hstools.get_band_num``, find the band number located at the *4th*, *43rd*, and *111th* index values.</span>

<span class="sd">            &gt;&gt;&gt; io.tools.get_band_num([4, 43, 111])</span>
<span class="sd">            [5, 44, 112]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_idx</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">band_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">band_idx</span><span class="p">)</span>
            <span class="n">band_num</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">band_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">band_num</span> <span class="o">=</span> <span class="n">band_idx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">band_num</span></div>

<div class="viewcode-block" id="hstools.get_band_range"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_band_range">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_wl</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieves the band index or band number for all bands within a</span>
<span class="sd">        wavelength range.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            range_wl (``list``): the minimum and maximum wavelength to consider;</span>
<span class="sd">                values should be ``int`` or ``float``.</span>
<span class="sd">            index (bool): Indicates whether to return the band number</span>
<span class="sd">                (``False``; min=1) or to return index number (``True``; min=0)</span>
<span class="sd">                (default: ``True``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``list``:</span>
<span class="sd">                **band_list** (``list``): A list of all bands (either index or</span>
<span class="sd">                number, depending on how ``index`` is set) between a range in</span>
<span class="sd">                wavelength values.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Find the band number of all bands between *700* and *710 nm*</span>

<span class="sd">            &gt;&gt;&gt; io.tools.get_band_range([700, 710], index=False, spyfile=io.spyfile)</span>
<span class="sd">            [150, 151, 152, 153, 154]</span>

<span class="sd">            Find the band index values of all bands between *700* and *710 nm*</span>
<span class="sd">            via ``hstools.get_band_range``</span>

<span class="sd">            &gt;&gt;&gt; io.tools.get_band_range([700, 710], index=True, spyfile=io.spyfile)</span>
<span class="sd">            [149, 150, 151, 152, 153]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;range_wl&quot; must be a `list` or `tuple`.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_wl</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_wl</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span> <span class="n">msg</span>
        <span class="c1"># could also just take the min and max as long as it has at least 2..</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&quot;range_wl&quot; must have exactly two items.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_wl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span>

        <span class="n">band_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">range_wl</span><span class="p">))</span>  <span class="c1"># gets closest band</span>
        <span class="n">band_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">range_wl</span><span class="p">))</span>
        <span class="n">wl_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_min</span><span class="p">)</span>
        <span class="n">wl_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wl_min</span> <span class="o">&lt;</span> <span class="n">range_wl</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># ensures its actually within the range</span>
            <span class="n">band_min</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">wl_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wl_max</span> <span class="o">&gt;</span> <span class="n">range_wl</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">band_max</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">wl_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">band_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_index</span><span class="p">(</span><span class="n">band_min</span><span class="p">)</span>
            <span class="n">band_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_index</span><span class="p">(</span><span class="n">band_max</span><span class="p">)</span>
        <span class="n">band_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">band_min</span><span class="p">,</span> <span class="n">band_max</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">band_list</span></div>

<div class="viewcode-block" id="hstools.get_meta_set"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_meta_set">[docs]</a>    <span class="k">def</span> <span class="nf">get_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reads metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files), taking care to remove leading and trailing</span>
<span class="sd">        spaces.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be read; if ``None``, the whole list is</span>
<span class="sd">                returned (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``list`` or ``str``:</span>
<span class="sd">                **metadata_list** (``list`` or ``str``): List of metadata set</span>
<span class="sd">                items (as ``str``), or if idx is not ``None``, the item in the</span>
<span class="sd">                position described by ``idx``.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Retrieve the *&quot;map info&quot; set* from the metadata via</span>
<span class="sd">            ``hstools.get_meta_set``</span>

<span class="sd">            &gt;&gt;&gt; map_info_set = io.spyfile.metadata[&#39;map info&#39;]</span>
<span class="sd">            [&#39;UTM&#39;,</span>
<span class="sd">             &#39;1.0&#39;,</span>
<span class="sd">             &#39;1.0&#39;,</span>
<span class="sd">             &#39;441357.287073&#39;,</span>
<span class="sd">             &#39;4855944.7717699995&#39;,</span>
<span class="sd">             &#39;0.04&#39;,</span>
<span class="sd">             &#39;0.04&#39;,</span>
<span class="sd">             &#39;15&#39;,</span>
<span class="sd">             &#39;T&#39;,</span>
<span class="sd">             &#39;WGS-84&#39;,</span>
<span class="sd">             &#39;units  meters&#39;,</span>
<span class="sd">             &#39;rotation  0.000&#39;]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meta_set_list</span> <span class="o">=</span> <span class="n">meta_set</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">meta_set_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metadata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span>  <span class="c1"># return the whole thing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

<div class="viewcode-block" id="hstools.get_UTM"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.get_UTM">[docs]</a>    <span class="k">def</span> <span class="nf">get_UTM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix_e_ul</span><span class="p">,</span> <span class="n">pix_n_ul</span><span class="p">,</span> <span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span><span class="p">,</span> <span class="n">size_x</span><span class="p">,</span> <span class="n">size_y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the new UTM coordinate of cropped plot to modify the</span>
<span class="sd">        &quot;map info&quot; tag of the .hdr file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            pix_e_ul (``int``): upper left column (easting) where image</span>
<span class="sd">                cropping begins.</span>
<span class="sd">            pix_n_ul (``int``): upper left row (northing) where image cropping</span>
<span class="sd">                begins.</span>
<span class="sd">            utm_x (``float``): UTM easting coordinates (meters) of the original</span>
<span class="sd">                image (from the upper left).</span>
<span class="sd">            utm_y (``float``): UTM northing coordinates (meters) of the</span>
<span class="sd">                original image (from the upper left).</span>
<span class="sd">            size_x (``float``): Ground resolved distance of the image pixels in</span>
<span class="sd">                the x (easting) direction (meters).</span>
<span class="sd">            size_y (``float``): Ground resolved distance of the image pixels in</span>
<span class="sd">                the y (northing) direction (meters).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **utm_x_new** (``float``): The modified UTM x coordinate (easting)</span>
<span class="sd">              of cropped plot.</span>
<span class="sd">            - **utm_y_new** (``float``): The modified UTM y coordinate (northing)</span>
<span class="sd">              of cropped plot.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Retrieve UTM coordinates and pixel sizes from the metadata</span>

<span class="sd">            &gt;&gt;&gt; map_info_set = io.spyfile.metadata[&#39;map info&#39;]</span>
<span class="sd">            &gt;&gt;&gt; utm_x = io.tools.get_meta_set(map_info_set, 3)</span>
<span class="sd">            &gt;&gt;&gt; utm_y = io.tools.get_meta_set(map_info_set, 4)</span>
<span class="sd">            &gt;&gt;&gt; spy_ps_e = float(map_info_set[5])</span>
<span class="sd">            &gt;&gt;&gt; spy_ps_n = float(map_info_set[6])</span>

<span class="sd">            Calculate the UTM coordinates at the *100th easting pixel* and</span>
<span class="sd">            *50th northing pixel* using ``hstools.get_UTM``</span>

<span class="sd">            &gt;&gt;&gt; ul_x_utm, ul_y_utm = io.tools.get_UTM(100, 50,</span>
<span class="sd">                                                      utm_x, utm_y,</span>
<span class="sd">                                                      spy_ps_e,</span>
<span class="sd">                                                      spy_ps_n)</span>
<span class="sd">            &gt;&gt;&gt; ul_x_utm</span>
<span class="sd">            441360.80707299995</span>
<span class="sd">            &gt;&gt;&gt; ul_y_utm</span>
<span class="sd">            4855934.691769999</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">utm_x_new</span> <span class="o">=</span> <span class="n">utm_x</span> <span class="o">+</span> <span class="p">((</span><span class="n">pix_e_ul</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">size_x</span><span class="p">)</span>
        <span class="n">utm_y_new</span> <span class="o">=</span> <span class="n">utm_y</span> <span class="o">-</span> <span class="p">((</span><span class="n">pix_n_ul</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">size_y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">utm_x_new</span><span class="p">,</span> <span class="n">utm_y_new</span></div>

<div class="viewcode-block" id="hstools.load_spyfile"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.load_spyfile">[docs]</a>    <span class="k">def</span> <span class="nf">load_spyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Loads a ``SpyFile`` (Spectral Python object) for data access and/or</span>
<span class="sd">        manipulation by the ``hstools`` class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">                manipulated.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Load a new datacube using ``hstools.load_spyfile``</span>

<span class="sd">            &gt;&gt;&gt; io.tools.load_spyfile(io.spyfile)</span>
<span class="sd">            &gt;&gt;&gt; io.tools.spyfile</span>
<span class="sd">            Data Source:   &#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip&#39;</span>
<span class="sd">        	# Rows:            617</span>
<span class="sd">        	# Samples:        1300</span>
<span class="sd">        	# Bands:           240</span>
<span class="sd">        	Interleave:        BIP</span>
<span class="sd">        	Quantization:  32 bits</span>
<span class="sd">        	Data format:   float32</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_meta_bands</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_fname</span><span class="p">(</span><span class="n">fname_hdr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">str_plot</span><span class="o">=</span><span class="s1">&#39;plot_&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">name_long</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_short</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="hstools.mask_array"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.mask_array">[docs]</a>    <span class="k">def</span> <span class="nf">mask_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">side</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a masked numpy array based on a threshold value. If ``array`` is</span>
<span class="sd">        already a masked array, that mask is maintained and the new mask(s) is/</span>
<span class="sd">        are added to the original mask.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            array (``numpy.ndarray``): The data array to mask.</span>
<span class="sd">            thresh (``float`` or ``list``): The value for which to base the</span>
<span class="sd">                threshold; if ``thresh`` is ``list`` and ``side`` is ``None``,</span>
<span class="sd">                then all values in ``thresh`` will be masked; if ``thresh`` is</span>
<span class="sd">                ``list`` and ``side`` is not ``None``, then only the first</span>
<span class="sd">                value in the list will be considered for thresholding (default:</span>
<span class="sd">                ``None``).</span>
<span class="sd">            percentile (``float``): The percentile of pixels to mask; if</span>
<span class="sd">                ``percentile`` = 95 and ``side`` = &#39;lower&#39;, the lowest 95% of</span>
<span class="sd">                pixels will be masked prior to calculating the mean spectra</span>
<span class="sd">                across pixels (default: ``None``; range: 0-100).</span>
<span class="sd">            side (``str``): The side of the threshold for which to apply the</span>
<span class="sd">                mask. Must be either &#39;lower&#39;, &#39;upper&#39;, or ``None``; if &#39;lower&#39;,</span>
<span class="sd">                everything below the threshold will be masked; if ``None``,</span>
<span class="sd">                only the values that exactly match the threshol will be masked</span>
<span class="sd">                (default: &#39;lower&#39;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_mask** (``numpy.ndarray``): The masked ``numpy.ndarray``</span>
<span class="sd">              based on the passed threshold and/or percentile value.</span>
<span class="sd">            - **metadata** (``dict``): The modified metadata.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Retrieve the image band at *800 nm* using ``hstools.get_band`` and</span>
<span class="sd">            ``hsio.spyfile.open_memmap``</span>

<span class="sd">            &gt;&gt;&gt; band = io.tools.get_band(800)</span>
<span class="sd">            &gt;&gt;&gt; array = io.spyfile.open_memmap()[:, :, band]</span>

<span class="sd">            Create a masked array of all values below the *75th percentile*</span>
<span class="sd">            via ``hstools.mask_array``</span>

<span class="sd">            &gt;&gt;&gt; array_mask, metadata = io.tools.mask_array(array, io.spyfile.metadata, percentile=75, side=&#39;lower&#39;)</span>

<span class="sd">            See that the *&quot;history&quot;* tage in the ``metadata`` has been modified</span>

<span class="sd">            &gt;&gt;&gt; metadata[&#39;history&#39;][-158:]</span>
<span class="sd">            &quot;hs_process.mask_array[&lt;label: &#39;thresh?&#39; value:None; label: &#39;percentile?&#39; value:75; label: &#39;side?&#39; value:lower; label: &#39;unmasked_pct?&#39; value:24.9935170178282&gt;]&quot;</span>

<span class="sd">            Visualize the unmasked array using ``hsio.show_img``. Set ``vmin``</span>
<span class="sd">            and ``vmax`` to ensure the same color scale is used in comparing</span>
<span class="sd">            the masked vs. unmasked arrays.</span>

<span class="sd">            &gt;&gt;&gt; vmin = array.min()</span>
<span class="sd">            &gt;&gt;&gt; vmax = array.max()</span>
<span class="sd">            &gt;&gt;&gt; io.show_img(array, vmin=vmin, vmax=vmax)</span>

<span class="sd">            .. image:: ../img/utilities/mask_array_800nm.png</span>

<span class="sd">            Visualize the unmasked array using ``hsio.show_img``</span>

<span class="sd">            &gt;&gt;&gt; io.show_img(array_mask, vmin=vmin, vmax=vmax)</span>

<span class="sd">            .. image:: ../img/utilities/mask_array_800nm_75th.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>  <span class="c1"># allows for accurate percentile calc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">array_m</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">percentile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">array</span><span class="p">,</span> <span class="n">metadata</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">side</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array_pctl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">array_m</span><span class="p">,</span> <span class="n">percentile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
                <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array_pctl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
                <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array_pctl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">array_pctl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_array_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># side is None; thresh is float or int</span>
                <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_array_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">)</span>

        <span class="n">mask_combine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">mask_array_p</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask_array_t</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mask_combine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">mask_combine</span><span class="p">,</span> <span class="n">array_m</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># array_m does not have a mask</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>  <span class="c1"># masks out invalid data (e.g., NaN, inf)</span>
        <span class="n">array_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_combine</span><span class="p">)</span>
        <span class="n">unmasked_pct</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">array_mask</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span>
                              <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1">#        print(&#39;Proportion unmasked pixels: {0:.2f}%&#39;.format(unmasked_pct))</span>

        <span class="k">if</span> <span class="n">side</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">side_str</span> <span class="o">=</span> <span class="s1">&#39;equal&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">side_str</span> <span class="o">=</span> <span class="n">side</span>
        <span class="n">hist_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; -&gt; hs_process.mask_array[&lt;&quot;</span>
                    <span class="s2">&quot;label: &#39;thresh?&#39; value:</span><span class="si">{0}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;percentile?&#39; value:</span><span class="si">{1}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;side?&#39; value:</span><span class="si">{2}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;unmasked_pct?&#39; value:</span><span class="si">{3}</span><span class="s2">&gt;]&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">side_str</span><span class="p">,</span> <span class="n">unmasked_pct</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hist_str</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hist_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">array_mask</span><span class="p">,</span> <span class="n">metadata</span></div>

<span class="c1">#    def mask_datacube(self, spyfile, mask):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        DO NOT USE; USE mean_datacube() INSTEAD AND PASS A MASK.</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#        Applies ``mask`` to ``spyfile``, then returns the datcube (as a np.array)</span>
<span class="c1">#        and the mean spectra</span>
<span class="c1">#</span>
<span class="c1">#        Parameters:</span>
<span class="c1">#            spyfile (``SpyFile`` object or ``numpy.ndarray``): The hyperspectral</span>
<span class="c1">#                datacube to mask.</span>
<span class="c1">#            mask (``numpy.ndarray``): the mask to apply to ``spyfile``; if ``mask``</span>
<span class="c1">#                does not have similar dimensions to ``spyfile``, the first band</span>
<span class="c1">#                (i.e., first two dimensions) of ``mask`` will be repeated n times</span>
<span class="c1">#                to match the number of bands of ``spyfile``.</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if isinstance(spyfile, SpyFile.SpyFile):</span>
<span class="c1">#            self.load_spyfile(spyfile)</span>
<span class="c1">#            array = self.spyfile.load()</span>
<span class="c1">#        elif isinstance(spyfile, np.ndarray):</span>
<span class="c1">#            array = spyfile.copy()</span>
<span class="c1">#</span>
<span class="c1">#        if isinstance(mask, np.ma.masked_array):</span>
<span class="c1">#            mask = mask.mask</span>
<span class="c1">#        if mask.shape != spyfile.shape:</span>
<span class="c1">#            if len(mask.shape) == 3:</span>
<span class="c1">#                mask_2d = np.reshape(mask, mask.shape[:2])</span>
<span class="c1">#            else:</span>
<span class="c1">#                mask_2d = mask.copy()</span>
<span class="c1">#            mask = np.empty(spyfile.shape)</span>
<span class="c1">#            for band in range(spyfile.nbands):</span>
<span class="c1">#                mask[:, :, band] = mask_2d</span>
<span class="c1">#</span>
<span class="c1">#        datacube_masked = np.ma.masked_array(array, mask=mask)</span>
<span class="c1">#        spec_mean = np.nanmean(datacube_masked, axis=(0, 1))</span>
<span class="c1">#        spec_std = np.nanstd(datacube_masked, axis=(0, 1))</span>
<span class="c1">#        spec_mean = pd.Series(spec_mean)</span>
<span class="c1">#        spec_std = pd.Series(spec_std)</span>
<span class="c1">#        return spec_mean, spec_std, datacube_masked</span>

<div class="viewcode-block" id="hstools.mean_datacube"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.mean_datacube">[docs]</a>    <span class="k">def</span> <span class="nf">mean_datacube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the mean spectra for a datcube; if ``mask`` is passed (as a</span>
<span class="sd">        ``numpy.ndarray``), then the mask is applied to ``spyfile`` prior to</span>
<span class="sd">        computing the mean spectra.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The</span>
<span class="sd">                hyperspectral datacube to mask.</span>
<span class="sd">            mask (``numpy.ndarray``): the mask to apply to ``spyfile``; if</span>
<span class="sd">                ``mask`` does not have similar dimensions to ``spyfile``, the</span>
<span class="sd">                first band (i.e., first two dimensions) of ``mask`` will be</span>
<span class="sd">                repeated *n* times to match the number of bands of ``spyfile``</span>
<span class="sd">                (default: ``None``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            3-element ``tuple`` containing</span>

<span class="sd">            - **spec_mean** (``SpyFile.SpyFile`` object): The mean spectra from</span>
<span class="sd">              the input datacube.</span>
<span class="sd">            - **spec_std** (``SpyFile.SpyFile`` object): The standard deviation</span>
<span class="sd">              of the spectra from the input datacube.</span>
<span class="sd">            - **datacube_masked** (``numpy.ndarray``): The masked</span>
<span class="sd">              ``numpy.ndarray``; if ``mask`` is ``None``, ``datacube_masked``</span>
<span class="sd">              is identical to the ``SpyFile`` data array.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Retrieve the image band at *800 nm* using ``hstools.get_band`` and</span>
<span class="sd">            ``hsio.spyfile.open_memmap``, then mask out all pixels whose value falls</span>
<span class="sd">            below the *75th percentile*.</span>

<span class="sd">            &gt;&gt;&gt; band = io.tools.get_band(800)</span>
<span class="sd">            &gt;&gt;&gt; array = io.spyfile.open_memmap()[:, :, band]</span>
<span class="sd">            &gt;&gt;&gt; array_mask, metadata = io.tools.mask_array(array, io.spyfile.metadata, percentile=75, side=&#39;lower&#39;)</span>

<span class="sd">            Calculate the spectral mean from the remaining *(i.e., unmasked)*</span>
<span class="sd">            pixels using ``hstools.mean_datacube``.</span>

<span class="sd">            &gt;&gt;&gt; spec_mean, spec_std, datacube_masked = io.tools.mean_datacube(io.spyfile, mask=array_mask)</span>

<span class="sd">            Save using ``hsio.write_spec`` and ``hsio.write_cube``, then load</span>
<span class="sd">            into Spectronon software for visualization.</span>

<span class="sd">            &gt;&gt;&gt; fname_hdr_spec = r&#39;F:\\nigo0024\Documents\hs_process_demo\hstools\Wells_rep2_20180628_16h56m_pika_gige_7-mean_800nm_75th.spec.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; fname_hdr_cube = r&#39;F:\\nigo0024\Documents\hs_process_demo\hstools\Wells_rep2_20180628_16h56m_pika_gige_7-mean_800nm_75th.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io.write_spec(fname_hdr_spec, spec_mean, spec_std, metadata=metadata)</span>
<span class="sd">            Saving F:\nigo0024\Documents\hs_process_demo\hstools\Wells_rep2_20180628_16h56m_pika_gige_7-mean_800nm_75th.spec</span>
<span class="sd">            &gt;&gt;&gt; io.write_cube(fname_hdr_cube, datacube_masked, metadata=metadata)</span>
<span class="sd">            Saving F:\nigo0024\Documents\hs_process_demo\hstools\Wells_rep2_20180628_16h56m_pika_gige_7-mean_800nm_75th.bip</span>

<span class="sd">            .. image:: ../img/utilities/mean_datacube.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">mask_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mask_2d</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spyfile</span><span class="o">.</span><span class="n">nbands</span><span class="p">):</span>
                    <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_2d</span>

        <span class="n">datacube_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">spec_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">datacube_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">spec_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">datacube_masked</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">spec_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">spec_mean</span><span class="p">)</span>
        <span class="n">spec_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">spec_std</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec_mean</span><span class="p">,</span> <span class="n">spec_std</span><span class="p">,</span> <span class="n">datacube_masked</span></div>

<span class="c1">#    def mask_shadow(self, shadow_pctl=20, show_histogram=False,</span>
<span class="c1">#                    spyfile=None):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        Creates a ``numpy.mask`` of all pixels that are likely shadow pixels.</span>
<span class="c1">#</span>
<span class="c1">#        Parameters:</span>
<span class="c1">#            shadow_pctl (``int``): the percentile of pixels in the image to mask</span>
<span class="c1">#                (default: 20).</span>
<span class="c1">#            show_histogram (``bool``):</span>
<span class="c1">#            spyfile (``SpyFile.SpyFile`` object):</span>
<span class="c1">#</span>
<span class="c1">#        Returns:</span>
<span class="c1">#            2-element ``tuple`` containing</span>
<span class="c1">#</span>
<span class="c1">#            - **array_noshadow.mask** (``numpy.mask``): The mask indicating all</span>
<span class="c1">#              pixels that are likely shadow pixels.</span>
<span class="c1">#            - **metadata** (``dict``): The modified metadata.</span>
<span class="c1">#</span>
<span class="c1">#        Example:</span>
<span class="c1">#            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="c1">#            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="c1">#            &gt;&gt;&gt; io = hsio(fname_in)</span>
<span class="c1">#            &gt;&gt;&gt; io.tools.mask_shadow(shadow_pctl=20, show_histogram=False,</span>
<span class="c1">#                    spyfile=None)</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if spyfile is None:</span>
<span class="c1">#            spyfile = self.spyfile</span>
<span class="c1">#            array = self.spyfile.load()</span>
<span class="c1">#        elif isinstance(spyfile, SpyFile.SpyFile):</span>
<span class="c1">#            self.load_spyfile(spyfile)</span>
<span class="c1">#            array = self.spyfile.load()</span>
<span class="c1">#        elif isinstance(spyfile, np.ndarray):</span>
<span class="c1">#            array = spyfile.copy()</span>
<span class="c1">#</span>
<span class="c1">#        array_energy = np.mean(array, axis=2)</span>
<span class="c1">#        array_noshadow, metadata = self.mask_array(</span>
<span class="c1">#                array_energy, self.spyfile.metadata, percentile=shadow_pctl,</span>
<span class="c1">#                side=&#39;lower&#39;, show_histogram=show_histogram)</span>
<span class="c1">#        return array_noshadow.mask, metadata</span>

<div class="viewcode-block" id="hstools.modify_meta_set"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.modify_meta_set">[docs]</a>    <span class="k">def</span> <span class="nf">modify_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifies metadata &quot;set&quot; (i.e., string representation of a Python set;</span>
<span class="sd">        common in .hdr files) by converting string to list, then adjusts the</span>
<span class="sd">        value of an item by its index.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            meta_set (``str``): the string representation of the metadata set</span>
<span class="sd">            idx (``int``): index to be modified; if ``None``, the whole meta_set is</span>
<span class="sd">                returned (default: ``None``).</span>
<span class="sd">            value (``float``, ``int``, or ``str``): value to replace at idx</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``str``:</span>
<span class="sd">                **set_str** (``str``): Modified metadata set string.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Retrieve the *&quot;map info&quot; set* from the metadata via</span>
<span class="sd">            ``hstools.get_meta_set``</span>

<span class="sd">            &gt;&gt;&gt; map_info_set = io.spyfile.metadata[&#39;map info&#39;]</span>
<span class="sd">            &gt;&gt;&gt; map_info_set</span>
<span class="sd">            [&#39;UTM&#39;,</span>
<span class="sd">             &#39;1.0&#39;,</span>
<span class="sd">             &#39;1.0&#39;,</span>
<span class="sd">             &#39;441357.287073&#39;,</span>
<span class="sd">             &#39;4855944.7717699995&#39;,</span>
<span class="sd">             &#39;0.04&#39;,</span>
<span class="sd">             &#39;0.04&#39;,</span>
<span class="sd">             &#39;15&#39;,</span>
<span class="sd">             &#39;T&#39;,</span>
<span class="sd">             &#39;WGS-84&#39;,</span>
<span class="sd">             &#39;units  meters&#39;,</span>
<span class="sd">             &#39;rotation  0.000&#39;]</span>

<span class="sd">            Modify the value at *index position 4* from ``4855944.7717699995``</span>
<span class="sd">            to ``441300.2`` using ``hstools.modify_meta_set``.</span>

<span class="sd">            &gt;&gt;&gt; io.tools.modify_meta_set(map_info_set, idx=4, value=441300.2)</span>
<span class="sd">            &#39;{UTM, 1.0, 1.0, 441357.287073, 441300.2, 0.04, 0.04, 15, T, WGS-84, units  meters, rotation  0.000}&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metadata_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="n">meta_set</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">metadata_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">set_str</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metadata_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">return</span> <span class="n">set_str</span></div>

<div class="viewcode-block" id="hstools.plot_histogram"><a class="viewcode-back" href="../../api/hs_process.hstools.html#hs_process.hstools.plot_histogram">[docs]</a>    <span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">fname_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">percentile</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#444444&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plots a histogram with the percentile value labeled.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            array (``numpy.ndarray``): The data array used to create the</span>
<span class="sd">                histogram for; if ``array`` is masked, the masked pixels are</span>
<span class="sd">                excluded from the histogram.</span>
<span class="sd">            fname_fig (``str``, optional): The filename to save the figure to;</span>
<span class="sd">                if ``None``, the figure will not be saved (default: ``None``).</span>
<span class="sd">            title (``str``, optional): The plot title (default: ``None``).</span>
<span class="sd">            xlabel (``str``, optional): The x-axis label of the histogram</span>
<span class="sd">                (default: ``None``).</span>
<span class="sd">            percentile (``scalar``, optional): The percentile to label and</span>
<span class="sd">                illustrate on the histogram; if ``percentile`` = 90, the</span>
<span class="sd">                band/spectral index value at the 90th percentile will be</span>
<span class="sd">                labeled on the plot (default: 90; range: 0-100).</span>
<span class="sd">            bins (``int``, optional): Number of histogram bins (default: 50).</span>
<span class="sd">            fontsize (``scalar``): Font size of the axes labels. The title and</span>
<span class="sd">                text annotations will be scaled relatively (default: 16).</span>
<span class="sd">            color (``str``, optional): Color of the histogram columns (default:</span>
<span class="sd">                &quot;#444444&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig (``matplotlib.figure``): Figure object showing the histogram.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load and initialize ``hsio``</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>

<span class="sd">            Retrieve the image band at *800 nm* using ``hstools.get_band`` and</span>
<span class="sd">            ``hsio.spyfile.open_memmap``</span>

<span class="sd">            &gt;&gt;&gt; band = io.tools.get_band(800)</span>
<span class="sd">            &gt;&gt;&gt; array = io.spyfile.open_memmap()[:, :, band]</span>

<span class="sd">            Create a masked array of all values below the *5th percentile*</span>
<span class="sd">            via ``hstools.mask_array``</span>

<span class="sd">            &gt;&gt;&gt; array_mask, metadata = io.tools.mask_array(array, io.spyfile.metadata, percentile=5, side=&#39;lower&#39;)</span>

<span class="sd">            Visualize the histogram of the unmasked pixels (i.e., those greater</span>
<span class="sd">            than the 5th percentile) using ``hstools.plot_histogram``</span>

<span class="sd">            &gt;&gt;&gt; title = &#39;Reflectance at 800 nm&#39;</span>
<span class="sd">            &gt;&gt;&gt; xlabel = &#39;Reflectance (%)&#39;</span>
<span class="sd">            &gt;&gt;&gt; fig = io.tools.plot_histogram(array_mask, title=title, xlabel=xlabel)</span>

<span class="sd">            .. image:: ../img/utilities/plot_histogram_800nm.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">plt_style</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Array must be 1-dimensional or 2-dimensional. Please choose &#39;</span>
               <span class="s1">&#39;only a single array band to create a histogram</span><span class="se">\n</span><span class="s1">Array shape: &#39;</span>
               <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">msg</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>  <span class="c1"># allows for accurate percentile calc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">array_m</span> <span class="o">=</span> <span class="n">array_m</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>

<span class="c1">#        if percentile is not None:</span>
        <span class="n">pctl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">array_m</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">percentile</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">array_m</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
        <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

        <span class="n">y_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">pctl</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">yi</span><span class="o">/</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pctl</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">boxstyle_str</span> <span class="o">=</span> <span class="s1">&#39;round, pad=0.5, rounding_size=0.15&#39;</span>

        <span class="n">legend_str</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Percentile (</span><span class="si">{0}</span><span class="s1">): </span><span class="si">{1:.3f}</span><span class="s1">&#39;</span>
                      <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">pctl</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="n">legend_str</span><span class="p">,</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">pctl</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">),</span>  <span class="c1"># loc to place text</span>
            <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>  <span class="c1"># placed relative to axes</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>  <span class="c1"># alignment of text</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="n">boxstyle_str</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                      <span class="n">ec</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-|&gt;&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="c1">#                    patchB=el,</span>
                            <span class="n">shrinkA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">shrinkB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">connectionstyle</span><span class="o">=</span><span class="s1">&#39;arc3,rad=-0.3&#39;</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fname_fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_fig</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname_fig</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname_fig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Tyler J. Nigon.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>