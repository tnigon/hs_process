<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="python">
  <head>
    <meta charset="utf-8" />
    <title>hs_process.segment &#8212; hs_process 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          hs_process</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/tnigon/hs_process">Github</a></li>
                <li><a href="http://www.spectralpython.net/">Spectral Python</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../eonr_installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../my_hs_process_api.html">2. API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.batch.html">2.1.1. batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.defaults.html">2.1.2. defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.hsio.html">2.1.3. hsio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.hstools.html">2.1.4. hstools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.segment.html">2.1.5. segment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.spatial_mod.html">2.1.6. spatial_mod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hs_process.spec_mod.html">2.1.7. spec_mod</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">3. License</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <h1>Source code for hs_process.segment</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">spectral.io.spyfile</span> <span class="k">as</span> <span class="nn">SpyFile</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">hs_process.utilities</span> <span class="k">import</span> <span class="n">defaults</span>
<span class="kn">from</span> <span class="nn">hs_process.utilities</span> <span class="k">import</span> <span class="n">hstools</span>


<div class="viewcode-block" id="segment"><a class="viewcode-back" href="../../api/hs_process.segment.html#hs_process.segment">[docs]</a><span class="k">class</span> <span class="nc">segment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for aiding in the segmentation and/or masking of image</span>
<span class="sd">    data to filter out pixels that are of least interest.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        spyfile (``SpyFile`` object): The Spectral Python datacube to manipulate.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">hstools</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spy_ps_e</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spy_ps_n</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spy_ul_e_srs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spy_ul_n_srs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_bands_wls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks to be sure there is a valid wavelength or band to be used</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;At least one of either ``wl</span><span class="si">{0}</span><span class="s1">`` or ``b</span><span class="si">{0}</span><span class="s1">`` must be passed. &#39;</span>
                <span class="s1">&#39;Please check your inputs.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wl</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Both ``wl</span><span class="si">{0}</span><span class="s1"> and b</span><span class="si">{0}</span><span class="s1"> were passed, but only one can be used &#39;</span>
                <span class="s1">&#39;to deterimine which image band to use; the wavelength band &#39;</span>
                <span class="s1">&#39;(``wl</span><span class="si">{0}</span><span class="s1">``=</span><span class="si">{1}</span><span class="s1">) will be used for the band math operation.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">wl</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># use wl</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">wl</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># get wl</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wl</span>

    <span class="k">def</span> <span class="nf">_check_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_class</span><span class="p">,</span> <span class="n">n_pix</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks that enough classes were assigned</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">unique_classes</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">array_class</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">unique_classes_mod</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_classes</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">counts_mod</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique_classes</span><span class="p">,</span> <span class="n">counts</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">n_pix</span><span class="p">:</span>
                <span class="n">unique_classes_mod</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
                <span class="n">counts_mod</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_classes_mod</span><span class="p">,</span> <span class="n">counts_mod</span>

    <span class="k">def</span> <span class="nf">_get_band_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl_list</span><span class="p">,</span> <span class="n">list_range</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Determines how a list of wavelengths should be consolidated, if at all.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wl_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">list_range</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;When using a ``list_range``, please be sure each passed &#39;</span>
                   <span class="s1">&#39;&quot;band&quot; is a list of exactly two wavelength values.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span>
            <span class="n">band_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band_range</span><span class="p">(</span><span class="n">wl_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wl_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">list_range</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">band_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">wl_list</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="n">b_i</span><span class="p">)</span>
                <span class="n">band_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># just a single band; disregards ``list_range``</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band</span><span class="p">(</span><span class="n">wl_list</span><span class="p">)</span>
            <span class="n">band_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">band_list</span>

    <span class="k">def</span> <span class="nf">_get_wavelength_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_list_in</span><span class="p">,</span> <span class="n">list_range</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Determines how a list of bands should be consolidated, if at all.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_list_in</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">list_range</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;When using a ``list_range``, please be sure each passed &#39;</span>
                   <span class="s1">&#39;&quot;band&quot; is a list of exactly two wavelength values.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">band_list_in</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span>
            <span class="n">wl_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_band_range</span><span class="p">(</span><span class="n">band_list_in</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_list_in</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">list_range</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">wl_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">band_list_in</span><span class="p">:</span>
                <span class="n">wl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">b_i</span><span class="p">)</span>
                <span class="n">wl_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># just a single band; disregards ``list_range``</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">band_list_in</span><span class="p">)</span>
            <span class="n">wl_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">wl</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">wl_list</span>

<span class="c1">#    def _kmeans(self, n_classes=3, max_iter=100, spyfile=None):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        Development version -- do not use..</span>
<span class="c1">#</span>
<span class="c1">#        If there are more soil pixels than vegetation pixels, will vegetation be</span>
<span class="c1">#        class 0 instead of class 2?</span>
<span class="c1">#</span>
<span class="c1">#        Parameters:</span>
<span class="c1">#            n_classes (``int``): number of classes (default: 3).</span>
<span class="c1">#            max_iter (``int``): maximum iterations before terminating process</span>
<span class="c1">#                (default: 100).</span>
<span class="c1">#            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube to</span>
<span class="c1">#                crop; if ``numpy.ndarray`` or ``None``, loads band information from</span>
<span class="c1">#                ``self.spyfile`` (default: ``None``).</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if spyfile is None:</span>
<span class="c1">#            spyfile = self.spyfile</span>
<span class="c1">#        elif isinstance(spyfile, SpyFile.SpyFile):</span>
<span class="c1">#            self.load_spyfile(spyfile)</span>
<span class="c1">#        elif isinstance(spyfile, np.ndarray):</span>
<span class="c1">#            spyfile = self.spyfile</span>
<span class="c1">#        metadata = self.tools.spyfile.metadata</span>
<span class="c1">#        array_class, c = kmeans(spyfile, n_classes, max_iter)</span>
<span class="c1">#        unique_classes, counts = self._check_classes(array_class, n_pix=5)</span>
<span class="c1">#        df_class_spec = pd.DataFrame(c.transpose())</span>
<span class="c1">#</span>
<span class="c1">#        metadata[&#39;bands&#39;] = 1</span>
<span class="c1">#        self.tools.del_meta_item(metadata, &#39;wavelength&#39;)</span>
<span class="c1">#        self.tools.del_meta_item(metadata, &#39;band names&#39;)</span>
<span class="c1">#        hist_str = (&quot; -&gt; hs_process.segment.kmeans[&lt;&quot;</span>
<span class="c1">#                    &quot;label: &#39;n_classes?&#39; value:{0}; &quot;</span>
<span class="c1">#                    &quot;label: &#39;max_iter?&#39; value:{1}&gt;]&quot;</span>
<span class="c1">#                    &quot;&quot;.format(n_classes, max_iter))</span>
<span class="c1">#        metadata[&#39;history&#39;] += hist_str</span>
<span class="c1">#        metadata[&#39;samples&#39;] = array_class.shape[1]</span>
<span class="c1">#        metadata[&#39;lines&#39;] = array_class.shape[0]</span>
<span class="c1">#        return array_class, df_class_spec, metadata</span>

<div class="viewcode-block" id="segment.band_math_derivative"><a class="viewcode-back" href="../../api/hs_process.segment.html#hs_process.segment.band_math_derivative">[docs]</a>    <span class="k">def</span> <span class="nf">band_math_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">b1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_out</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates a derivative-type spectral index from two input bands</span>
<span class="sd">        and/or wavelengths. Bands/wavelengths can be input as two individual</span>
<span class="sd">        bands, two sets of bands (i.e., list of bands), or range of bands</span>
<span class="sd">        (i.e., list of two bands indicating the lower and upper range).</span>

<span class="sd">        Definition:</span>
<span class="sd">            array_der = (``wl1`` - ``wl2``) / (``wl2`` - ``wl3``)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wl1 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the first parameter of the</span>
<span class="sd">                derivative index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            wl2 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the second parameter of the</span>
<span class="sd">                derivative index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            wl3 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the third parameter of the</span>
<span class="sd">                derivative index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            b1 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the first parameter of the derivative index;</span>
<span class="sd">                if ``list``, then consolidates all bands between two band</span>
<span class="sd">                values by calculating the mean pixel value across all bands in</span>
<span class="sd">                that range (default: ``None``).</span>
<span class="sd">            b2 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the second parameter of the derivative index; if</span>
<span class="sd">                ``list``, then consolidates all bands between two band values</span>
<span class="sd">                by calculating the mean pixel value across all bands in that</span>
<span class="sd">                range (default: ``None``).</span>
<span class="sd">            b3 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the third parameter of the derivative index; if</span>
<span class="sd">                ``list``, then consolidates all bands between two band values</span>
<span class="sd">                by calculating the mean pixel value across all bands in that</span>
<span class="sd">                range (default: ``None``).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube to</span>
<span class="sd">                crop; if ``numpy.ndarray`` or ``None``, loads band information</span>
<span class="sd">                from ``self.spyfile`` (default: ``None``).</span>
<span class="sd">            list_range (``bool``): Whether bands/wavelengths passed as a list</span>
<span class="sd">                is interpreted as a range of bands (``True``) or for each</span>
<span class="sd">                individual band in the list (``False``). If ``list_range`` is</span>
<span class="sd">                ``True``, ``b1``/``wl1`` and ``b2``/``wl2`` should be lists</span>
<span class="sd">                with two items, and all bands/wavelegths between the two values</span>
<span class="sd">                will be used (default: ``True``).</span>
<span class="sd">            print_out (``bool``): Whether to print out the actual bands and</span>
<span class="sd">                wavelengths being used in the NDI calculation (default:</span>
<span class="sd">                ``True``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_der** (``numpy.ndarray``): Derivative band math array.</span>
<span class="sd">            - **metadata** (``dict``): Modified metadata describing the</span>
<span class="sd">              derivative array (``array_der``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``segment`` modules</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import segment</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>
<span class="sd">            &gt;&gt;&gt; my_segment = segment(io.spyfile)</span>

<span class="sd">            Calculate the MERIS Terrestrial Chlorophyll Index (MTCI; Dash and</span>
<span class="sd">            Curran, 2004) via ``segment.band_math_derivative``</span>

<span class="sd">            &gt;&gt;&gt; array_mtci, metadata = my_segment.band_math_derivative(</span>
<span class="sd">                    wl1=754, wl2=709, wl3=681, spyfile=io.spyfile)</span>
<span class="sd">            Bands used (``b1``): [176]</span>
<span class="sd">            Bands used (``b2``): [154]</span>
<span class="sd">            Bands used (``b3``): [141]</span>
<span class="sd">            Wavelengths used (``b1``): [753.84]</span>
<span class="sd">            Wavelengths used (``b2``): [708.6784]</span>
<span class="sd">            Wavelengths used (``b3``): [681.992]</span>
<span class="sd">            &gt;&gt;&gt; array_mtci.shape</span>
<span class="sd">            (617, 1827)</span>
<span class="sd">            &gt;&gt;&gt; np.nanmean(array_mtci)</span>
<span class="sd">            8.58501</span>

<span class="sd">            Show MTCI image via ``hsio.show_img``</span>

<span class="sd">            &gt;&gt;&gt; io.show_img(array_mtci, vmin=-2, vmax=15)</span>

<span class="sd">            .. image:: ../img/segment/mtci.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wl1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">wl2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">wl3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl3</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># Now, band input is converted to wavelength input and this can be used</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>

        <span class="n">band1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="n">band2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="n">band3_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl3</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_out</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">wl1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wl2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wl3_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band3_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bands used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bands used (``b2``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bands used (``b3``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band3_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Wavelengths used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelengths used (``b2``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelengths used (``b3``): </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl3_list</span><span class="p">))</span>

        <span class="n">array_b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_b3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band3_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_der</span> <span class="o">=</span> <span class="p">(</span><span class="n">array_b1</span><span class="o">-</span><span class="n">array_b2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">array_b2</span><span class="o">-</span><span class="n">array_b3</span><span class="p">)</span>
        <span class="n">array_der</span><span class="p">[</span><span class="n">array_der</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;band names&#39;</span><span class="p">)</span>
        <span class="n">hist_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; -&gt; hs_process.band_math_ndi[&lt;&quot;</span>
                    <span class="s2">&quot;label: &#39;wl1?&#39; value:</span><span class="si">{0}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;wl2?&#39; value:</span><span class="si">{1}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;wl3?&#39; value:</span><span class="si">{2}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;list_range?&#39; value:</span><span class="si">{3}</span><span class="s2">&gt;]&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">,</span> <span class="n">wl2_list</span><span class="p">,</span> <span class="n">wl3_list</span><span class="p">,</span> <span class="n">list_range</span><span class="p">))</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hist_str</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_der</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_der</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">array_der</span><span class="p">,</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="segment.band_math_mcari2"><a class="viewcode-back" href="../../api/hs_process.segment.html#hs_process.segment.band_math_mcari2">[docs]</a>    <span class="k">def</span> <span class="nf">band_math_mcari2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">b3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">print_out</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the MCARI2 spectral index</span>

<span class="sd">        Calculates the MCARI2 (Modified Chlorophyll Absorption Ratio Index</span>
<span class="sd">        Improved; Haboudane et al., 2004) spectral index from three input bands</span>
<span class="sd">        and/or wavelengths. Bands/wavelengths can be input as two individual</span>
<span class="sd">        bands, two sets of bands (i.e., list of bands), or range of bands</span>
<span class="sd">        (i.e., list of two bands indicating the lower and upper range).</span>

<span class="sd">        Definition:</span>
<span class="sd">            array_mcari2 = ((1.5 * (2.5 * (``wl1`` - ``wl2``) - 1.3 * (``wl1`` - ``wl3``))) / np.sqrt((2 * ``wl1`` + 1)**2 - (6 * ``wl1`` - 5 * np.sqrt(``wl2``)) - 0.5))</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wl1 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the first parameter of the</span>
<span class="sd">                MCARI2 index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            wl2 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the second parameter of the</span>
<span class="sd">                MCARI2 index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            wl3 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the third parameter of the</span>
<span class="sd">                MCARI2 index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            b1 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the first parameter of the MCARI2 index;</span>
<span class="sd">                if ``list``, then consolidates all bands between two band</span>
<span class="sd">                values by calculating the mean pixel value across all bands in</span>
<span class="sd">                that range (default: ``None``).</span>
<span class="sd">            b2 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the second parameter of the MCARI2 index; if</span>
<span class="sd">                ``list``, then consolidates all bands between two band values</span>
<span class="sd">                by calculating the mean pixel value across all bands in that</span>
<span class="sd">                range (default: ``None``).</span>
<span class="sd">            b3 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the third parameter of the MCARI2 index; if</span>
<span class="sd">                ``list``, then consolidates all bands between two band values</span>
<span class="sd">                by calculating the mean pixel value across all bands in that</span>
<span class="sd">                range (default: ``None``).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube to</span>
<span class="sd">                crop; if ``numpy.ndarray`` or ``None``, loads band information</span>
<span class="sd">                from ``self.spyfile`` (default: ``None``).</span>
<span class="sd">            list_range (``bool``): Whether bands/wavelengths passed as a list</span>
<span class="sd">                is interpreted as a range of bands (``True``) or for each</span>
<span class="sd">                individual band in the list (``False``). If ``list_range`` is</span>
<span class="sd">                ``True``, ``b1``/``wl1`` and ``b2``/``wl2`` should be lists</span>
<span class="sd">                with two items, and all bands/wavelegths between the two values</span>
<span class="sd">                will be used (default: ``True``).</span>
<span class="sd">            print_out (``bool``): Whether to print out the actual bands and</span>
<span class="sd">                wavelengths being used in the NDI calculation (default:</span>
<span class="sd">                ``True``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_mcari2** (``numpy.ndarray``): MCARI2 spectral index band</span>
<span class="sd">              math array.</span>
<span class="sd">            - **metadata** (``dict``): Modified metadata describing the</span>
<span class="sd">              MCARI2 index array (``array_mcari2``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``segment`` modules</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import segment</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>
<span class="sd">            &gt;&gt;&gt; my_segment = segment(io.spyfile)</span>

<span class="sd">            Calculate the MCARI2 spectral index (Haboudane et al., 2004) via</span>
<span class="sd">            ``segment.band_math_mcari2``</span>

<span class="sd">            &gt;&gt;&gt; array_mcari2, metadata = my_segment.band_math_mcari2(</span>
<span class="sd">                    wl1=800, wl2=670, wl3=550, spyfile=io.spyfile)</span>
<span class="sd">            Bands used (``b1``): [198]</span>
<span class="sd">            Bands used (``b2``): [135]</span>
<span class="sd">            Bands used (``b3``): [77]</span>
<span class="sd">            Wavelengths used (``b1``): [799.0016]</span>
<span class="sd">            Wavelengths used (``b2``): [669.6752]</span>
<span class="sd">            Wavelengths used (``b3``): [550.6128]</span>
<span class="sd">            &gt;&gt;&gt; np.nanmean(array_mcari2)</span>
<span class="sd">            0.5588388</span>

<span class="sd">            Show MCARI2 image via ``hsio.show_img``</span>

<span class="sd">            &gt;&gt;&gt; io.show_img(array_mcari2)</span>

<span class="sd">            .. image:: ../img/segment/mcari2.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wl1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">wl2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">wl3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl3</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># Now, band input is converted to wavelength input and this can be used</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>

        <span class="n">band1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="n">band2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="n">band3_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl3</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_out</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">wl1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wl2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wl3_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band3_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bands used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bands used (``b2``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bands used (``b3``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band3_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Wavelengths used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelengths used (``b2``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelengths used (``b3``): </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl3_list</span><span class="p">))</span>

        <span class="n">array_b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_b3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band3_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
<span class="c1">#        array_der = (array_b1-array_b2)/(array_b2-array_b3)</span>
        <span class="n">array_mcari2</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">array_b1</span> <span class="o">-</span> <span class="n">array_b2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.3</span> <span class="o">*</span> <span class="p">(</span><span class="n">array_b1</span> <span class="o">-</span> <span class="n">array_b3</span><span class="p">)))</span> <span class="o">/</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">array_b1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">array_b1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">array_b2</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">array_mcari2</span><span class="p">[</span><span class="n">array_mcari2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;band names&#39;</span><span class="p">)</span>
        <span class="n">hist_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; -&gt; hs_process.band_math_mcari2[&lt;&quot;</span>
                    <span class="s2">&quot;label: &#39;wl1?&#39; value:</span><span class="si">{0}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;wl2?&#39; value:</span><span class="si">{1}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;wl3?&#39; value:</span><span class="si">{2}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;list_range?&#39; value:</span><span class="si">{3}</span><span class="s2">&gt;]&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">,</span> <span class="n">wl2_list</span><span class="p">,</span> <span class="n">wl3_list</span><span class="p">,</span> <span class="n">list_range</span><span class="p">))</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hist_str</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_mcari2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_mcari2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">array_mcari2</span><span class="p">,</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="segment.band_math_ndi"><a class="viewcode-back" href="../../api/hs_process.segment.html#hs_process.segment.band_math_ndi">[docs]</a>    <span class="k">def</span> <span class="nf">band_math_ndi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">list_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_out</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates a normalized difference spectral index from two input bands</span>
<span class="sd">        and/or wavelengths. Bands/wavelengths can be input as two individual</span>
<span class="sd">        bands, two sets of bands (i.e., list of bands), or range of bands</span>
<span class="sd">        (i.e., list of two bands indicating the lower and upper range).</span>

<span class="sd">        Definition:</span>
<span class="sd">            array_ndi = (``wl1`` - ``wl2``) / (``wl1`` + ``wl2``)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wl1 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the first parameter of the</span>
<span class="sd">                normalized difference index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            wl2 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the second parameter of the</span>
<span class="sd">                normalized difference index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            b1 (``int``, ``float``, or ``list``): the band (or set of bands) to be</span>
<span class="sd">                used as the first parameter of the normalized difference index;</span>
<span class="sd">                if ``list``, then consolidates all bands between two band values</span>
<span class="sd">                by calculating the mean pixel value across all bands in that</span>
<span class="sd">                range (default: ``None``).</span>
<span class="sd">            b2 (``int``, ``float``, or ``list``): the band (or set of bands) to be</span>
<span class="sd">                used as the second parameter of the normalized difference</span>
<span class="sd">                index; if ``list``, then consolidates all bands between two band</span>
<span class="sd">                values by calculating the mean pixel value across all bands in</span>
<span class="sd">                that range (default: ``None``).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube to</span>
<span class="sd">                crop; if ``numpy.ndarray`` or ``None``, loads band information from</span>
<span class="sd">                ``self.spyfile`` (default: ``None``).</span>
<span class="sd">            list_range (``bool``): Whether bands/wavelengths passed as a list is</span>
<span class="sd">                interpreted as a range of bands (``True``) or for each individual</span>
<span class="sd">                band in the list (``False``). If ``list_range`` is ``True``,</span>
<span class="sd">                ``b1``/``wl1`` and ``b2``/``wl2`` should be lists with two items, and</span>
<span class="sd">                all bands/wavelegths between the two values will be used</span>
<span class="sd">                (default: ``True``).</span>
<span class="sd">            print_out (``bool``): Whether to print out the actual bands and</span>
<span class="sd">                wavelengths being used in the NDI calculation (default:</span>
<span class="sd">                ``True``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_ndi** (``numpy.ndarray``): Normalized difference band</span>
<span class="sd">              math array.</span>
<span class="sd">            - **metadata** (``dict``): Modified metadata describing the</span>
<span class="sd">              normalized difference array (``array_ndi``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``segment`` modules</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import segment</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>
<span class="sd">            &gt;&gt;&gt; my_segment = segment(io.spyfile)</span>

<span class="sd">            Calculate the Normalized difference vegetation index using 10 nm</span>
<span class="sd">            bands centered at 800 nm and 680 nm via ``segment.band_math_ndi``</span>

<span class="sd">            &gt;&gt;&gt; array_ndvi, metadata = my_segment.band_math_ndi(</span>
<span class="sd">                    wl1=[795, 805], wl2=[675, 685], spyfile=io.spyfile)</span>
<span class="sd">            Bands used (``b1``): [197, 198, 199, 200]</span>
<span class="sd">            Bands used (``b2``): [138, 139, 140, 141, 142]</span>
<span class="sd">            Wavelengths used (``b1``): [796.9488, 799.0016, 801.0544, 803.1072]</span>
<span class="sd">            Wavelengths used (``b2``): [675.8336, 677.8864, 679.9392, 681.992, 684.0448]</span>
<span class="sd">            &gt;&gt;&gt; np.nanmean(array_ndvi)</span>
<span class="sd">            0.80558914</span>

<span class="sd">            Show NDVI image via ``hsio.show_img``</span>

<span class="sd">            &gt;&gt;&gt; io.show_img(array_ndvi)</span>

<span class="sd">            .. image:: ../img/segment/ndvi.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wl1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">wl2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Now, band input is converted to wavelength input and this can be used</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>

        <span class="n">band1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="n">band2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_out</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">wl1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wl2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bands used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bands used (``b2``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Wavelengths used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelengths used (``b2``): </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl2_list</span><span class="p">))</span>

        <span class="n">array_b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_ndi</span> <span class="o">=</span> <span class="p">(</span><span class="n">array_b1</span><span class="o">-</span><span class="n">array_b2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">array_b1</span><span class="o">+</span><span class="n">array_b2</span><span class="p">)</span>
        <span class="n">array_ndi</span><span class="p">[</span><span class="n">array_ndi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;band names&#39;</span><span class="p">)</span>
        <span class="n">hist_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; -&gt; hs_process.band_math_ndi[&lt;&quot;</span>
                    <span class="s2">&quot;label: &#39;wl1?&#39; value:</span><span class="si">{0}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;wl2?&#39; value:</span><span class="si">{1}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;list_range?&#39; value:</span><span class="si">{2}</span><span class="s2">&gt;]&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">,</span> <span class="n">wl2_list</span><span class="p">,</span> <span class="n">list_range</span><span class="p">))</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hist_str</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_ndi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_ndi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">array_ndi</span><span class="p">,</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="segment.band_math_ratio"><a class="viewcode-back" href="../../api/hs_process.segment.html#hs_process.segment.band_math_ratio">[docs]</a>    <span class="k">def</span> <span class="nf">band_math_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">spyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_out</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates a simple ratio spectral index from two input band and/or</span>
<span class="sd">        wavelengths. Bands/wavelengths can be input as two individual bands,</span>
<span class="sd">        two sets of bands (i.e., list of bands), or a range of bands (i.e.,</span>
<span class="sd">        list of two bands indicating the lower and upper range).</span>

<span class="sd">        Definition:</span>
<span class="sd">            array_ratio = (``wl1``/``wl2``)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wl1 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the first parameter of the</span>
<span class="sd">                normalized difference index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            wl2 (``int``, ``float``, or ``list``): the wavelength (or set of</span>
<span class="sd">                wavelengths) to be used as the second parameter of the</span>
<span class="sd">                normalized difference index; if ``list``, then consolidates all</span>
<span class="sd">                bands between two wavelength values by calculating the mean</span>
<span class="sd">                pixel value across all bands in that range (default: ``None``).</span>
<span class="sd">            b1 (``int``, ``float``, or ``list``): the band (or set of bands) to</span>
<span class="sd">                be used as the first parameter (numerator) of the ratio index;</span>
<span class="sd">                if ``list``, then consolidates all bands between two band</span>
<span class="sd">                values by calculating the mean pixel value across all bands in</span>
<span class="sd">                that range (default: ``None``).</span>
<span class="sd">            b2 (``int``, ``float``, or ``list``): the bands (or set of bands)</span>
<span class="sd">                to be used as the second parameter (denominator) of the ratio</span>
<span class="sd">                index; if ``list``, then consolidates all bands between two</span>
<span class="sd">                bands values by calculating the mean pixel value across all</span>
<span class="sd">                bands in that range (default: ``None``).</span>
<span class="sd">            spyfile (``SpyFile`` object or ``numpy.ndarray``): The datacube to</span>
<span class="sd">                crop; if ``numpy.ndarray`` or ``None``, loads band information</span>
<span class="sd">                from ``self.spyfile`` (default: ``None``).</span>
<span class="sd">            list_range (``bool``): Whether a band passed as a list is</span>
<span class="sd">                interpreted as a range of bands (``True``) or for each</span>
<span class="sd">                individual band in the list (``False``). If ``list_range`` is</span>
<span class="sd">                ``True``, ``b1``/``wl1`` and ``b2``/``wl2`` should be lists</span>
<span class="sd">                with two items, and all bands/wavelegths between the two values</span>
<span class="sd">                will be used (default: ``True``).</span>
<span class="sd">            print_out (``bool``): Whether to print out the actual bands and</span>
<span class="sd">                wavelengths being used in the NDI calculation (default:</span>
<span class="sd">                ``True``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-element ``tuple`` containing</span>

<span class="sd">            - **array_ratio** (``numpy.ndarray``): Ratio band math array.</span>
<span class="sd">            - **metadata** (``dict``): Modified metadata describing the</span>
<span class="sd">              ratio array (``array_ratio``).</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``segment`` modules</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import segment</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>
<span class="sd">            &gt;&gt;&gt; my_segment = segment(io.spyfile)</span>

<span class="sd">            Calculate a red/near-infrared band ratio using a range of bands</span>
<span class="sd">            (i.e., mimicking a broadband sensor) via</span>
<span class="sd">            ``segment.band_math_ratio``</span>

<span class="sd">            &gt;&gt;&gt; array_ratio, metadata = my_segment.band_math_ratio(</span>
<span class="sd">                    wl1=[630, 690], wl2=[800, 860], list_range=True)</span>
<span class="sd">            Bands used (``b1``): [116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144]</span>
<span class="sd">            Bands used (``b2``): [199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227]</span>
<span class="sd">            Wavelengths used (``b1``): [630.672, 632.7248, 634.7776, 636.8304, 638.8832, 640.936, 642.9888, 645.0416, 647.0944, 649.1472, 651.2, 653.2528, 655.3056, 657.3584, 659.4112, 661.464, 663.5168, 665.5696, 667.6224, 669.6752, 671.728, 673.7808, 675.8336, 677.8864, 679.9392, 681.992, 684.0448, 686.0976, 688.1504]</span>
<span class="sd">            Wavelengths used (``b2``): [801.0544, 803.1072, 805.16, 807.2128, 809.2656, 811.3184, 813.3712, 815.424, 817.4768, 819.5296, 821.5824, 823.6352, 825.688, 827.7408, 829.7936, 831.8464, 833.8992, 835.952, 838.0048, 840.0576, 842.1104, 844.1632, 846.216, 848.2688, 850.3216, 852.3744, 854.4272, 856.48, 858.5328]</span>
<span class="sd">            (659/830)</span>
<span class="sd">            &gt;&gt;&gt; np.nanmean(array_ratio)</span>
<span class="sd">            0.11956976</span>

<span class="sd">            Notice that 29 spectral bands were consolidated (i.e., averaged) to</span>
<span class="sd">            mimic a single broad band. We can take the mean of two bands by</span>
<span class="sd">            changing ``list_range`` to ``False``, and this slightly changes the</span>
<span class="sd">            result.</span>

<span class="sd">            &gt;&gt;&gt; array_ratio, metadata = my_segment.band_math_ratio(</span>
<span class="sd">                    wl1=[630, 690], wl2=[800, 860], list_range=False)</span>
<span class="sd">            Bands used (``b1``): [116, 145]</span>
<span class="sd">            Bands used (``b2``): [198, 228]</span>
<span class="sd">            Wavelengths used (``b1``): [630.672, 690.2032]</span>
<span class="sd">            Wavelengths used (``b2``): [799.0016, 860.5856]</span>
<span class="sd">            (660/830)</span>
<span class="sd">            &gt;&gt;&gt; np.nanmean(array_ratio)</span>
<span class="sd">            0.123936154</span>

<span class="sd">            Show the red/near-infrared ratio image via ``hsio.show_img``</span>

<span class="sd">            &gt;&gt;&gt; io.show_img(array_ratio, vmax=0.3)</span>

<span class="sd">            .. image:: ../img/segment/ratio_r_nir.png</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wl1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">wl2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_bands_wls</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Now, band input is converted to wavelength input and this can be used</span>

        <span class="k">if</span> <span class="n">spyfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">SpyFile</span><span class="o">.</span><span class="n">SpyFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_spyfile</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spyfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">spyfile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">spyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span>

        <span class="n">band1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl1</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>
        <span class="n">band2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_band_list</span><span class="p">(</span><span class="n">wl2</span><span class="p">,</span> <span class="n">list_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_out</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">wl1_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wl2_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wavelength_list</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bands used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bands used (``b2``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Wavelengths used (``b1``): </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelengths used (``b2``): </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wl2_list</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{0:.0f}</span><span class="s1">/</span><span class="si">{1:.0f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wl1_list</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wl2_list</span><span class="p">)))</span>

        <span class="n">array_b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band1_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_spectral_mean</span><span class="p">(</span><span class="n">band2_list</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">array_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">array_b1</span><span class="o">/</span><span class="n">array_b2</span><span class="p">)</span>
        <span class="n">array_ratio</span><span class="p">[</span><span class="n">array_ratio</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">del_meta_item</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;band names&#39;</span><span class="p">)</span>
        <span class="n">hist_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; -&gt; hs_process.band_math_ratio[&lt;&quot;</span>
                    <span class="s2">&quot;label: &#39;b1?&#39; value:</span><span class="si">{0}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;b2?&#39; value:</span><span class="si">{1}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;label: &#39;list_range?&#39; value:</span><span class="si">{2}</span><span class="s2">&gt;]&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">list_range</span><span class="p">))</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hist_str</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">array_ratio</span><span class="p">,</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="segment.load_spyfile"><a class="viewcode-back" href="../../api/hs_process.segment.html#hs_process.segment.load_spyfile">[docs]</a>    <span class="k">def</span> <span class="nf">load_spyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spyfile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Loads a ``SpyFile`` (Spectral Python object) for data access and/or</span>
<span class="sd">        manipulation by the ``hstools`` class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="sd">                manipulated.</span>

<span class="sd">        Example:</span>
<span class="sd">            Load ``hsio`` and ``segment`` modules</span>

<span class="sd">            &gt;&gt;&gt; from hs_process import hsio</span>
<span class="sd">            &gt;&gt;&gt; from hs_process import segment</span>
<span class="sd">            &gt;&gt;&gt; fname_in = r&#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip.hdr&#39;</span>
<span class="sd">            &gt;&gt;&gt; io = hsio(fname_in)</span>
<span class="sd">            &gt;&gt;&gt; my_segment = segment(io.spyfile)</span>

<span class="sd">            Load datacube  via ``segment.load_spyfile``</span>

<span class="sd">            &gt;&gt;&gt; my_segment.load_spyfile(io.spyfile)</span>
<span class="sd">            &gt;&gt;&gt; my_segment.spyfile</span>
<span class="sd">            Data Source:   &#39;F:\\nigo0024\Documents\hs_process_demo\Wells_rep2_20180628_16h56m_pika_gige_7-Radiance Conversion-Georectify Airborne Datacube-Convert Radiance Cube to Reflectance from Measured Reference Spectrum.bip&#39;</span>
<span class="sd">            # Rows:            617</span>
<span class="sd">            # Samples:        1827</span>
<span class="sd">            # Bands:           240</span>
<span class="sd">            Interleave:        BIP</span>
<span class="sd">            Quantization:  32 bits</span>
<span class="sd">            Data format:   float32</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span> <span class="o">=</span> <span class="n">spyfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">hstools</span><span class="p">(</span><span class="n">spyfile</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">map_info_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_meta_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spyfile</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;map info&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ul_e_srs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">map_info_set</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ul_n_srs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">map_info_set</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ps_e</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">map_info_set</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ps_n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">map_info_set</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Map information was not able to be loaded from the &#39;</span>
                  <span class="s1">&#39;``SpyFile``. Please be sure the metadata contains the &quot;map &#39;</span>
                  <span class="s1">&#39;info&quot; tag with accurate geometric information.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ul_e_srs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ul_n_srs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ps_e</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spy_ps_n</span> <span class="o">=</span> <span class="kc">None</span></div></div>

<span class="c1">#    def veg_spectra(self, array_veg, thresh=None, percentile=None,</span>
<span class="c1">#                    side=&#39;lower&#39;, spyfile=None):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        Calculates the average spectra across vegetation pixels</span>
<span class="c1">#</span>
<span class="c1">#        Parameters:</span>
<span class="c1">#            array_veg (``numpy.ndarray``): a single-band image array, presumably</span>
<span class="c1">#                that discriminates vegetation pixels from other pixels such as</span>
<span class="c1">#                soil, shadow, etc.</span>
<span class="c1">#            thresh (``float``): The value for which to base the threshold</span>
<span class="c1">#                (default: ``None``).</span>
<span class="c1">#            percentile (``float`` or ``int``): The percentile of pixels to mask; if</span>
<span class="c1">#                ``percentile``=95 and ``side``=&#39;lower&#39;, the lowest 95% of pixels</span>
<span class="c1">#                will be masked prior to calculating the mean spectra across</span>
<span class="c1">#                pixels (default: ``None``; range: 0-100).</span>
<span class="c1">#            side (``str``): The side of the threshold or percentile for which to</span>
<span class="c1">#                apply the mask. Must be either &#39;lower&#39; or &#39;upper&#39;; if &#39;lower&#39;,</span>
<span class="c1">#                everything below the threshold/percentile will be masked</span>
<span class="c1">#                (default: &#39;lower&#39;).</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if spyfile is None:</span>
<span class="c1">#            spyfile = self.spyfile</span>
<span class="c1">#        elif isinstance(spyfile, SpyFile.SpyFile):</span>
<span class="c1">#            self.load_spyfile(spyfile)</span>
<span class="c1">#</span>
<span class="c1">##        if remove_shadow is True:</span>
<span class="c1">##            shadow_mask, metadata = self.tools.mask_shadow(</span>
<span class="c1">##                    shadow_pctl=shadow_pctl, show_histogram=True,</span>
<span class="c1">##                    spyfile=spyfile)</span>
<span class="c1">##            array_veg = np.ma.array(array_veg, mask=shadow_mask)</span>
<span class="c1">##        else:</span>
<span class="c1">##            if not isinstance(array_veg, np.ma.core.MaskedArray):</span>
<span class="c1">##                array_veg = np.ma.array(array_veg, mask=False)</span>
<span class="c1">##            metadata = self.spyfile.metadata</span>
<span class="c1">#</span>
<span class="c1">#        mask_array, metadata = self.tools.mask_array(</span>
<span class="c1">#                array_veg, self.spyfile.metadata, thresh=thresh,</span>
<span class="c1">#                percentile=percentile, side=side)</span>
<span class="c1">#</span>
<span class="c1">#        mask_array_3d = np.empty(spyfile.shape)</span>
<span class="c1">#        for band in range(spyfile.nbands):</span>
<span class="c1">#            mask_array_3d[:, :, band] = mask_array.mask</span>
<span class="c1">#        datacube_masked = np.ma.masked_array(spyfile.load(),</span>
<span class="c1">#                                             mask=mask_array_3d)</span>
<span class="c1">#        spec_mean = np.nanmean(datacube_masked, axis=(0, 1))</span>
<span class="c1">#        spec_std = np.nanstd(datacube_masked, axis=(0, 1))</span>
<span class="c1">##        a = spec_mean.reshape(len(spec_mean))</span>
<span class="c1">#        spec_mean = pd.Series(spec_mean)</span>
<span class="c1">#        spec_std = pd.Series(spec_std)</span>
<span class="c1">#</span>
<span class="c1">#        return spec_mean, spec_std, datacube_masked, metadata</span>

<span class="c1">#    def mask_datacube(self, mask, spyfile=None):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        DO NOT USE; USE hstools.mask_datacube() INSTEAD AND PASS A MASK.</span>
<span class="c1">#</span>
<span class="c1">#        Applies ``mask`` to ``spyfile``, then returns the datcube (as a np.array)</span>
<span class="c1">#        and the mean spectra</span>
<span class="c1">#</span>
<span class="c1">#        Parameters:</span>
<span class="c1">#            mask (``numpy.ndarray``): the mask to apply to ``spyfile``; if ``mask``</span>
<span class="c1">#                does not have similar dimensions to ``spyfile``, the first band</span>
<span class="c1">#                (i.e., first two dimensions) of ``mask`` will be repeated n times</span>
<span class="c1">#                to match the number of bands of ``spyfile``.</span>
<span class="c1">#            spyfile (``SpyFile`` object): The datacube being accessed and/or</span>
<span class="c1">#                manipulated.</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if spyfile is None:</span>
<span class="c1">#            spyfile = self.spyfile</span>
<span class="c1">#        elif isinstance(spyfile, SpyFile.SpyFile):</span>
<span class="c1">#            self.load_spyfile(spyfile)</span>
<span class="c1">#</span>
<span class="c1">#        if isinstance(mask, np.ma.masked_array):</span>
<span class="c1">#            mask = mask.mask</span>
<span class="c1">#        if mask.shape != spyfile.shape:</span>
<span class="c1">#            mask_1d = mask.copy()</span>
<span class="c1">#            mask = np.empty(spyfile.shape)</span>
<span class="c1">#            for band in range(spyfile.nbands):</span>
<span class="c1">#                mask[:, :, band] = mask_1d</span>
<span class="c1">#</span>
<span class="c1">#        datacube_masked = np.ma.masked_array(spyfile.load(), mask=mask)</span>
<span class="c1">#        spec_mean = np.nanmean(datacube_masked, axis=(0, 1))</span>
<span class="c1">#        spec_std = np.nanstd(datacube_masked, axis=(0, 1))</span>
<span class="c1">#        spec_mean = pd.Series(spec_mean)</span>
<span class="c1">#        spec_std = pd.Series(spec_std)</span>
<span class="c1">#        return spec_mean, spec_std, datacube_masked</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Tyler J. Nigon.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>